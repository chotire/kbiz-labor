<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet href="/resources/css/common.css" type="text/css"?>
<?xml-stylesheet href="/resources/css/content.css" type="text/css"?>

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:w2="http://www.inswave.com/websquare"
	xmlns:xf="http://www.w3.org/2002/xforms">
	<head>
		<w2:type>DEFAULT</w2:type>
		<w2:buildDate />
		<xf:model>
			<xf:instance>
				<data xmlns="" />
			</xf:instance>
			<w2:dataCollection baseNode="map">
				<w2:dataList baseNode="list" repeatNode="map" style="" id="dsTcfDeptList" saveRemovedData="true">
						<w2:columnInfo>
								<w2:column id="deptCd" name="부서코드" dataType="text"></w2:column>
								<w2:column id="deptNm" name="부서명" dataType="text"></w2:column>
								<w2:column id="upperDeptCd" name="상위부서코드" dataType="text"></w2:column>
								<w2:column id="upperDeptCdNm" name="상위부서코드명" dataType="text"></w2:column>
								<w2:column id="dpldrEmpno" name="부서장_사번" dataType="text"></w2:column>
								<w2:column id="dpldrNm" name="부서장_명" dataType="text"></w2:column>
								<w2:column id="deptLv" name="부서레벨" dataType="text"></w2:column>
								<w2:column id="useYn" name="사용여부" dataType="text"></w2:column>
								<w2:column id="rdeptYn" name="실부서여부" dataType="text"></w2:column>
								<w2:column id="hdofSiteGbCd" name="본사현장구분코드" dataType="text"></w2:column>
								<w2:column id="lv1DeptCd" name="레벨1_부서코드" dataType="text"></w2:column>
								<w2:column id="lv1DeptNm" name="레벨1_부서_명" dataType="text"></w2:column>
								<w2:column id="lv2DeptCd" name="레벨2_부서코드" dataType="text"></w2:column>
								<w2:column id="lv2DeptNm" name="레벨2_부서_명" dataType="text"></w2:column>
								<w2:column id="lv3DeptCd" name="레벨3_부서코드" dataType="text"></w2:column>
								<w2:column id="lv3DeptNm" name="레벨3_부서_명" dataType="text"></w2:column>
								<w2:column id="lv4DeptCd" name="레벨4_부서코드" dataType="text"></w2:column>
								<w2:column id="lv4DeptNm" name="레벨4_부서_명" dataType="text"></w2:column>
								<w2:column id="lv5DeptCd" name="레벨5_부서코드" dataType="text"></w2:column>
								<w2:column id="lv5DeptNm" name="레벨5_부서_명" dataType="text"></w2:column>
								<w2:column id="lv6DeptCd" name="레벨6_부서코드" dataType="text"></w2:column>
								<w2:column id="lv6DeptNm" name="레벨6_부서_명" dataType="text"></w2:column>
								<w2:column id="lv7DeptCd" name="레벨7_부서코드" dataType="text"></w2:column>
								<w2:column id="lv7DeptNm" name="레벨7_부서_명" dataType="text"></w2:column>
								<w2:column id="fstRegprId" name="최초등록자ID" dataType="text"></w2:column>
								<w2:column id="fstRegDtm" name="최초등록일시" dataType="text"></w2:column>
								<w2:column id="fnlModprId" name="최종수정자ID" dataType="text"></w2:column>
								<w2:column id="fnlModiDtm" name="최종수정일시" dataType="text"></w2:column>
								<w2:column id="check" name="check" dataType="text"></w2:column>
						</w2:columnInfo>
						<w2:data use="true">
								<w2:row></w2:row>
						</w2:data>
				</w2:dataList>
				<w2:dataMap baseNode="map" id="dsTcfDeptMap">
					<w2:keyInfo>
						<w2:key id="deptCd" name="부서코드" dataType="text"></w2:key>
						<w2:key id="deptNm" name="부서명" dataType="text"></w2:key>
						<w2:key id="upperDeptCd" name="상위부서코드" dataType="text"></w2:key>
						<w2:key id="dpldrEmpno" name="부서장_사번" dataType="text"></w2:key>
						<w2:key id="useYn" name="사용여부" dataType="text"></w2:key>
					</w2:keyInfo>
					<w2:data use="true">
					</w2:data>
				</w2:dataMap>
				<w2:dataList baseNode="list" id="dsTcfDeptComboList" repeatNode="map" saveRemovedData="true" style="">
					<w2:columnInfo>
						<w2:column dataType="text" id="deptCd" name="부서코드"></w2:column>
						<w2:column dataType="text" id="deptNm" name="부서명"></w2:column>
						<w2:column dataType="text" id="upperDeptCd" name="상위부서코드"></w2:column>
						<w2:column dataType="text" id="upperDeptCdNm" name="상위부서코드명"></w2:column>
						<w2:column dataType="text" id="dpldrEmpno" name="부서장_사번"></w2:column>
						<w2:column dataType="text" id="dpldrNm" name="부서장_명"></w2:column>
						<w2:column dataType="text" id="deptLv" name="부서레벨"></w2:column>
						<w2:column dataType="text" id="useYn" name="사용여부"></w2:column>
						<w2:column dataType="text" id="hdofSiteGbCd" name="본사현장구분코드"></w2:column>
						<w2:column dataType="text" id="lv1DeptCd" name="레벨1_부서코드"></w2:column>
						<w2:column id="lv1DeptNm" name="레벨1_부서_명" dataType="text"></w2:column>
						<w2:column id="lv2DeptCd" name="레벨2_부서코드" dataType="text"></w2:column>
						<w2:column id="lv2DeptNm" name="레벨2_부서_명" dataType="text"></w2:column>
						<w2:column id="lv3DeptCd" name="레벨3_부서코드" dataType="text"></w2:column>
						<w2:column id="lv3DeptNm" name="레벨3_부서_명" dataType="text"></w2:column>
						<w2:column id="lv4DeptCd" name="레벨4_부서코드" dataType="text"></w2:column>
						<w2:column id="lv4DeptNm" name="레벨4_부서_명" dataType="text"></w2:column>
						<w2:column id="lv5DeptCd" name="레벨5_부서코드" dataType="text"></w2:column>
						<w2:column id="lv5DeptNm" name="레벨5_부서_명" dataType="text"></w2:column>
						<w2:column id="lv6DeptCd" name="레벨6_부서코드" dataType="text"></w2:column>
						<w2:column id="lv6DeptNm" name="레벨6_부서_명" dataType="text"></w2:column>
						<w2:column id="lv7DeptCd" name="레벨7_부서코드" dataType="text"></w2:column>
						<w2:column id="lv7DeptNm" name="레벨7_부서_명" dataType="text"></w2:column>
						<w2:column id="fstRegprId" name="최초등록자ID" dataType="text"></w2:column>
						<w2:column id="fstRegDtm" name="최초등록일시" dataType="text"></w2:column>
						<w2:column id="fnlModprId" name="최종수정자ID" dataType="text"></w2:column>
						<w2:column id="fnlModiDtm" name="최종수정일시" dataType="text"></w2:column>
					</w2:columnInfo>
					<w2:data use="true">
						<w2:row></w2:row>
					</w2:data>
				</w2:dataList>
			</w2:dataCollection>
			<w2:workflowCollection></w2:workflowCollection>
		</xf:model>
		<script src="/resources/js/commonUI.js" type="javascript"/>
		<script type="javascript" lazy="false"><![CDATA[
/***************************************************************************
 * Program ID : CF00051003P.xml 
 * Program Name : 부서검색(트리 멀티체크) 
 * Author : 남상열 (tpnsr)
 * Date : 2019.04.10
 * 
 * History 
 * ======================================== 
 * 변경일자     수정자   내 용 
 * ======================================== 
 *     
 **************************************************************************/ 
    /************************************************************************************ 
     *  [1] onpageload
    ************************************************************************************/   
    scwin.onpageload = function() { 
        //추가 코드값 맵핑 호출 
        scwin.fnInitial();
		
        cond = JSON.parse($p.getPopupParam()).data.cond;
        var pDeptCd = JSON.parse($p.getPopupParam()).data.deptTreeCd;
        var pDeptNm = JSON.parse($p.getPopupParam()).data.deptTreeNm;
        var pCheckChild = JSON.parse($p.getPopupParam()).data.checkChild;
        
        if ( pDeptCd != "" || pDeptNm != "" ){
            dsTcfDeptMap.set("deptCd", pDeptCd);
            dsTcfDeptMap.set("deptNm", pDeptNm);
            scwin.fnSelectTcfDeptListRecursive();
        }
        
        //체크박스 하위 노드 적용여부
        if (pCheckChild != null && pCheckChild != "" && pCheckChild == "true"){
	        trvTcfDeptList.options.checkAllChildNodes = true;
	    }
    };

    /** 화면초기화 **/ 
    scwin.fnInitial = function() { 
        grpSearch.init();					//조회그룹 초기화        
    }; 

    /************************************************************************************ 
     *  [2] 전역변수  
    ************************************************************************************/     
	var svcId;		//callback 처리용 서비스ID 
    var cond; 	

    /************************************************************************************ 
     *  [3] Callback 함수  
     ************************************************************************************/ 
    /** 오류시 처리 **/ 
 	scwin.fnErrCallback = function(result, e) {
 	   alert("fnErrCallback result:" + result);
 	} 

     /** 정상시 후처리 **/ 
     scwin.fnCallback = function(result, e) { 
     	switch(svcId) { 
 			case "selectTcfDeptComboList" :  
 				//서버에서 넘겨주는 값 세팅 
 				dsTcfDeptComboList.setJSON(result.data.dsTcfDeptList); 
       			dsTcfDeptComboList.insertRow( 0 );
			    dsTcfDeptComboList.setCellData( 0 , "deptNm" , "전체" );
			    dsTcfDeptComboList.setCellData( 0 , "deptCd" , "" );
 				break; 

 			case "selectTcfDeptListRecursive" :  
			    //서버에서 넘겨주는 값 세팅 
			    dsTcfDeptList.setJSON(result.data.dsTcfDeptList);
			    
			    trvTcfDeptList.disableCheckboxByValue( "" , checkDisabled , childDisalbed )
			    
 				break; 

 			case "selectTcfDeptList" :  
 				//서버에서 넘겨주는 값 세팅 
 				dsTcfDeptList.setJSON(result.data.dsTcfDeptList); 
 				break; 

 			case "resetTcfDept" :  
 				//공통코드POOL 등록, 수정, 삭제 후 재조회 
 				scwin.btnFind_onclick(); 
 				break;

 			default :
 				break; 
     	} 
     }; 
 
     /************************************************************************************ 
      *  [4] Event 함수  -->
      ************************************************************************************/       
     /** 공통코드POOL 정보를 리스트 조회 **/ 
     scwin.btnFind_onclick = function() { 

		scwin.fnSelectTcfDeptListRecursive(); 
     }; 

    /************************************************************************************
     *  [5] 사용자 정의함수 함수 
     ************************************************************************************/
    /** 공통상세코드POOL 정보를 리스트 조회 **/
     scwin.fnSelectTcfDeptComboList = function() { 
     	
     	svcId = "selectTcfDeptComboList";

     	//서비스 호출 
 		ajaxLib.ajax("/cf/CF00051000P/selectTcfDeptList", { 
             mode		: "asynchronous", 
             method 		: "Post", 
             requestData	: dsTcfDeptMap.getJSON(), 
 			 callback	: "fnCallback",	 
             errCallback	: "fnErrCallback" 
         }); 
     };
	   
	// fnSelectTcfDeptListRecursive
    scwin.fnSelectTcfDeptListRecursive= function() { 

     	svcId = "selectTcfDeptListRecursive";

     	//서비스 호출 
 		ajaxLib.ajax("/cf/CF00051000P/selectTcfDeptListRecursive", { 
             mode		: "asynchronous", 
             method 		: "Post", 
             requestData	: dsTcfDeptMap.getJSON(), 
 			 callback	: "fnCallback",	 
             errCallback	: "fnErrCallback" 
         }); 
	};

	// treeview_ontoggleclick
	scwin.treeview_ontoggleclick = function(nodeElement,index,isRendered) {
		//alert("treeview_ontoggleclick !!");
	};
	
	// 확인 버튼 클릭
	scwin.btnConfirm_onclick = function() {
		var arr = new Array();
		//체크값 모으기
		$.each(trvTcfDeptList.getCheckedIndexes(),function(index , item){
			arr.push(dsTcfDeptList.getRowJSON(item-1));
		});
		
		//체크된 값넘기기
		com.popup_close(JSON.stringify(arr));
		
	};	
	
	// 취소 버튼 클릭
	scwin.btnCancel_onclick = function() {
		com.popup_close("");
	};
	
	/**************************************************************************
	 * Event: scwin.ibxKeyDeptCd_onkeyup
	 * 기 능: 부서코드 입력후 Enter시 처리
	 **************************************************************************/
	scwin.ibxKeyDeptCd_onkeyup = function(e) {
		if (e.keyCode == '13') {
	   		scwin.btnFind_onclick();
	   	}
	};
	
	/**************************************************************************
	 * Event: scwin.ibxKeyDeptNm_onkeyup
	 * 기 능: 부서명 입력후 Enter시 처리
	 **************************************************************************/
	scwin.ibxKeyDeptNm_onkeyup = function(e) {
		if (e.keyCode == '13') {
	   		scwin.btnFind_onclick();
	   	}
	};
	
	/**************************************************************************
	 * Event: scwin.trvTcfDeptList_onlabelclick
	 * 기 능: 라벨클릭시 checkbox 체크
	 **************************************************************************/
	scwin.trvTcfDeptList_onlabelclick = function(value,nodeElement,index) {
		var indexs = dsTcfDeptList.getMatchedIndex( "deptCd" , value , true );
		
		$.each(indexs,function(index,item){
			 var check = dsTcfDeptList.getCellData( item , 'check' );
			 
			 if(check == "" || check == "0"){
				dsTcfDeptList.setCellData( item , 'check' , '1' );
			 } else {
				dsTcfDeptList.setCellData( item , 'check' , '0' );
			 }
		});
	};
	]]></script>

		
	</head>
	<body  ev:onpageload="scwin.onpageload">
		<xf:group style="" id="" class="content_body popup">
			<xf:group class="tbl_search" id="grpSearch" style="">
				<xf:group class="tb_list" id="" style="" tagname="table">
					<w2:attributes>
						<w2:summary>조회조건 테이블 입니다.</w2:summary>
					</w2:attributes>
					<xf:group tagname="colgroup">
						<xf:group style="width:120.00px;" tagname="col"></xf:group>
						<xf:group style="width:auto;" tagname="col"></xf:group>
						<xf:group style="width:120.00px;" tagname="col"></xf:group>
						<xf:group style="width:auto;" tagname="col"></xf:group>
					</xf:group>
					<xf:group style="" tagname="tr">
						<xf:group class="w2tb_th" style="" tagname="th">
							<w2:attributes>
								<w2:scope>row</w2:scope>
							</w2:attributes>
							<w2:span class="" id="" label="부서코드" style=""></w2:span>
						</xf:group>
						<xf:group class="w2tb_td" style="" tagname="td">
							<xf:input adjustMaxLength="false" dataType="text" id="ibxKeyDeptCd" ref="data:dsTcfDeptMap.deptCd"
								style="width: 140px;" ev:onkeyup="scwin.ibxKeyDeptCd_onkeyup" maxlength="20" allowChar="0-9A-Z">
							</xf:input>
						</xf:group>
						<xf:group class="w2tb_th" style="" tagname="th">
							<w2:attributes>
								<w2:scope>row</w2:scope>
							</w2:attributes>
							<w2:span class="" id="" label="부서명" style=""></w2:span>
						</xf:group>
						<xf:group class="w2tb_td" style="" tagname="td">
							<xf:input id="ibxKeyDeptNm" ref="data:dsTcfDeptMap.deptNm" style="width: 140px;" ev:onkeyup="scwin.ibxKeyDeptNm_onkeyup" maxByteLength="300"></xf:input>
						</xf:group>
					</xf:group>
				</xf:group>
				<xf:group class="btn_tbl_search" style="" tagname="">
					<w2:anchor class="btn_sh" id="btnFind" outerDiv="false" style=""
						ev:onclick="scwin.btnFind_onclick">
						<xf:label><![CDATA[조회]]></xf:label>
					</w2:anchor>
				</xf:group>
			</xf:group>
			<xf:group class="defaultbox" id="" style="">
					<w2:textbox class="df_tt" id="" label="조직도 트리" style="" tagname="h3"></w2:textbox>
				</xf:group>
			<w2:treeview tooltipGroupClass="false" dataType="listed" lineShow="" style="height:470px" id="trvTcfDeptList" useDrag="" class="autoHeight" showCheckbox="true" ev:oncheckboxclick="" ev:ondblclick="" checkAllChildNodes="" showTreeDepth="1" ev:onlabelclick="scwin.trvTcfDeptList_onlabelclick" ev:onclick="scwin.trvTcfDeptList_onclick" falseValue="0" trueValue="1" toggleButtonEvent="" toggleEvent="none" checkboxDisabledTrueValue="N" checkboxDisabledFalseValue="Y">
					<w2:itemset nodeset="data:dsTcfDeptList">
							<w2:label ref="deptNm"></w2:label>
							<w2:value ref="deptCd"></w2:value>
							<w2:depth ref="deptLv"></w2:depth>
							<w2:folder ref=""></w2:folder>
							<w2:checkbox ref="check"></w2:checkbox>
							<w2:checkboxDisabled ref="rdeptYn"></w2:checkboxDisabled>
							<w2:image ref=""></w2:image>
							<w2:iconImage ref=""></w2:iconImage>
							<w2:selectedImage ref=""></w2:selectedImage>
							<w2:expandedImage ref=""></w2:expandedImage>
							<w2:leafImage ref=""></w2:leafImage>
					</w2:itemset>
			</w2:treeview>
			<xf:group class="bottombox" id="" style="">
				<w2:anchor class="btn_gcm" clickEventElement="outerDiv" id="btnConfirm" outerDiv="false" style="" localeRef="" ev:onclick="scwin.btnConfirm_onclick">
					<xf:label><![CDATA[확인]]></xf:label>
				</w2:anchor>
				<w2:anchor class="btn_gcm" clickEventElement="outerDiv" id="btnCancel" outerDiv="false" style="" ev:onclick="scwin.btnCancel_onclick">
					<xf:label><![CDATA[취소]]></xf:label>
				</w2:anchor>
			</xf:group>
		</xf:group>


	</body>
</html>
