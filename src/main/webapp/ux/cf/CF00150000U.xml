<?xml version="1.0" encoding="UTF-8"?>
<!-- <?xml-stylesheet href="/src/main/webapp/resources_ux/css/common.css" type="text/css"?>
<?xml-stylesheet href="/src/main/webapp/resources_ux/css/content.css" type="text/css"?> -->

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:w2="http://www.inswave.com/websquare"
	xmlns:xf="http://www.w3.org/2002/xforms">
	<head>
		<w2:type>DEFAULT</w2:type>
		<w2:buildDate />
		<xf:model>
			<xf:instance>
				<data xmlns="" />
			</xf:instance>
			<w2:dataCollection baseNode="map">
				<w2:dataList baseNode="list" repeatNode="map" style="" id="dsTcfAuthGrpList" saveRemovedData="true" ev:oncelldatachange="scwin.dsTcfAuthGrpList_oncelldatachange" ev:ondataload="scwin.dsTcfAuthGrpList_ondataload">
					<w2:columnInfo>
						<w2:column id="authGrpId" name="권한그룹ID" dataType="text"></w2:column>
						<w2:column id="authGrpNm" name="권한그룹명" dataType="text"></w2:column>
						<w2:column id="prcgAttrCd" name="처리숙성코드[CF069]" dataType="text"></w2:column>
						<w2:column id="prcgAuthGrpCd" name="처리권한그룹코드[CF039]" dataType="text"></w2:column>
						<w2:column id="concatSctrLvCd" name="부분레벨코드CONCAT(구분값 ,)" dataType="text"></w2:column>
						<w2:column id="concatSctrLvCdNm" name="부분레벨명CONCAT(구분값 ,)" dataType="text" importFormatter=""></w2:column>
						<w2:column id="aplyTargCnt" name="적용대상CNT" dataType="text"></w2:column>
						<w2:column id="inqrSctrCnt" name="조회부문CNT" dataType="text"></w2:column>
					</w2:columnInfo>
					<w2:data use="false">
					</w2:data>
				</w2:dataList>
				<w2:dataList baseNode="list" id="dsTcfUserList" repeatNode="map" saveRemovedData="true" style="">
					<w2:columnInfo>
						<w2:column id="authGrpId" name="권한그룹ID" dataType="text"></w2:column>
						<w2:column id="deptusId" name="부서및 사용자ID" dataType="text"></w2:column>
						<w2:column id="authGrpGbCd" name="권한그룹구분코드[CF038]" dataType="text"></w2:column>
						<w2:column id="deptUserNm" name="사용부서사용자명" dataType="text"></w2:column>
						<w2:column id="deptName" name="부서명" dataType="text"></w2:column>
						<w2:column id="useValdStrtDt" name="사용유효시작일자" dataType="text"></w2:column>
						<w2:column id="useValdEndDt" name="사용유효종료일자" dataType="text"></w2:column>
						<w2:column id="lwrkIncluYn" name="포함여부" dataType="text"></w2:column>
					</w2:columnInfo>
					<w2:data use="false"></w2:data>
				</w2:dataList>
				<w2:dataList baseNode="list" repeatNode="map" id="dsTcfDeptList" saveRemovedData="true">
					<w2:columnInfo>
						<w2:column id="authGrpId" name="권한그룹ID" dataType="text"></w2:column>
						<w2:column id="deptusId" name="부서및 사용자ID" dataType="text"></w2:column>
						<w2:column id="authGrpGbCd" name="권한그룹구분코드[CF038]" dataType="text"></w2:column>
						<w2:column id="deptUserNm" name="사용부서사용자명" dataType="text"></w2:column>
						<w2:column id="deptName" name="부서명" dataType="text"></w2:column>
						<w2:column id="useValdStrtDt" name="사용유효시작일자" dataType="text"></w2:column>
						<w2:column id="useValdEndDt" name="사용유효종료일자" dataType="text"></w2:column>
						<w2:column id="lwrkIncluYn" name="포함여부" dataType="text"></w2:column>
					</w2:columnInfo>
					<w2:data use="false"></w2:data>
				</w2:dataList>
			</w2:dataCollection>
			<w2:workflowCollection></w2:workflowCollection>
		</xf:model>

		<script type="javascript" lazy="false"><![CDATA[
     /***************************************************************************
     * Program ID : CF00150000U.xml 
     * Program Name : 권한그룹관리 
     * Author : 남상열 (tpnsr)
     * Date : 2019.02.14
     * 
     * History 
     * ======================================== 
     * 변경일자     수정자   내 용 
     * ======================================== 
     *     
     **************************************************************************/
	/************************************************************************************
     *  [1] 전역변수 
     ************************************************************************************/
	scwin.svcId         = "";
	scwin.deptUserGubun = "";
	scwin.authRowPositon = 0;
	scwin.confirmMsg = "저장안된 권한선택 작업이 진행중입니다. \r\n저장하지 않고 새 작업을 진행하시겠습니까?";
	
    /************************************************************************************ 
     *  [2] onpageload(초기화포함)
     ************************************************************************************/   
    scwin.onpageload = function() {
    
    	var opt = [
	        		 {"CF069":["grdAuthGrp:prcgAttrCd"]}    	// 처리숙성코드[CF069]
	        		,{"CF039":["grdAuthGrp:prcgAuthGrpCd"]}   	// 처리권한그룹코드[CF039]
	        		,{"CF070":["grdAuthGrp:concatSctrLvCd"]}   	// 부문레벨코드[CF070]
	      		   ];
	    com.setCdComp(opt);
	    
	    //권한그룹그리드 조회
	    scwin.fnGrdAuthGrpSearch();

		scwin.initScreen();
         
    };

    scwin.onpageunload = function() {
		
	};

	// 화면 초기화(필수)
	scwin.initScreen = function() {
	
	}; 
	

	/**************************************************************************
	 *  [3] 사용자정의 함수
	 **************************************************************************/
	
    /**************************************************************************
	* 함 수 명: scwin.fnGrdAuthGrpSearch
	* 기 능: 권한그룹 조회
	**************************************************************************/
	scwin.fnGrdAuthGrpSearch = function(){
	
		scwin.svcId = "selectTcfAuthGrp";
        ajaxLib.ajax("/cf/CF00150000U/selectTcfAuthGrpMasterList", {
        	  mode        : "asynchronous"
        	, method      : "POST"
            , requestData : "" 
            , callback    : "fnCallback"
            , errCallback : "fnErrCallBack"
        });
	
	};
	
    /**************************************************************************
	* 함 수 명: scwin.fnGrdAuthGrpSearch
	* 기 능: 권한그룹 조회
	**************************************************************************/
	scwin.fnGrdDeptUserSearch = function(authGrpId,keyAuthGrpGbCd){
	
		scwin.svcId = "selectTcfAuthGrpAplyTarg";
        ajaxLib.ajax("/cf/CF00150000U/selectTcfAuthGrpAplyTarg", {
        	  mode        : "synchronous"
        	, method      : "POST"
            , requestData : {
                               authGrpId      : authGrpId 
                              ,keyAuthGrpGbCd : keyAuthGrpGbCd 
                            } 
            , callback    : "fnCallback"
            , errCallback : "fnErrCallBack"
        });
	
	};
	
    /**************************************************************************
	* 함 수 명: scwin.fnValidate
	* 기 능: 유효성체크
	**************************************************************************/
	scwin.fnValidate = function() {
	
		var validInfo = [
			 { id: "authGrpNm"    , mandatory: true }//권한그룹
			,{ id: "prcgAttrCd"   , mandatory: true }//처리속성
			,{ id: "prcgAuthGrpCd", mandatory: true }//처리권한
		];

		//data유효성체크	
		if (!com.validateGridView(grdAuthGrp, validInfo)) {
			return false;
		}
		
		var insertCount = dsTcfAuthGrpList.getInsertedJSON().length;
		var updateCount = dsTcfAuthGrpList.getUpdatedJSON().length;
		
		if((insertCount + updateCount) == 0)
		{
			com.showMessage('CFW0010','수정된 권한그룹이 없습니다.');
			return false;
		}
		
		
		
		
		var obj = null
		var booleanValidate = false;
		$.each(dsTcfAuthGrpList.getModifiedIndex(),function(index,item){
			obj = dsTcfAuthGrpList.getRowJSON(item);
			
			if(obj.prcgAuthGrpCd == "CF03902")
			{
				if(obj.concatSctrLvCd == "")
				{
					com.showMessage("CFW0011", (item+1));			//$1번행 처리권한이 소속사업부 일때 조회부문을 설정하셔야됩니다.
					grdAuthGrp.setFocusedCell( item , "concatSctrLvCd" , true );
					booleanValidate = true;
					return false;
				}
			}
		});
		
		if(booleanValidate)
		{
			return false;
		}
		 
		return true;
	};
	
	scwin.fnDeptUserUpdateCheck = function(){
		var deptCount = dsTcfDeptList.getInsertedJSON().length + dsTcfDeptList.getUpdatedJSON().length; 
		var userCount = dsTcfUserList.getInsertedJSON().length + dsTcfUserList.getUpdatedJSON().length;
		
		if((deptCount + userCount) > 0 ) 
		{
			return false;
			
		}
		return true;
		
	};
	
	scwin.fnGetAuthGrpInfo = function(){
		var rowObj   = null;
		var rowIndex = dsTcfAuthGrpList.getRowPosition();
		    rowObj   = dsTcfAuthGrpList.getDataRow( rowIndex);
		    
        return rowObj;		    
	};
	
	
	
	/**************************************************************************
	* 함 수 명: scwin.fnSave
	* 기 능: 저장
	**************************************************************************/
	scwin.fnSave = function() {

		//유효성체크
		if(!scwin.fnValidate()) return;
		
		if (confirm("저장 하시겠습니까?")) {
	    	scwin.svcId = "saveTcfAuthGrp";
	        ajaxLib.ajax("/cf/CF00150000U/saveTcfAuthGrp", {
	        	  mode        : "asynchronous"
	        	, method      : "POST"
	            , requestData : { 
	                              authGrpList : dsTcfAuthGrpList.getModifiedJSON()
	                            } 
	            , callback    : "fnCallback"
	            , errCallback : "fnErrCallBack"
	        });
    	}
    	
	};
	
	/**************************************************************************
	* 함 수 명: scwin.fnDelete
	* 기 능: 삭제
	**************************************************************************/
	scwin.fnDelete = function() {
    	scwin.svcId = "deleteTcfAuthGrp";
    	
        ajaxLib.ajax("/cf/CF00150000U/deleteTcfAuthGrp", {
        	  mode        : "asynchronous"
        	, method      : "POST"
            , requestData : dsTcfAuthGrpList.getModifiedJSON()[0]
            , callback    : "fnCallback"
            , errCallback : "fnErrCallBack"
        });
	};
	
	/**************************************************************************
	 * 함 수 명: scwin.fnCheckAuthGrpSel
	 * 기 능: 권한그룹 그리드 선택유무
	**************************************************************************/
    scwin.fnCheckAuthGrpSel = function(){
     	
     	var rowIndex  = dsTcfAuthGrpList.getRowPosition();
    	var authGrpId = dsTcfAuthGrpList.getCellData( rowIndex , "authGrpId" );
    	
    	if(authGrpId == "" )
    	{
    		com.showMessage("CFW0012"); //권한그룹을 선택해야 부서선택및 사용자선택을 할수 있습니다.
    		//CFW0012
    		return false;
    	}
    
    	return true;
    };
    
    /**************************************************************************
	* 함 수 명: scwin.fnApllyTargerSave
	* 기 능: 적용대상 저장
	**************************************************************************/
	scwin.fnApllyTargerSave = function() {
	
		if(!scwin.fnApplyTargetValidate()) return;
		
		if (confirm("저장 하시겠습니까?")) {
	    	scwin.svcId = "saveTcfAuthGrpAplyTarg";
	        ajaxLib.ajax("/cf/CF00150000U/saveTcfAuthGrpAplyTarg", {
	        	  mode        : "synchronous"
	        	, method      : "POST"
	            , requestData : { 
	                              authGrpAplyTargList : scwin.fnGetApplyTargetData()
	                            } 
	            , callback    : "fnCallback"
	            , errCallback : "fnErrCallBack"
	        });
    	}
    	
	};
	
	/**************************************************************************
	* 함 수 명: scwin.fnApllyTargerSave
	* 기 능: 적용대상 저장
	**************************************************************************/
	scwin.fnApllyTargerDelete = function(deptUserGubun) {
	
		var deleteData = null;
		
		if("" != deptUserGubun && deptUserGubun == "dept")
		{
			deleteData = dsTcfDeptList.getDeletedJSON()[dsTcfDeptList.getDeletedJSON().length-1];
		}
		else if("" != deptUserGubun && deptUserGubun == "user")
		{
			deleteData = dsTcfUserList.getDeletedJSON()[dsTcfUserList.getDeletedJSON().length-1];;
		}
		
		scwin.deptUserGubun = deptUserGubun;
		
    	scwin.svcId = "deleteTcfAuthGrpAplyTarg";
        ajaxLib.ajax("/cf/CF00150000U/deleteTcfAuthGrpAplyTarg", {
        	  mode        : "asynchronous"
        	, method      : "POST"
            , requestData : deleteData 
            , callback    : "fnCallback"
            , errCallback : "fnErrCallBack"
        });
    	
	};
	
	scwin.fnApplyTargetValidate = function(){
	
		var retunBoolean = true;
	
		//사용부서 선택 그리드에서 수정된 데이터
		var deptIdxArr = dsTcfDeptList.getModifiedIndex();
		
		//사용자 선택 그리드에선 수정된데이터 
		var userIdxArr = dsTcfUserList.getModifiedIndex();
		
		//사용부서 유효성체크
		$.each(deptIdxArr,function(index, row){
			var obj = dsTcfDeptList.getRowJSON(row);
			
			if(obj.rowStatus == "C" || obj.rowStatus == "U"){				 
				if (strLib.isEmpty(obj.useValdStrtDt, false)) {
					
					com.showMessage('CFW0013','사용부서',(row+1) + '번째 시작일자를(을)'); 
					dsTcfDeptList.setFocusedCell( row , "useValdStrtDt" , true );
					retunBoolean = false;
					return false;
				}
				
				if (strLib.isEmpty(obj.useValdEndDt, false)) {
					com.showMessage('CFW0013','사용부서',(row+1)+'번째 종료일자를(을)');
					
					dsTcfDeptList.setFocusedCell( row, "useValdEndDt" , true );
					retunBoolean = false;
					return false;
				}
				
				if(Number(obj.useValdStrtDt) >= Number(obj.useValdEndDt) )
				{
					com.showMessage('CFW0010','사용부서 선택그리드'+(row+1) + '번째 시작일자가 종료일자보다 빠르거나 같을수 없습니다.'); 
					
					dsTcfDeptList.setFocusedCell( row , "useValdStrtDt" , true );
					retunBoolean = false;
					return false;
				}
			}
		});
		
		//사용자 유효성체크
		$.each(userIdxArr,function(index, row){
			var obj = dsTcfUserList.getRowJSON(row);
			
			if(obj.rowStatus == "C" || obj.rowStatus == "U"){				 
				if (strLib.isEmpty(obj.useValdStrtDt, false)) {
					com.showMessage('CFW0013','사용자',(row+1)+'번째 시작일자를(을)');
					dsTcfUserList.setFocusedCell( row , "useValdStrtDt" , true );
					retunBoolean = false;
					return false;
				}
				
				if (strLib.isEmpty(obj.useValdEndDt, false)) {
					com.showMessage('CFW0013','사용자',(row+1)+'번째 종료일자를(을)');
					dsTcfUserList.setFocusedCell( row, "useValdEndDt" , true );
					retunBoolean = false;
					return false;
				}
				
				if(Number(obj.useValdStrtDt) >= Number(obj.useValdEndDt) )
				{
					com.showMessage('CFW0010','사용자 선택그리드'+(row+1) + '번째 시작일자가 종료일자보다 빠르거나 같을수 없습니다.');
					dsTcfUserList.setFocusedCell( row , "useValdStrtDt" , true );
					retunBoolean = false;
					return false;
				}
			}
		});
		
		var modiJson01 = dsTcfDeptList.getModifiedJSON();
		var modiJson02 = dsTcfUserList.getModifiedJSON();
		if ((modiJson01.length + modiJson02.length)  == 0) {
			com.showMessage('CFW0010','저장 할 데이터가 없습니다.');
			return false;
		}
		
		
		return retunBoolean;
	};
    
    /**************************************************************************
	 * 함 수 명: scwin.fnGetApplyTargetData
	 * 기 능: 권한그룹 적용대상 데이터세팅
	**************************************************************************/
	scwin.fnGetApplyTargetData = function()
	{
		var arr = new Array();
		
		//사용부서 선택 그리드에서 수정된 데이터
		var modifyDeptJsonData = dsTcfDeptList.getModifiedJSON();
		//사용자 선택 그리드에선 수정된데이터 
		var modifyUserJsonData = dsTcfUserList.getModifiedJSON();
		
		//사용부서 선택그리드에서 삭제가 아닐시 arr 에 push
		if(modifyDeptJsonData.length > 0)
		{
			$.each(modifyDeptJsonData,function(index, item){
				//삭제가아닐시 	
				if(item.rowStatus != "E")
				{
					arr.push(item);
				}
			});
		}
		
		//사용자 선택그리드에서 삭제가 아닐시 arr 에 push
		if(modifyUserJsonData.length > 0)
		{
			$.each(modifyUserJsonData,function(index, item){
				
				//삭제가아닐시 	
				if(item.rowStatus != "E")
				{
					arr.push(item);
				}
			});
		}
		
		//console.log(arr);
		
		return arr;
	};
	    
		
	/**************************************************************************
	 *  [4] Callback
	 **************************************************************************/
	
	/* 결과 후처리*/
	scwin.fnCallback = function(result, e) {
        console.log(e);
        
	   	switch(scwin.svcId) {
	   		case "selectTcfAuthGrp" :
	   			dsTcfAuthGrpList.setJSON(result.data.tcfAuthGrpMasterList);
	   			console.log('search Error!!!!!!!!!!!');
	   			break;
	   		case "selectTcfAuthGrpAplyTarg" :
	   			var keyAuthGrpGbCd = result.data.keyAuthGrpGbCd;
	   			var gridData       = result.data.authGrpAplyTargList;
	   			
	   			if("CF03801" == keyAuthGrpGbCd)
	   			{// 부서그리드
	   				dsTcfDeptList.setJSON(gridData)
	   			}
	   			else if("CF03802" == keyAuthGrpGbCd)
	   			{//사용자
	   				dsTcfUserList.setJSON(gridData)
	   			}
	   			
	   			console.log('search Error!!!!!!!!!!!');
	   			break;
	   		case "saveTcfAuthGrpAplyTarg" :
	   			com.showMessage("SCN0002", "저장");			//$1 되었습니다.
	   			
	   			var rowIndex  = dsTcfAuthGrpList.getRowPosition();
	   			var authGrpId = dsTcfAuthGrpList.getCellData( rowIndex , "authGrpId" );
	   			
	   			//사용부서
				scwin.fnGrdDeptUserSearch(authGrpId,"CF03801");
				
				//사용자
				scwin.fnGrdDeptUserSearch(authGrpId,"CF03802");
	   			
	   			break;
	   		case "deleteTcfAuthGrpAplyTarg" :
	   			com.showMessage("SCN0002", "삭제");			//$1 되었습니다.
	   			
	   			var rowIndex  = dsTcfAuthGrpList.getRowPosition();
	   			var authGrpId = dsTcfAuthGrpList.getCellData( rowIndex , "authGrpId" );
	   			
	   			if(scwin.deptUserGubun == "dept")
	   			{
					//사용부서
					scwin.fnGrdDeptUserSearch(authGrpId,"CF03801");
	   			}
	   			else if(scwin.deptUserGubun == "uesr")
	   			{
					//사용자
					scwin.fnGrdDeptUserSearch(authGrpId,"CF03802");
	   			}
	   			
	   			scwin.deptUserGubun = "";
				
	   			
	   			break;
	   		case "saveTcfAuthGrp" :
	   			com.showMessage("SCN0002", "저장");			//$1 되었습니다.
	   			scwin.fnGrdAuthGrpSearch();
	   			
	   			grdDeptSel.initGrid();
	   			grdUserSel.initGrid();
	   			
	   			break;
	   		case "deleteTcfAuthGrp" :
	   			com.showMessage("SCN0002", "삭제");			//$1 되었습니다.
	   			scwin.fnGrdAuthGrpSearch();
	   			grdDeptSel.initGrid();
	   			grdUserSel.initGrid();
	   			break;
	   }        
	};
	
	/* 에러 후처리 */
    scwin.fnErrCallBack = function(e) {
        console.log(e);
        
	   	switch(scwin.svcId) {
	   		case "selectTcfAuthGrp" :
	   			console.log('search Error!!!!!!!!!!!');
	   			break;
	   		case "selectTcfAuthGrpAplyTarg" :
	   			console.log('search Error!!!!!!!!!!!');
	   			break;
	   		case "saveTcfAuthGrpAplyTarg" :
	   			console.log('search Error!!!!!!!!!!!');
	   			break;
	   		case "deleteTcfAuthGrpAplyTarg" :
	   			console.log('search Error!!!!!!!!!!!');
	   			break;
	   		case "saveTcfAuthGrp" :
	   			console.log('search Error!!!!!!!!!!!');
	   			break;
	   		case "deleteTcfAuthGrp" :
	   			console.log('search Error!!!!!!!!!!!');
	   			break;
	   }        
    };
    
    /**************************************************************************
	 * 함 수 명: scwin.popDeptSelectCallback
	 * 기 능: 부서선택 팝업 콜백 method
	**************************************************************************/
    scwin.popDeptSelectCallback = function(arg){
    	
    	var rowIndex  = dsTcfAuthGrpList.getRowPosition();
    	var authGrpId = dsTcfAuthGrpList.getCellData( rowIndex , "authGrpId");
    	
    	$.each(arg,function(index, item){
    		
    		//권한 그룹ID 중복체크 
    		var duplicationArr = dsTcfDeptList.getMatchedIndex( "deptusId" , item.deptCd ,true );
    		
    		if(duplicationArr.length > 0)
    		{
    			return true;
    		}
    		
    		if(item.deptCd != "")
    		{
    			var insertRowIndex = dsTcfDeptList.insertRow();
    			
    			dsTcfDeptList.setCellData( insertRowIndex , "authGrpId"     , authGrpId );
    			dsTcfDeptList.setCellData( insertRowIndex , "deptusId"      , item.deptCd );
    			dsTcfDeptList.setCellData( insertRowIndex , "authGrpGbCd"   , "CF03801" );
    			dsTcfDeptList.setCellData( insertRowIndex , "deptUserNm"    , item.deptNm );
    			dsTcfDeptList.setCellData( insertRowIndex , "useValdStrtDt" , $w.getCurrentServerDate( "yyyyMMdd" ) );
    			dsTcfDeptList.setCellData( insertRowIndex , "useValdEndDt"  , "99991231" );
    			dsTcfDeptList.setCellData( insertRowIndex , "lwrkIncluYn"  , "0" );
    		}
    	});
    };
    
    /**************************************************************************
	 * 함 수 명: scwin.popUserSelectCallback
	 * 기 능: 사용자선택 팝업 콜백 method
	**************************************************************************/
    scwin.popUserSelectCallback = function(arg){
    	var rowIndex  = dsTcfAuthGrpList.getRowPosition();
    	var authGrpId = dsTcfAuthGrpList.getCellData( rowIndex , "authGrpId");
    	
    	$.each(arg,function(index, item){
    		
    		//권한 그룹ID 중복체크 
    		var duplicationArr = dsTcfUserList.getMatchedIndex( "deptusId" , item.userEmpno ,true );
    		
    		if(duplicationArr.length > 0)
    		{
    			return true;
    		}
    		
    		if(item.userEmpno != "")
    		{
    			var insertRowIndex = dsTcfUserList.insertRow();
    			
    			dsTcfUserList.setCellData( insertRowIndex , "authGrpId"     , authGrpId );
    			dsTcfUserList.setCellData( insertRowIndex , "deptusId"      , item.userEmpno );
    			dsTcfUserList.setCellData( insertRowIndex , "authGrpGbCd"   , "CF03802" );
    			dsTcfUserList.setCellData( insertRowIndex , "deptUserNm"    , item.userNm );
    			dsTcfUserList.setCellData( insertRowIndex , "deptName"      , item.deptNm );
    			dsTcfUserList.setCellData( insertRowIndex , "useValdStrtDt" , $w.getCurrentServerDate( "yyyyMMdd" ) );
    			dsTcfUserList.setCellData( insertRowIndex , "useValdEndDt"  , "99991231" );
    		}
    	});
	};	
	
   /************************************************************************************
    *  [5] Event 함수 
    ************************************************************************************/
    /**************************************************************************
	* Event: scwin.btnAddRowGrdAuthGrp_onclick
	* 기 능: 권한그룹 그리드 ADD ROW
	**************************************************************************/
	scwin.btnAddRowGrdAuthGrp_onclick = function() {
	
		//권한선택 작업중 체크
		if(!scwin.fnDeptUserUpdateCheck())
		{
			if(!confirm( scwin.confirmMsg ))
			{
				return;
			}
			else
			{
				grdDeptSel.initGrid();
				grdUserSel.initGrid();
			}
		}
		
		var rowIndex = dsTcfAuthGrpList.insertRow();
		
		
		dsTcfAuthGrpList.setCellData( rowIndex , "prcgAttrCd"    , "CF06902" );
		dsTcfAuthGrpList.setCellData( rowIndex , "prcgAuthGrpCd" , "CF03901" );
		
	};
	
    /**************************************************************************
	* Event: scwin.btnDelRowGrdAuthGrp_onclick
	* 기 능: 권한그룹 그리드 DEL ROW
	**************************************************************************/
	scwin.btnDelRowGrdAuthGrp_onclick = function() {
	
		//권한선택 작업중 체크
		if(!scwin.fnDeptUserUpdateCheck())
		{
			if(!confirm( scwin.confirmMsg ))
			{
				return;
			}
			else
			{
				grdDeptSel.initGrid();
				grdUserSel.initGrid();
			}
		}
	
		var rowIndex  = 0;
		if (grdAuthGrp.getFocusedRowIndex() == -1)
	    {
    		com.showMessage('CFW0010','삭제할 행을 선택 하세요.');
    		
    		return;
		}
		 else
		{
			rowIndex  = grdAuthGrp.getFocusedRowIndex();
			
			var deleteJsonData = dsTcfAuthGrpList.getDataRow( rowIndex );
			
			if(Number(deleteJsonData.aplyTargCnt) > 0)
			{
				if (confirm("그룹적용대상이 있습니다. 삭제하시겠습니까>")) {
					dsTcfAuthGrpList.removeRow( rowIndex );
				}
			}
			else
			{
				dsTcfAuthGrpList.removeRow( rowIndex );
			}
			
			//데이터 삭제
			if(dsTcfAuthGrpList.getDeletedJSON().length > 0)
			{
				scwin.fnDelete();
			}
		} 
	};
	
	/**************************************************************************
	* Event: scwin.btnSave_onclick
	* 기 능: 권한그룹 그리드 DEL ROW
	**************************************************************************/
	scwin.btnSave_onclick = function() {
	
		scwin.fnApllyTargerSave();
	};

	/**************************************************************************
	* Event: scwin.dsTcfAuthGrpList_oncelldatachange
	* 기 능: 권한그룹 그리드 조회부문 데이터변경시
	**************************************************************************/
	scwin.dsTcfAuthGrpList_oncelldatachange = function(info) {
	
		//처리권한
		if(info.colID == "prcgAuthGrpCd")
		{
			if(info.newValue == "CF03902")
			{//소속사업부 disable false 
				grdAuthGrp.setDisabled( "cell" , info.rowIndex , "concatSctrLvCd" , false );
			}
			else
			{// 전사 , 소속팀 disable true
				dsTcfAuthGrpList.setCellData( info.rowIndex , "concatSctrLvCd"   , "");
				dsTcfAuthGrpList.setCellData( info.rowIndex , "concatSctrLvCdNm" , "");
				grdAuthGrp.setDisabled( "cell" , info.rowIndex , "concatSctrLvCd" , true );
			}
		}
		
		//조회부문 
		if(info.colID == "concatSctrLvCd")
		{
			dsTcfAuthGrpList.setCellData( info.rowIndex , "concatSctrLvCdNm" , grdAuthGrp.getCellDisplayData(info.rowIndex,"concatSctrLvCd")); 
		}
	};
	
	/**************************************************************************
	* Event: scwin.btnSaveAuthGrp_onclick
	* 기 능: 권한그룹저장
	**************************************************************************/
	scwin.btnSaveAuthGrp_onclick = function() {
		//권한선택 작업중 체크
		if(!scwin.fnDeptUserUpdateCheck())
		{
			if(!confirm( scwin.confirmMsg ))
			{
				return;
			}
			else
			{
				grdDeptSel.initGrid();
				grdUserSel.initGrid();
			}
		}

		scwin.fnSave();
	};
	
	/**************************************************************************
	* Event: scwin.grdAuthGrp_oncellclick
	* 기 능: 권한그룹 그리드 원클릭시 적용대상 그리드 조회 
	**************************************************************************/
	scwin.grdAuthGrp_oncellclick = function(row,col) {
	
		var colId = grdAuthGrp.getColumnID( col );
	
		if(colId == "authGrpNm")
		{
			//권한선택 작업중 체크
			if(!scwin.fnDeptUserUpdateCheck())
			{
				if(!confirm( scwin.confirmMsg ))
				{
					grdAuthGrp.setFocusedCell( scwin.authRowPositon ,0,false );
					return;
				}
				else
				{
					grdDeptSel.initGrid();
					grdUserSel.initGrid();
				}
			}
			
			scwin.authRowPositon = row;
			var authGrpId = dsTcfAuthGrpList.getCellData( row , "authGrpId" );
			
			//사용부서
			scwin.fnGrdDeptUserSearch(authGrpId,"CF03801");
					
			//사용자
			scwin.fnGrdDeptUserSearch(authGrpId,"CF03802");	
		}
		
	};
	
	/**************************************************************************
	* Event: scwin.dsTcfAuthGrpList_ondataload
	* 기 능: 권한그룹 그리드 데이터 load시 처리권한에 따른 조회부분 cell 
	**************************************************************************/
	scwin.dsTcfAuthGrpList_ondataload = function() {
		
		$.each(dsTcfAuthGrpList.getAllJSON(),function(index, item){
		
			if(item.prcgAuthGrpCd == "CF03902")
			{//소속사업부 일시 조회부문 cell disable fasle
				//console.log("1");
				grdAuthGrp.setDisabled( "cell" , index , "concatSctrLvCd" , false );
			}
			else
			{//전사 , 소속팀일시 조회부문 cell disable true
				//console.log("2");
				grdAuthGrp.setDisabled( "cell" , index , "concatSctrLvCd" , true );
			}
		});
	};
	
	/**************************************************************************
	* Event: scwin.btnDeptInfoSel_onclick
	* 기 능: 권한그룹 사용부서 적용대상 호출팝업 
	**************************************************************************/
	scwin.btnDeptInfoSel_onclick = function() {
		
		if(!scwin.fnCheckAuthGrpSel()) return;
		
		var popOps = {
				popup_name :"부서선택"
		       ,url        :"/ux/cf/CF00051003P.xml"
		       ,data       :  {checkChild : "false" }
		       ,widType    : "M"
		       ,height     :"720"
		       ,callbackFn : "scwin.popDeptSelectCallback"
		    };
		com.popup_open(popOps);	
		
	};
	
	/**************************************************************************
	* Event: scwin.btnDelRowGrdDept_onclick
	* 기 능: 권한그룹 사용부서 적용대상그리드 Delete Row 
	**************************************************************************/
	scwin.btnDelRowGrdDept_onclick = function() {
		var rowIndex  = 0;
		if (grdDeptSel.getFocusedRowIndex() == -1)
	    {
    		com.showMessage('CFW0010','삭제할 행을 선택 하세요.');
    		return;
		}
		 else
		{
			rowIndex  = grdDeptSel.getFocusedRowIndex();
			dsTcfDeptList.removeRow( rowIndex );
			
			//데이터 삭제
			if(dsTcfDeptList.getDeletedJSON().length > 0)
			{
				scwin.fnApllyTargerDelete("dept");
			}
		} 
	};
	
	/**************************************************************************
	* Event: scwin.btnUserInfoSel_onclick
	* 기 능: 권한그룹 사용자 적용대상 호출팝업 
	**************************************************************************/
	scwin.btnUserInfoSel_onclick = function() {
		
		if(!scwin.fnCheckAuthGrpSel()) return;
		
		var popOps = {
				popup_name :"사용자선택"
		       ,url        :"/ux/cf/CF00050503P.xml"
		       ,data       :  { }
		       ,width      :"1400"
		       ,height     :"540"
		       ,callbackFn : "scwin.popUserSelectCallback"
		    };
		com.popup_open(popOps);	
		
	};
	
	/**************************************************************************
	* Event: scwin.btnDelRowGrdUser_onclick
	* 기 능: 권한그룹 사용자 적용대상 그리드 Delete Row 
	**************************************************************************/
	scwin.btnDelRowGrdUser_onclick = function() {
		var rowIndex  = 0;
		if (grdUserSel.getFocusedRowIndex() == -1)
	    {
    		com.showMessage('CFW0010','삭제할 행을 선택 하세요.');
    		return;
		}
		 else
		{
			rowIndex  = grdUserSel.getFocusedRowIndex();
			dsTcfUserList.removeRow( rowIndex );
			
			//데이터 삭제
			if(dsTcfUserList.getDeletedJSON().length > 0)
			{
				scwin.fnApllyTargerDelete("user");
			}
			
		} 
	};
	
	/**************************************************************************
	* Event: btnDetailInit_onclick
	* 기 능: 권한그룹 그리드 초기화 
	**************************************************************************/
	scwin.btnDetailInit_onclick = function() {
		grdAuthGrp.removeFocusedCell();
		grdDeptSel.initGrid();
		grdUserSel.initGrid();
		 
	};
	]]></script>
		
		
	</head>
	<body ev:onpageload="scwin.onpageload" ev:onpageunload="scwin.onpageunload">
		<xf:group style="" id="" class="content_body">
			<xf:group class="navigator_wrap" id="" style="">
				<w2:wframe id="wfrTitle" src="/ux/common/navigator.xml" style=""></w2:wframe>
				<xf:group class="btn_wrap" id="" style="" tagname="">
					<w2:anchor class="btn_cmm" clickEventElement="outerDiv" id="btnInit" outerDiv="false" style="" ev:onclick="scwin.btnDetailInit_onclick">
						<xf:label><![CDATA[초기화]]></xf:label>
					</w2:anchor>
					<w2:anchor class="btn_cmm gray" clickEventElement="outerDiv" id="btnSave" outerDiv="false"
						style="" ev:onclick="scwin.btnSave_onclick">
						<xf:label><![CDATA[저장]]></xf:label>
					</w2:anchor>
				</xf:group>
			</xf:group>
			<xf:group class="lybox_wrap col_4_3_3" id="" style="">
				<xf:group class="lybox" id="" style="">
					<xf:group class="lycolumn" id="" style="">
						<xf:group class="lyinner" id="" style="">
							<xf:group class="defaultbox" id="" style="">
								<w2:textbox class="df_tt" id="" label="권한그룹" style="" tagname="h3"></w2:textbox>
								<xf:group class="right_wrap" id="" style="">
									<xf:group class="" id="" style="">
										<w2:anchor class="btn_gcm" id="btnSaveAuthGrp" outerDiv="false" style="" ev:onclick="scwin.btnSaveAuthGrp_onclick">
											<xf:label><![CDATA[권한그룹 저장]]></xf:label>
										</w2:anchor>
										<w2:anchor class="btn_gcm row_add" clickEventElement="" id="btnAddRowGrdAuthGrp"
											outerDiv="false" style="" toolTip="행추가" ev:onclick="scwin.btnAddRowGrdAuthGrp_onclick">
											<xf:label><![CDATA[행추가]]></xf:label>
										</w2:anchor>
										<w2:anchor class="btn_gcm row_del" clickEventElement="" id="btnDelRowGrdAuthGrp"
											outerDiv="false" style="" toolTip="행삭제" ev:onclick="scwin.btnDelRowGrdAuthGrp_onclick">
											<xf:label><![CDATA[행삭제]]></xf:label>
										</w2:anchor>
									</xf:group>
								</xf:group>
							</xf:group>
							<w2:gridView autoFit="allColumn" class="autoHeight" dataList="data:dsTcfAuthGrpList"
								fixedColumnWithHidden="" focusMode="both" id="grdAuthGrp" readOnly="true" rowNumHeaderValue="No" rowNumVisible=""
								rowStatusHeaderValue="" rowStatusVisible="" rowStatusWidth="30" scrollByColumn="false" style="height:404px;"
								useShiftKey="true" visibleRowNum="" tooltipDisplay="true" ev:onviewchange="" ev:oncellclick="scwin.grdAuthGrp_oncellclick" selectedRowColor="" editModeEvent="onclick">
								<w2:header id="header1" style="">
									<w2:row id="row2" style="">
										<w2:column blockSelect="false" id="column23" inputType="text" style=""
											value="권한그룹" width="150">
										</w2:column>
										<w2:column blockSelect="false" displayMode="label" id="column27"
											inputType="text" removeBorderStyle="false" style="" value="처리권한" width="80" hidden="true">
										</w2:column>
										<w2:column blockSelect="false" displayMode="label" id="column25"
											inputType="text" removeBorderStyle="false" style="" value="처리범위" width="80" hidden="false">
										</w2:column>
										<w2:column removeBorderStyle="false" width="100" inputType="text" style=""
											id="column28" value="조회부문" blockSelect="false" displayMode="label" hidden="true">
										</w2:column>
									</w2:row>
								</w2:header>
								<w2:gBody id="gBody4" style="">
									<w2:row id="row5" style="">
										<w2:column blockSelect="false" id="authGrpNm" inputType="text" readOnly="false"
											style="" textAlign="left" value="" viewType="icon" width="150">
										</w2:column>
										<w2:column blockSelect="false" displayMode="label" id="prcgAttrCd"
											renderType="radiogroup" inputType="select" readOnly="false" removeBorderStyle="false" style="" value=""
											viewType="icon" width="80" defaultValue="CF06901">
											<w2:choices></w2:choices>
										</w2:column>
										<w2:column blockSelect="false" displayMode="label" id="prcgAuthGrpCd"
											inputType="select" readOnly="false" removeBorderStyle="false" style="" value="전사" viewType="icon" width="80"
											defaultValue="">
											<w2:choices></w2:choices>
										</w2:column>
										<w2:column removeBorderStyle="false" width="100" inputType="checkcombobox"
											style="" id="concatSctrLvCd" value="" blockSelect="false" displayMode="label" viewType="icon"
											readOnly="false" delimiter=",">
											<w2:choices></w2:choices>
										</w2:column>
									</w2:row>
								</w2:gBody>
							</w2:gridView>
						</xf:group>
					</xf:group>
					<xf:group class="lycolumn" id="" style="">
						<xf:group class="lyinner" id="" style="">
							<xf:group class="defaultbox" id="" style="">
								<w2:textbox class="df_tt" id="" label="사용부서 선택" style="" tagname="h3"></w2:textbox>
								<xf:group class="right_wrap" id="" style="">
									<xf:group class="" id="" style="">
										<w2:anchor class="btn_gcm" id="btnDeptInfoSel" outerDiv="false" style="" ev:onclick="scwin.btnDeptInfoSel_onclick">
											<xf:label><![CDATA[부서선택]]></xf:label>
										</w2:anchor>
										<w2:anchor class="btn_gcm row_del" clickEventElement="" id="btnDelRowGrdDept"
											outerDiv="false" style="" toolTip="행삭제" ev:onclick="scwin.btnDelRowGrdDept_onclick">
											<xf:label><![CDATA[행삭제]]></xf:label>
										</w2:anchor>
									</xf:group>
								</xf:group>
							</xf:group>
							<w2:gridView autoFit="allColumn" class="autoHeight" dataList="data:dsTcfDeptList"
								fixedColumnWithHidden="" focusMode="both" id="grdDeptSel" readOnly="true" rowNumHeaderValue="No" rowNumVisible=""
								rowStatusHeaderValue="" rowStatusVisible="" rowStatusWidth="30" scrollByColumn="false" style="height:404px;"
								useShiftKey="true" visibleRowNum="">
								<w2:header id="header1" style="">
									<w2:row id="row2" style="">
										<w2:column blockSelect="false" colSpan="" id="column23" inputType="text"
											readOnly="" rowSpan="2" style="height:40px;" value="No" viewType="" width="40">
										</w2:column>
										<w2:column blockSelect="false" colSpan="" displayMode="label" id="column25"
											inputType="text" removeBorderStyle="false" rowSpan="2" style="height:69px;" value="사용부서" width="150">
										</w2:column>
										<w2:column removeBorderStyle="false" width="40" inputType="text"
											style="height:68px;" id="column37" value="하위&lt;br/&gt;포함&lt;br/&gt;여부" blockSelect="false" displayMode="label" colSpan="" rowSpan="2">
										</w2:column>
										<w2:column blockSelect="false" colSpan="2" displayMode="label" id="column29"
											inputType="text" removeBorderStyle="false" rowSpan="" style="height:34px;" value="사용기간" width="200">
										</w2:column>
									</w2:row>
									<w2:row id="row7" style="">
										<w2:column blockSelect="false" displayMode="label" id="column36"
											inputType="text" removeBorderStyle="false" style="" value="시작일자" width="100">
										</w2:column>
										<w2:column blockSelect="false" displayMode="label" id="column35"
											inputType="text" removeBorderStyle="false" style="" value="종료일자" width="100">
										</w2:column>
									</w2:row>
								</w2:header>
								<w2:gBody id="gBody4" style="">
									<w2:row id="row5" style="">
										<w2:column blockSelect="false" expression="rowindex()+1" id="col1"
											inputType="expression" readOnly="" style="" textAlign="" value="" viewType="" width="40">
										</w2:column>
										<w2:column blockSelect="false" displayMode="label" id="deptUserNm"
											inputType="text" readOnly="" removeBorderStyle="false" style="" value="" viewType="" width="150"
											textAlign="left">
										</w2:column>
										<w2:column removeBorderStyle="false" width="40" inputType="checkbox" style=""
											id="lwrkIncluYn" value="" blockSelect="false" displayMode="label" defaultValue="" readOnly="false">
										</w2:column>
										<w2:column blockSelect="false" displayMode="label" id="useValdStrtDt"
											inputType="calendar" readOnly="false" removeBorderStyle="false" style="" value="" viewType="icon"
											width="100">
										</w2:column>
										<w2:column blockSelect="false" displayMode="label" id="useValdEndDt"
											inputType="calendar" readOnly="false" removeBorderStyle="false" style="" value="" viewType="icon"
											width="100">
										</w2:column>
									</w2:row>
								</w2:gBody>
							</w2:gridView>
						</xf:group>
					</xf:group>
					<xf:group class="lycolumn" id="" style="">
						<xf:group class="lyinner" id="" style="">
							<xf:group class="defaultbox" id="" style="">
								<w2:textbox class="df_tt" id="" label="사용자 선택" style="" tagname="h3"></w2:textbox>
								<xf:group class="right_wrap" id="" style="">
									<xf:group class="" id="" style="">
										<w2:anchor class="btn_gcm" id="btnUserInfoSel" outerDiv="false" style="" ev:onclick="scwin.btnUserInfoSel_onclick">
											<xf:label><![CDATA[사용자 선택]]></xf:label>
										</w2:anchor>
										<w2:anchor class="btn_gcm row_del" clickEventElement="" id="btnDelRowGrdUser"
											outerDiv="false" style="" toolTip="행삭제" ev:onclick="scwin.btnDelRowGrdUser_onclick">
											<xf:label><![CDATA[행삭제]]></xf:label>
										</w2:anchor>
									</xf:group>
								</xf:group>
							</xf:group>
							<w2:gridView autoFit="allColumn" class="autoHeight" dataList="data:dsTcfUserList"
								fixedColumnWithHidden="" focusMode="both" id="grdUserSel" readOnly="true" rowNumHeaderValue="No" rowNumVisible=""
								rowStatusHeaderValue="" rowStatusVisible="" rowStatusWidth="30" scrollByColumn="false" style="height:404px;"
								useShiftKey="true" visibleRowNum="" tooltipDisplay="true">
								<w2:header id="header1" style="">
									<w2:row id="row2" style="">
										<w2:column blockSelect="false" colSpan="" id="column23" inputType="text"
											readOnly="false" rowSpan="2" style="height:40px;" value="No" viewType="icon" width="40">
										</w2:column>
										<w2:column blockSelect="false" colSpan="2" displayMode="label" id="column25"
											inputType="text" removeBorderStyle="false" rowSpan="" style="height:35px;" value="사용자" width="200">
										</w2:column>
										<w2:column blockSelect="false" colSpan="2" displayMode="label" id="column32"
											inputType="text" removeBorderStyle="false" rowSpan="" style="height:35px;" value="사용기간" width="120">
										</w2:column>
									</w2:row>
									<w2:row id="row6" style="">
										<w2:column blockSelect="false" displayMode="label" id="column27"
											inputType="text" removeBorderStyle="false" style="" value="성명" width="100">
										</w2:column>
										<w2:column blockSelect="false" displayMode="label" id="column36"
											inputType="text" removeBorderStyle="false" style="" value="부서명" width="100">
										</w2:column>
										<w2:column blockSelect="false" displayMode="label" id="column33"
											inputType="text" removeBorderStyle="false" style="" value="시작일자" width="120">
										</w2:column>
										<w2:column blockSelect="false" displayMode="label" id="column30"
											inputType="text" removeBorderStyle="false" style="" value="종료일자" width="120">
										</w2:column>
									</w2:row>
								</w2:header>
								<w2:gBody id="gBody4" style="">
									<w2:row id="row5" style="">
										<w2:column blockSelect="false" expression="rowindex()+1" id="col1"
											inputType="expression" readOnly="false" style="" textAlign="" value="" viewType="icon" width="40">
										</w2:column>
										<w2:column blockSelect="false" displayMode="label" id="deptUserNm" inputType="text"
											readOnly="" removeBorderStyle="false" style="" value="" viewType="" width="100">
										</w2:column>
										<w2:column blockSelect="false" displayMode="label" id="deptName" inputType="text"
											removeBorderStyle="false" style="" value="" width="100">
										</w2:column>
										<w2:column blockSelect="false" displayMode="label" id="useValdStrtDt"
											inputType="calendar" readOnly="false" removeBorderStyle="false" style="" value="" viewType="icon"
											width="120">
										</w2:column>
										<w2:column blockSelect="false" displayMode="label" id="useValdEndDt"
											inputType="calendar" readOnly="false" removeBorderStyle="false" style="" value="" viewType="icon"
											width="120">
										</w2:column>
									</w2:row>
								</w2:gBody>
							</w2:gridView>
						</xf:group>
					</xf:group>
				</xf:group>
			</xf:group>
		</xf:group>


	</body>
</html>
