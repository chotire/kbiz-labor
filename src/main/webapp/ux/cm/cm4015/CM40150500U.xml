<?xml version="1.0" encoding="UTF-8"?>

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:ev="http://www.w3.org/2001/xml-events"
	xmlns:w2="http://www.inswave.com/websquare" xmlns:xf="http://www.w3.org/2002/xforms">
	<head>
		<w2:type>DEFAULT</w2:type>
		<w2:buildDate />
		<xf:model>
			<xf:instance>
				<data xmlns="" />
			</xf:instance>
			<w2:dataCollection baseNode="map">
				<w2:dataList baseNode="list" repeatNode="map" style="" id="dsTcmErndIncmMdtAdjList"
					saveRemovedData="true">
					<w2:columnInfo>
						<w2:column id="chk" name="선택" dataType="text"></w2:column>
						<w2:column id="siteCd" name="현장코드" dataType="text"></w2:column>
						<w2:column id="wkrNo" name="근로자번호" dataType="text"></w2:column>
						<w2:column id="erndSeq" name="근로_순번" dataType="text"></w2:column>
						<w2:column id="wkrNm" name="근로자_명" dataType="text"></w2:column>
						<w2:column id="resnoEnc" name="주민등록번호_암호화" dataType="text"></w2:column>
						<w2:column id="rvtStrtYm" name="지급_연월/귀속_시작_연월귀속연월FORM" dataType="text"></w2:column>
						<w2:column id="rvtEndYm" name="지급_연월/귀속_종료_연월귀속연월TO" dataType="text"></w2:column>
						<w2:column id="rsdnNrsdYn" name="거주_비거주_여부" dataType="text"></w2:column>
						<w2:column id="ntvFrgnYn" name="내국인_외국인_여부" dataType="text"></w2:column>
						<w2:column id="adjYn" name="정산_여부" dataType="text"></w2:column>
						<w2:column id="slipYn" name="전표발행여부" dataType="text"></w2:column>
						<w2:column id="aprvCharN2Val" name="결재_문자_2_값" dataType="text"></w2:column>
						<w2:column id="aprvMappId" name="결재매핑ID" dataType="text"></w2:column>
						<w2:column id="aprvPgmId" name="결재프로그램ID" dataType="text"></w2:column>
						<w2:column id="aprvNo" name="결재번호" dataType="text"></w2:column>
						<w2:column id="aproId" name="승인ID" dataType="text"></w2:column>
						<w2:column id="apprEmpno" name="승인자" dataType="text"></w2:column>
						<w2:column id="intAprvStusCd" name="내부결재상태코드[CF041]" dataType="text"></w2:column>
						<w2:column id="totSalAmt" name="총_급여_금액" dataType="text"></w2:column>
						<w2:column id="natnpPnsnAmt" name="국민연금정산금액" dataType="text"></w2:column>
						<w2:column id="eplmtInfeeAmt" name="고용보험료금액" dataType="text"></w2:column>
						<w2:column id="hlthInfeeAmt" name="건강보험정산금액" dataType="text"></w2:column>
						<w2:column id="ictxAmt" name="소득세금액" dataType="text"></w2:column>
						<w2:column id="rstxAmt" name="주민세금액" dataType="text"></w2:column>
						<w2:column id="zipCd" name="우편번호" dataType="text"></w2:column>
						<w2:column id="baseAddr" name="기본_주소" dataType="text"></w2:column>
						<w2:column id="dtlAddr" name="상세_주소" dataType="text"></w2:column>
						<w2:column id="payYear" name="정산연도" dataType="text"></w2:column>
						<w2:column id="entDt" name="입사일자" dataType="text"></w2:column>
						<w2:column id="rtirDt" name="퇴사일자" dataType="text"></w2:column>
						<w2:column id="hrIfYn" name="인사_인터페이스_여부" dataType="text"></w2:column>
						<w2:column id="userNm" name="승인자명" dataType="text"></w2:column>
						<w2:column id="prgsStusCd" name="상태코드" dataType="text"></w2:column>
						<w2:column id="prgsStusNm" name="상태명" dataType="text"></w2:column>
						<w2:column id="payDt" name="지급일자" dataType="text"></w2:column>
						<w2:column id="stusCd" name="상태" dataType="text"></w2:column>
						<w2:column id="dcsnTxamtIctxAmt" name="결정_세액_소득세_금액" dataType="text"></w2:column>
						<w2:column id="dcsnTxamtRstxAmt" name="결정_세액_주민세_금액" dataType="text"></w2:column>
						<w2:column id="prvpyTxamtRstxAmt" name="기납부_세액_주민세_금액" dataType="text"></w2:column>
						<w2:column id="prvpyTxamtIctxAmt" name="기납부_세액_소득세_금액" dataType="text"></w2:column>
						<w2:column id="subtIncmAmt" name="차감_소득_금액" dataType="text"></w2:column>
					</w2:columnInfo>
					<w2:data use="false"></w2:data>
				</w2:dataList>
				<w2:dataMap baseNode="map" id="dsSrchMap" style="">
					<w2:keyInfo>
						<w2:key dataType="text" id="keySiteCd" name="현장코드"></w2:key>
						<w2:key id="keyResnoEnc" name="주민등록번호" dataType="text"></w2:key>
						<w2:key id="keyRsdnNrsdYn" name="거주_비거주_여부" dataType="text"></w2:key>
						<w2:key id="keyNtvFrgnYn" name="내국인_외국인_여부" dataType="text"></w2:key>
						<w2:key dataType="text" id="keyPvtYear" name="귀속년도"></w2:key>
						<w2:key id="laborGbn" name="원천세 구분" dataType="text"></w2:key>
					</w2:keyInfo>
				</w2:dataMap>
				<w2:dataMap baseNode="map" id="dsTcmSiteStaf" style="">
					<w2:keyInfo>
						<w2:key dataType="text" id="siteCd" name="현장코드"></w2:key>
						<w2:key dataType="text" id="stafEmpno" name="직원_사번"></w2:key>
						<w2:key dataType="text" id="userNm" name="성명"></w2:key>
						<w2:key dataType="text" id="siteDtyGbCd" name="현장직무구분코드[CM100001]"></w2:key>
						<w2:key dataType="text" id="siteStafGbCd" name="현장직원구분코드[CM100004]"></w2:key>
						<w2:key dataType="text" id="apntDt" name="발령_일자"></w2:key>
						<w2:key dataType="text" id="dtyEndDt" name="직무_종료_일자"></w2:key>
						<w2:key dataType="text" id="wthdPrDt" name="철수_예정_일자"></w2:key>
						<w2:key dataType="text" id="wthdDt" name="철수_일자"></w2:key>
					</w2:keyInfo>
				</w2:dataMap>
				<w2:dataMap baseNode="map" id="dsTcmAprv" style="">
					<w2:keyInfo>
						<w2:key dataType="text" id="siteCd" name="현장코드"></w2:key>
						<w2:key dataType="text" id="aprvMappId" name="결재매핑ID"></w2:key>
						<w2:key dataType="text" id="aprvPgmId" name="결재프로그램ID"></w2:key>
						<w2:key dataType="text" id="aprvNo" name="결재번호"></w2:key>
						<w2:key dataType="text" id="aproId" name="승인ID"></w2:key>
						<w2:key dataType="text" id="aprvCharN1Val" name="결재_문자_1_값"></w2:key>
						<w2:key dataType="text" id="aprvCharN2Val" name="결재_문자_2_값"></w2:key>
						<w2:key dataType="text" id="aprvCharN3Val" name="결재_문자_3_값"></w2:key>
						<w2:key dataType="text" id="pcostTypeVal" name="원가_유형_값"></w2:key>
					</w2:keyInfo>
				</w2:dataMap>
				<w2:dataMap baseNode="map" id="dsSelMap" style="">
					<w2:keyInfo>
						<w2:key dataType="text" id="siteCd" name="현장코드"></w2:key>
						<w2:key dataType="text" id="aprvMappId" name="[결재]결재매핑ID"></w2:key>
						<w2:key dataType="text" id="aproId" name="[결재]결재번호"></w2:key>
						<w2:key dataType="number" id="row" name="진행하는 행번호"></w2:key>
						<w2:key id="stafEmpno" name="[결재]승인자" dataType="text"></w2:key>
						<w2:key id="userNm" name="[결재]승인자명" dataType="text"></w2:key>
						<w2:key id="wkrNo" name="[전표생성]근로자번호" dataType="text"></w2:key>
						<w2:key id="erndSeq" name="[전표생성]근로순번" dataType="text"></w2:key>
						<w2:key id="payDt" name="[전표생성]지급일자" dataType="text"></w2:key>
					</w2:keyInfo>
				</w2:dataMap>
				<w2:dataMap baseNode="map" id="dsTcmAprvCheck" style="">
					<w2:keyInfo>
						<w2:key dataType="text" id="dataExist" name="중도정산자료여부"></w2:key>
						<w2:key dataType="text" id="slipExist" name="전표생성자료여부"></w2:key>
					</w2:keyInfo>
				</w2:dataMap>
				<w2:dataList baseNode="list" id="dsStusCdList" repeatNode="map" saveRemovedData="true" style="">
					<w2:columnInfo>
						<w2:column dataType="text" id="cd" name="코드값"></w2:column>
						<w2:column dataType="text" id="cdNm" name="코드명"></w2:column>
					</w2:columnInfo>
				</w2:dataList>
			</w2:dataCollection>
			<w2:workflowCollection></w2:workflowCollection>
		</xf:model>

		<script src="/resources/js/common/cmn_CM.js" type="javascript" lazy="false"/><script type="javascript" lazy="false"><![CDATA[
/***************************************************************************
 * Program ID : CM40150500U.xml
 * Program Name : 근로소득 중도정산
 * Author : tpyhyoj (tpyhyoj)
 * Date : 2019.08.28
 *
 * History
 * ========================================
 * 변경일자     수정자   내 용
 * ========================================
 *
 **************************************************************************/
 
    /************************************************************************************
     *  [1] onpageload
     ************************************************************************************/
    scwin.onpageload = function() {
    
 		//화면초기화
        scwin.fnInitial();

    };

    /** 화면초기화 **/
    scwin.fnInitial = function() {
    
		var sFrameId = "";
		if ( gcm.tab_main == undefined  ) {		//팝업인경우 
			var winPopParam = JSON.parse(sessionStorage.winpopParam);
			var parentId    = winPopParam.dataObj.data.pframeId;
			
			if(parentId != undefined && parentId != "") {
           		var parentObj = opener.frames[parentId].getWindow().com;
           		
		        //원천세 여부
           		//cmn_CM.js 에 있는 함수 호출 
           		if (typeof(parentObj["getLaborGbn"]) == "function"){
           			sLaborGbn = parentObj["getLaborGbn"](parentId,"MNU_LV_307092");
           		}else{
           			sLaborGbn   = cmCom.getLaborGbn(parentId, "MNU_LV_307092");
           		}
           		
           		if (typeof(parentObj["getSiteDeptNm"]) == "function"){
           			sSiteDeptNm = parentObj["getSiteDeptNm"](sLaborGbn);
           		}else{
           			sSiteDeptNm = cmCom.getSiteDeptNm(sLaborGbn);
           		}
           		
           		if (typeof(parentObj["getLaborGbn"]) == "function"){
           			objSiteDept = parentObj["setSiteOrDept"](sLaborGbn, wfmKeySiteInfo, wfmKeyDeptInfo, spnSiteDept);
           		}else{
           			objSiteDept = cmCom.setSiteOrDept(sLaborGbn, wfmKeySiteInfo, wfmKeyDeptInfo, spnSiteDept);
           		}
			}
		} else {								//팝업이 아닌경우
			sFrameId = com.getFrameId() ;
			
	        //원천세 여부
			sLaborGbn   = cmCom.getLaborGbn(sFrameId, "MNU_LV_307092");
	        sSiteDeptNm = cmCom.getSiteDeptNm(sLaborGbn);
	        objSiteDept = cmCom.setSiteOrDept(sLaborGbn, wfmKeySiteInfo, wfmKeyDeptInfo, spnSiteDept);
		}
    
        dsSrchMap.set("laborGbn", sLaborGbn);   //원천세 구분

        if (com.isEmpty(gcm.tab_main)) {
	        //초기값 설정
	        dsSrchMap.set("keyRsdnNrsdYn", "Y");   											//거주_비거주_여부
	        dsSrchMap.set("keyNtvFrgnYn" , "Y");   											//내국인_외국인_여부
            dsSrchMap.set("keyPvtYear"	 , $p.getCurrentServerDate( "yyyy" ));  			//귀속연도
        } else {
            dsSrchMap.set( "keySiteCd"   , $w.getParameter("keySiteCd")  );            		//현장코드

            if ( !com.isEmpty($w.getParameter("keyRsdnNrsdYn"))  ) {
                dsSrchMap.set( "keyRsdnNrsdYn"   , $w.getParameter("keyRsdnNrsdYn")  );     //거주_비거주_여부
            }else{
                dsSrchMap.set("keyRsdnNrsdYn",  "Y");                                       //거주_비거주_여부
            }

            if ( !com.isEmpty($w.getParameter("keyNtvFrgnYn"))  ) {
                dsSrchMap.set( "keyNtvFrgnYn"   , $w.getParameter("keyNtvFrgnYn")  );       //내국인_외국인_여부
            }else{
                dsSrchMap.set("keyNtvFrgnYn",   "Y");                                       //내국인_외국인_여부
            }

            if ( !com.isEmpty($w.getParameter("keyPvtYear"))  ) {
                dsSrchMap.set( "keyPvtYear"   , $w.getParameter("keyPvtYear")  );           //귀속년도
            }else{
                dsSrchMap.set("keyPvtYear",     $p.getCurrentServerDate( "yyyy" ));         //귀속연도
            }
        }

        scwin.fnBtnDisabled(-1);

        scwin.fnSearchInit();

		btnSlipCreate.hide();
		btnSlipCancel.hide();
        if( dsSrchMap.get("laborGbn") == "TX" ){    		//원천세
			grdTcmErndIncmMdtAdjList.setColumnVisible( "prgsStusNm" , false );           //해당 요일 보여줌
		}
        //UI팀용 함수 호출
        scwin.commonUI();
    };

    /************************************************************************************
     *  [2] 전역변수
     ************************************************************************************/
    var svcId = "";
    var sLaborGbn = "";
    var sSiteDeptNm = "현장";
    var objSiteDept = null;
	var serverDate = WebSquare.date.getCurrentServerDate();	//현재일자

    /************************************************************************************
     *  [3] Event 함수
     ************************************************************************************/

    // 검색 버튼
    scwin.btnFind_onclick = function() {
        scwin.fnSearchList();
    };

    //정산 버튼
    scwin.btnAdj_onclick = function() {
        scwin.fnAdjustment();
    };

    //정산취소 버튼
    scwin.btnNadj_onclick = function() {
        scwin.fnAdjustmentRetire();
    };

    //인사연동 버튼
    scwin.btnHrCnnt_onclick = function() {
        scwin.fnHrCnnt();
    };

    //승인요청 버튼
    scwin.btnApprRequest_onclick = function() {

 		var nRow = dsSelMap.get("row");

        if( eval(nRow) < 0 ){
        	com.showMessage("CMW0072");     //승인요청할 대상을 선택하세요
        	return false;
        }
        
		var sPayDt  = dsTcmErndIncmMdtAdjList.getCellData( nRow , "payDt" );    //지급일자
 		if (com.isEmpty(sPayDt)) {
        	com.showMessage("CMW0025", "지급일자", "", "", grdTcmErndIncmMdtAdjList.id, nRow, "payDt");//$1은(는) 필수입력사항입니다.
            return ;
        }
               
        var sHrIfYn         = dsTcmErndIncmMdtAdjList.getCellData( nRow , "hrIfYn" );           //인사 인터페이스 여부
        if( sHrIfYn != 'Y'){
        	com.showMessage("CMW0096");     //인사 연동후 전표생성 처리해주세요.
        	return ;
        }

        if( dsTcmErndIncmMdtAdjList.getCellData( nRow , "subtIncmAmt" )  == 0){
        	com.showMessage("CMW0137");     //정산 금액이 존재하지 않습니다.
        	return ;
        }

		// 전표생성 데이터 CHCCK
        ajaxLib.ajax("/cm/cm4015/CM40150500U/selectTcmErndAdjSlipExist", {
            method : "POST",
            requestData : dsSelMap.getJSON(),
            callback : function(result, e){
				dsTcmAprvCheck.setJSON(result.data.dsTcmAprvCheck);//자료여부
				scwin.fnSlipDataCheck();//자료여부에 대한 후속체크로직
           	},
            errCallback : "fnErrCallback"
        });

    };

    //승인 버튼
    scwin.btnApproval_onclick = function() {
        scwin.fnApproval();
    };

    //승인현황 버튼
    scwin.btnApprovalSitu_onclick = function() {
        scwin.fnApprovalSitu();
    };

    //그리드 클릭
    scwin.grdTcmErndIncmMdtAdjList_oncellclick = function(row,col) {

        var sColName = grdTcmErndIncmMdtAdjList.getColumnID( col );
    };

    //그리드 행 변경시 이벤트
    scwin.grdTcmErndIncmMdtAdjList_oncellindexchange = function(row,col,oldRow,oldCol) {

        var sSiteCd  = dsTcmErndIncmMdtAdjList.getCellData( row , "siteCd" );      //현장코드
        var sWkrNo   = dsTcmErndIncmMdtAdjList.getCellData( row , "wkrNo" );       //근로자번호
        var sErndSeq = dsTcmErndIncmMdtAdjList.getCellData( row , "erndSeq" );     //근로_순번

        dsSelMap.set("siteCd"     , sSiteCd);                      								//현장코드
        dsSelMap.set("aprvMappId" , sWkrNo+'_'+ sErndSeq );        								//결재매핑ID
        dsSelMap.set("aproId"     , dsTcmErndIncmMdtAdjList.getCellData( row , "aproId" ) );  	//결재번호
        dsSelMap.set("userNm"     , dsTcmErndIncmMdtAdjList.getCellData( row , "userNm" ));    	//승인자명
        dsSelMap.set("stafEmpno"  , dsTcmErndIncmMdtAdjList.getCellData( row , "apprEmpno" )); 	//승인자
        dsSelMap.set("row"        , row);  														//행 번호

		// 2019-06-12 : tpcsy, 전표생성을 위한 변수 추가
        dsSelMap.set("wkrNo"  , sWkrNo); 														//근로자_번호
        dsSelMap.set("erndSeq", sErndSeq); 														//근로순번
        dsSelMap.set("payDt"  , dsTcmErndIncmMdtAdjList.getCellData( row , "payDt" )); 		  	//지급일자=회계일자

        scwin.fnBtnDisabled(row);       //버튼 제어

    };

   //검색 조건 주민번호
    scwin.keyResnoEnc_onkeydown = function(e) {
        if (e.keyCode == 13){
            scwin.fnSearchList();
        }
	};

    //검색 조건 주민번호 변경 이벤트
	scwin.keyResnoEnc_onviewchange = function(info) {

		if (!com.isEmpty( keyResnoEnc.getValue() )) {
			if ( !com.chkIcNo(keyResnoEnc.getValue()) ){
	            com.showMessage("CFW0003", "주민등록번호", "", "", keyResnoEnc.id);  //$1 항목을 확인하십시오.
	            keyResnoEnc.setValue("");
	            return ;
		    }
	    }
	};
	
	
    //엑셀다운 버튼
    scwin.btnExcelDwn_onclick = function() {
        if(dsTcmErndIncmMdtAdjList.getTotalRow() <= 0){
            com.showMessage("CMW0042");     //다운로드할 내역이 존재하지 않습니다.
            return;
        }else{
            var excelOpt = {};  						//excel download 옵션
            excelOpt.fileName = "근로소득 중도정산.xlsx";    	//또는 xlsx 확장자 사용
            grdTcmErndIncmMdtAdjList.advancedExcelDownload( excelOpt );
        }
    };
	
   /**************************************************************************
     * 함 수 명: scwin.WFrameSiteInfo_change_callback
     * 기 능: 현장코드 변경 이벤트
     **************************************************************************/    
	scwin.WFrameSiteInfo_change_callback = function() {
        dsTcmErndIncmMdtAdjList.removeAll();
	};  
	
    /**************************************************************************
     *  [4] Callback
     **************************************************************************/

    // 결과 후처리
    scwin.fnCallback = function(result, e) {
        switch (svcId) {
            case "selectTcmErndIncmMdtAdjInit" :   //초기 화면 조회
                dsStusCdList.setJSON(result.data.stusCdList);       	 	//상태값

                break;
            case "selectTcmErndIncmMdtAdjList" :	//그리드 조회

                dsTcmErndIncmMdtAdjList.setJSON(result.data.tcmErndIncmMdtAdjList);     //그리드 검색 결과
                dsTcmSiteStaf.setJSON(result.data.tcmSiteStaf);                         //현장 소장 조회(결제 승인자)

                if( cmCom.parseInt(dsSrchMap.get("keyPvtYear")) <= 2018 ){
        			scwin.fnBtnAllDisabled(true);        	//모든 버튼 막기
        			return ;
        		} else {
        			scwin.fnBtnAllDisabled( false );		//모든 버튼 풀기
        		}

                var sAjdEditYn = 'N';

                //화면 제어
                for( var nRow = 0 ; nRow < dsTcmErndIncmMdtAdjList.getRowCount() ; nRow++){
                  	var sStusCd       = dsTcmErndIncmMdtAdjList.getCellData( nRow , "stusCd" );       	//상태
                  	var sPrgsStusCd   = dsTcmErndIncmMdtAdjList.getCellData( nRow , "prgsStusCd" );   	//전표 상태

                    if( sStusCd != "X"  ){       														//그리드 미정산이 아닌경우
                        grdTcmErndIncmMdtAdjList.setCellReadOnly( nRow , 'payDt' , true );             	//지급일자 수정불가
                    } else {
                        grdTcmErndIncmMdtAdjList.setCellReadOnly( nRow , 'payDt' , false );            	//지급일자 수정가능
                    }

                    if( sPrgsStusCd == '' || sPrgsStusCd == '91'  ){    								//전표생성 전 인경우
                        grdTcmErndIncmMdtAdjList.setCellReadOnly( nRow , 'chk' , false );              	//선택 수정가능
                        sAjdEditYn = 'Y';
                    } else {
                        grdTcmErndIncmMdtAdjList.setCellReadOnly( nRow , 'chk' , true );               	//선택 수정불가
                    }

                }

                if( sAjdEditYn == 'N'){
                	btnAdj.setDisabled( true );		//정산
                	btnNadj.setDisabled( true );	//정산 취소
                	btnHrCnnt.setDisabled( true );	//인사 연동
                } else {
                	btnAdj.setDisabled( false );	//정산
                	btnNadj.setDisabled( false );	//정산 취소
                	btnHrCnnt.setDisabled( false );	//인사 연동
                }

                //검색 내용이 없거나 , 검색 조건이 변경할 경우 승인 dsSelMap 리셋 시킴
                if( dsTcmErndIncmMdtAdjList.getRowCount() == 0 || dsSrchMap.getModifiedData().length > 0 ){
                    dsSelMap.setEmptyValue();
                }

                dsSrchMap.initRowStatus();      //검색조건 변경 유무 초기화

                var nRow = dsSelMap.get("row");
                if( com.isEmpty(nRow)  ){
                    if( dsTcmErndIncmMdtAdjList.getRowCount()  > 0 ){
	                    nRow = 0;
	                    dsSelMap.set(nRow);
                    }else{
	                    nRow = -1;
                    }
                }

                scwin.fnBtnDisabled( nRow );     //버튼 제어
                grdTcmErndIncmMdtAdjList.setFocusedCell( nRow , "resnoEnc" , false );

                break;
           case "saveYtaitEmpUploadCalc" :		//정산
                com.showMessage("CMW0061");     //정산되었습니다.
                scwin.fnSearchList();
                break;
           case "saveYtaitEmpUploadCalcRetire":	//정산 취소
                com.showMessage("CMW0062");     //정산취소되었습니다
                scwin.fnSearchList();
                break;
           case "saveTcmErndIncmMdtAdjHrCnnt" :	//인사연동
                com.showMessage("CMW0058");     //인사연동 적용이 완료 되었습니다.
                scwin.fnSearchList();
                break;
           case "saveTcmAprv" :                	//승인요청, 승인
				if( dsSrchMap.get("laborGbn") != "TX" ){    //원천세
		        	ajaxLib.ajax("/cm/cm4015/CM40150500U/saveTcmErndAdjSlipAcum", {
			            method : "POST",
			            requestData : dsSelMap.getJSON(),
			            callback : function(result, e){
							scwin.fnSlipJournalizing();
						},
			            errCallback : "fnErrCallback"
			        });
				}
		
                break;
        }
    };

    // 에러 후처리
    scwin.fnErrCallBack = function(e) {
        switch (svcId) {
           case "selectTcmErndIncmMdtAdjInit" :		//초기 조회
                console.log('조회오류: ' + e);
                break;
           case "selectTcmErndIncmMdtAdjList" :		//그리드 조회
                console.log('조회오류: ' + e);
                break;
           case "saveYtaitEmpUploadCalc" :			//정산
                console.log('정산오류: ' + e);
                break;
           case "saveYtaitEmpUploadCalcRetire" :    //정산 취소
                console.log('정산취소오류: ' + e);
                break;
           case "saveTcmErndIncmMdtAdjHrCnnt" :    	//인사연동
                console.log('인사연동오류: ' + e);
                break;
           case "saveTcmAprv" :                		//승인요청, 승인
                console.log('저장오류: ' + e);
                break;
        }
    }

    //팝업 콜백함수
    scwin.fnPopupCallback = function(arg) {
        switch (svcIdPop) {
            case "intAprvPopup" :        	//승인요청

                dsTcmAprv.set("siteCd"        , dsSelMap.get("siteCd"));       //현장코드
                dsTcmAprv.set("aprvMappId"    , dsSelMap.get("aprvMappId"));   //결재매핑ID
                dsTcmAprv.set("aprvPgmId"     , 'CMDA0325AG');                 //결재프로그램ID   : CMDA0325AG 중도정산전표승인
                dsTcmAprv.set("aprvNo"        , '');                           //결재번호
                dsTcmAprv.set("aproId"        , arg.intAprvNo);                   //승인ID
                dsTcmAprv.set("aprvCharN1Val" , '');                           //결재_문자_1_값
                dsTcmAprv.set("aprvCharN2Val" , '');                           //결재_문자_2_값
                dsTcmAprv.set("aprvCharN3Val" , '');                           //결재_문자_3_값
//                pcostTypeVal  : 원가_유형_값은 승인요청 confirm후 등록
                scwin.fnTcmAprv();
                break;
            case "intAprvProcPopup" :   	//승인
                    scwin.fnSearchList();
                break;
            case "intAprvSituPopup" :  	 	//승인현황
                break;
        }
    }

    /**************************************************************************
     *  [5] 사용자정의 함수
     **************************************************************************/

    // 화면 초기조회
    scwin.fnSearchInit = function() {
        svcId = "selectTcmErndIncmMdtAdjInit";

        ajaxLib.ajax("/cm/cm4015/CM40150500U/selectTcmErndIncmMdtAdjInit", {
            mode : "synchronous",
            method : "POST",
            requestData : dsSrchMap.getJSON(),
            callback : "fnCallback",
            errCallback : "fnErrCallBack"
        });

    };

    // 조회 List
    scwin.fnSearchList = function() {
        //DS 매핑
        if( dsSrchMap.get("laborGbn") == "TX") {
        	dsSrchMap.set("keySiteCd"   , wfmKeyDeptInfo.getWindow().ibxKeySiteCd.getValue() );  	//부서 코드
        }else{
	        dsSrchMap.set("keySiteCd"   , wfmKeySiteInfo.getWindow().ibxKeySiteCd.getValue() );  	//현장 코드
        }

        if( dsSrchMap.get("keySiteCd").length == 0  ){
            if( dsSrchMap.get("laborGbn") == "TX") {
	            var focusId = wfmKeyDeptInfo.getWindow().ibxKeySiteNm.id;
	            com.showMessage("CMW0025", "부서", "", "", focusId);     		//$1은(는) 필수입력사항입니다.
            }else{
	            var focusId = wfmKeySiteInfo.getWindow().ibxKeySiteNm.id;
	            com.showMessage("CMW0025", "현장", "", "", focusId);     		//$1은(는) 필수입력사항입니다.
            }
            return ;
        }

        if( dsSrchMap.get("keyPvtYear").length == 0  ){
            com.showMessage("CMW0025", "출연기간", "", "", keyPvtYear.id);  	//$1은(는) 필수입력사항입니다.
            return ;
        }

        svcId = "selectTcmErndIncmMdtAdjList";

        ajaxLib.ajax("/cm/cm4015/CM40150500U/selectTcmErndIncmMdtAdjList", {
            mode : "asynchronous",
            method : "POST",
            requestData : dsSrchMap.getJSON(),
            callback : "fnCallback",
            errCallback : "fnErrCallBack"
        });

    };

    // 정산
    scwin.fnAdjustment = function() {

       svcId = "saveYtaitEmpUploadCalc";

       var nChkCnt = 0;
       for( var nRow = 0 ; nRow < dsTcmErndIncmMdtAdjList.getRowCount() ; nRow++){
            var sAdjYn  = dsTcmErndIncmMdtAdjList.getCellData( nRow , "adjYn" );   //상태
            var sChk    = dsTcmErndIncmMdtAdjList.getCellData( nRow , "chk" );      //체크박스
            var sPayDt  = dsTcmErndIncmMdtAdjList.getCellData( nRow , "payDt" );    //지급일자

            if( sChk == "Y" ){             	//그리드 선택항목 선택된 경우
               if( sAdjYn != "X"){       	//그리드 정산상태 미정산인 경우
                   com.showMessage("CMW0063", "", "", "", grdTcmErndIncmMdtAdjList.id, nRow, "chk");//미정산 항목만 선택해주세요.
                   return ;
               }

               if (com.isEmpty(sPayDt)) {
               		com.showMessage("CMW0025", "지급일자", "", "", grdTcmErndIncmMdtAdjList.id, nRow, "payDt");//$1은(는) 필수입력사항입니다.
               		return ;
               }

               nChkCnt++;
            }
        }

        if( nChkCnt == 0 ){
            com.showMessage("CMW0034");     //선택된 항목이 존재하지 않습니다.
           return ;
        }

        if (confirm("정산 하시겠습니까?")) {

            ajaxLib.ajax("/cm/cm4015/CM40150500U/saveYtaitEmpUploadCalc", {
                mode : "asynchronous",
                method : "POST",
                requestData : {
                                param : dsSrchMap.getJSON()
                             , tcmErndIncmMdtAdjList : dsTcmErndIncmMdtAdjList.getModifiedJSON()
                              },
                callback : "fnCallback",
                errCallback : "fnErrCallBack"
            });
        }
    };

    // 정산 취소
    scwin.fnAdjustmentRetire = function() {

        svcId = "saveYtaitEmpUploadCalcRetire";

        if( dsTcmErndIncmMdtAdjList.getModifiedJSON().length == 0 ){
            com.showMessage("CMW0024"); //저장(변경)할 내용이 없습니다.
            return ;
        }

       	var nChkCnt = 0;
       	for( var nRow = 0 ; nRow < dsTcmErndIncmMdtAdjList.getRowCount() ; nRow++){
       		var sAdjYn  = dsTcmErndIncmMdtAdjList.getCellData( nRow , "adjYn" );   //상태
            var sChk    = dsTcmErndIncmMdtAdjList.getCellData( nRow , "chk" );     //체크박스

            if( sChk == "Y" ){             	//그리드 선택항목 선택된 경우
               if( sAdjYn == "X"){       	//그리드 정산상태 정산인 경우
                   com.showMessage("CMW0064", "", "", "", grdTcmErndIncmMdtAdjList.id, nRow, "chk");	//정산취소 항목만 선택해주세요.
                   return ;
               }
               nChkCnt++;
            }
        }

        if( nChkCnt == 0 ){
            com.showMessage("CMW0034");     //선택된 항목이 존재하지 않습니다.
           return ;
        }

        if (confirm("정산 취소하시겠습니까?")) {

            ajaxLib.ajax("/cm/cm4015/CM40150500U/saveYtaitEmpUploadCalcRetire", {
                mode : "asynchronous",
                method : "POST",
                requestData : { param : dsSrchMap.getJSON()
                              , tcmErndIncmMdtAdjList : dsTcmErndIncmMdtAdjList.getModifiedJSON()
                              },
                callback : "fnCallback",
                errCallback : "fnErrCallBack"
            });
        }
    };

    // 정산 취소
    scwin.fnHrCnnt = function() {

        //DS 매핑
        if( dsSrchMap.get("laborGbn") == "TX") {
        	dsSrchMap.set("keySiteCd"   , wfmKeyDeptInfo.getWindow().ibxKeySiteCd.getValue() );  	//부서 코드
        }else{
	        dsSrchMap.set("keySiteCd"   , wfmKeySiteInfo.getWindow().ibxKeySiteCd.getValue() );  	//현장 코드
        }

        if( dsSrchMap.get("keySiteCd").length == 0  ){
            if( dsSrchMap.get("laborGbn") == "TX") {
	            var focusId = wfmKeyDeptInfo.getWindow().ibxKeySiteNm.id;
	            com.showMessage("CMW0025", "부서", "", "", focusId);     	//$1은(는) 필수입력사항입니다.
            }else{
	            var focusId = wfmKeySiteInfo.getWindow().ibxKeySiteNm.id;
	            com.showMessage("CMW0025", "현장", "", "", focusId);     	//$1은(는) 필수입력사항입니다.
            }
            return ;
        }

        if( dsSrchMap.get("keyPvtYear").length == 0  ){
            com.showMessage("CMW0025", "출연기간", "", "", keyPvtYear.id);  //$1은(는) 필수입력사항입니다.
            return ;
        }

        svcId = "saveTcmErndIncmMdtAdjHrCnnt";

        if (confirm("저장 하시겠습니까?")) {

            ajaxLib.ajax("/cm/cm4015/CM40150500U/saveTcmErndIncmMdtAdjHrCnnt", {
                mode : "asynchronous",
                method : "POST",
                requestData : dsSrchMap.getJSON(),
                callback : "fnCallback",
                errCallback : "fnErrCallBack"
            });
        }
    };

    //내부 결제 저장
    scwin.fnTcmAprv = function() {

        svcId = "saveTcmAprv";

        ajaxLib.ajax("/cm/cm4015/CM40150500U/saveTcmAprv", {
            mode : "asynchronous",
            method : "POST",
            requestData : dsTcmAprv.getJSON(),
            callback : "fnCallback",
            errCallback : "fnErrCallBack"
        });
    };

    //승인요청
    scwin.fnApprRequest = function() {

        var popOps = {
                 popup_name:"승인요청"           // 팝업 타이틀  요청 시 “승인요청”, 승인/반려 시 “승인“, 조회 시 “승인현황＂
                ,url:"/ux/cf/CF00350502P.xml"
                ,data:{ gubunCd:gcm.APPR_REQUEST                    // gcm.APPR_REQUEST, gcm.APPR_PROC, gcm.APPR_FIND
                                                                        // gcm.APPR_REQUEST : 승인요청
                                                                        //, gcm.APPR_PROC : 승인/반려
                                                                        //, gcm.APPR_FIND : 승인현황조회(승인취소)
                      , intAprvNo:""                                   // 승인아이디 (승인/반려 시 또는 조회 시에만 필요)
                      , cancelYn:""                                 // 승인을 취소할 수 있는 경우 “Y”
                      , intAprvTtl:"근로소득 중도정산"              // 내부결재제목
                      , intAprvReqOpinCn:""                         // 내부_결재_요청_의견_내용
                      , apprEmpno:dsTcmSiteStaf.get("stafEmpno")    // 승인자사번
                      , apprEmpNm:dsTcmSiteStaf.get("userNm")       // 승인자명
                      , intAprvAproOpinCn:""                        // 내부_결재_승인_의견_내용
                      , jobGbCd:"CM"                                // 업무구분코드
                      , menuId:"JJCM01"                             // 메뉴ID
                      , scrUrl:""                                   // 화면_URL
                      }
                ,width:"600"
                ,height:"360"
                ,callbackFn:"scwin.fnPopupCallback"
        };

        svcIdPop = "intAprvPopup";

        com.popup_open(popOps);
    };

    //승인
    scwin.fnApproval = function() {
        var sAproId = dsSelMap.get( "aproId" );

        var popOps = {
                 popup_name:"승인"           // 팝업 타이틀  요청 시 “승인요청”, 승인/반려 시 “승인“, 조회 시 “승인현황＂
                ,url:"/ux/cf/CF00350502P.xml"
                ,data:{ gubunCd:gcm.APPR_PROC                  // gcm.APPR_REQUEST, gcm.APPR_PROC, gcm.APPR_FIND
                                                               		// gcm.APPR_REQUEST : 승인요청
                                                                    //, gcm.APPR_PROC : 승인/반려
                                                                    //, gcm.APPR_FIND : 승인현황조회(승인취소)
                      , intAprvNo:sAproId                      // 내부결재번호 (승인/반려 시 또는 조회 시에만 필요)
                      , cancelYn:"Y"                           // 승인을 취소할 수 있는 경우 “Y”
                      , intAprvTtl:"근로소득 중도정산"         // 내부결재제목
                      , intAprvReqOpinCn:""                    // 내부_결재_요청_의견_내용
                      , apprEmpno:dsSelMap.get("stafEmpno")    // 승인자사번
                      , apprEmpNm:dsSelMap.get("userNm")       // 승인자명
                      , intAprvAproOpinCn:""                   // 내부_결재_승인_의견_내용
                      , jobGbCd:"CM"                           // 업무구분코드
                      , menuId:"JJCM01"                        // 메뉴ID
                      , scrUrl:""                              // 화면_URL
                      }
                ,width:"600"
                ,height:"500"
                ,callbackFn:"scwin.fnPopupCallback"
        };

        svcIdPop = "intAprvProcPopup";

        com.popup_open(popOps);
    };

    //승인현황
    scwin.fnApprovalSitu = function() {
        var sAproId = dsSelMap.get( "aproId" );

        var popOps = {
                 popup_name:"승인현황"           // 팝업 타이틀  요청 시 “승인요청”, 승인/반려 시 “승인“, 조회 시 “승인현황＂
                ,url:"/ux/cf/CF00350502P.xml"
                ,data:{ gubunCd:gcm.APPR_FIND                 // gcm.APPR_REQUEST, gcm.APPR_PROC, gcm.APPR_FIND
                                                              		// gcm.APPR_REQUEST : 승인요청
                                                                    //, gcm.APPR_PROC : 승인/반려
                                                                    //, gcm.APPR_FIND : 승인현황조회(승인취소)
                      , intAprvNo:sAproId                     // 내부결재번호 (승인/반려 시 또는 조회 시에만 필요)
                      , cancelYn:"N"                          // 승인을 취소할 수 있는 경우 “Y”
                      , intAprvTtl:"근로소득 중도정산"        // 내부결재제목
                      , intAprvReqOpinCn:""                   // 내부_결재_요청_의견_내용
                      , apprEmpno:dsSelMap.get("stafEmpno")   // 승인자사번
                      , apprEmpNm:dsSelMap.get("userNm")      // 승인자명
                      , intAprvAproOpinCn:""                  // 내부_결재_승인_의견_내용
                      , jobGbCd:"CM"                          // 업무구분코드
                      , menuId:"JJCM01"                       // 메뉴ID
                      , scrUrl:""                             // 화면_URL
                     }
                ,width:"600"
                ,height:"430"
                ,callbackFn:"scwin.fnPopupCallback"
        };

        svcIdPop = "intAprvSituPopup";

        com.popup_open(popOps);
    };

    //버튼 제어
    scwin.fnBtnDisabled = function(row) {

        btnApproval.setDisabled( true );             	//승인
        btnApprovalSitu.setDisabled( true );         	//승인현황
        btnApprRequest.setDisabled( true );          	//승인요청
        btnSlipCreate.setDisabled( true );				//전표생성
        btnSlipCancel.setDisabled( true );				//전표생성취소

        if( eval(row) >= 0 ){
	        var sIntAprvStusCd = dsTcmErndIncmMdtAdjList.getCellData( row , "intAprvStusCd" ); 	//결제상태

	        var sStusCd       = dsTcmErndIncmMdtAdjList.getCellData( row , "stusCd" );       	//상태(정산상태, 결제상테)
	        var sPrgsStusCd   = dsTcmErndIncmMdtAdjList.getCellData( row , "prgsStusCd" );      //전표 상태
			var userId  	  = sessionStorage.getItem("userEmpno");    						// 사용자 ID

	        if( sStusCd == "CF00701" ){    				 										//미확정
		        if( dsSelMap.get("stafEmpno") == userId){
	            	btnApproval.setDisabled( false );        									//승인
	            }
	            btnApprovalSitu.setDisabled( false );    										//승인현황
	        } else  if( sStusCd == "CF00702" ){   		 										//확정
	            btnApprovalSitu.setDisabled( false );    										//승인현황
	        } else if( sStusCd == "CF00703" ){    		 										//반송
	        	if( dsSrchMap.get("laborGbn") != "TX" ){    									//원천세X
		        }
            	btnApprRequest.setDisabled( false );     										//승인요청
	            btnApprovalSitu.setDisabled( false );    										//승인현황
	        } else if( sStusCd == "X"){                  										//미정산

	        } else if( sStusCd == 'N'){                  										//미정산

	        } else if( sStusCd == 'Y'){                  										//정산
	        	if( dsSrchMap.get("laborGbn") != "TX" ){    									//원천세
	        		if( sPrgsStusCd == "" ){
	        			btnApprRequest.setDisabled( false );     								//승인요청
	        		}else if( sPrgsStusCd == "00" || sPrgsStusCd == "91"  ){
		        		btnApprRequest.setDisabled( false );     								//승인요청
		        	}else{
		        		btnApprRequest.setDisabled( true );     								//승인요청
		        	}

		        	if(  sIntAprvStusCd == "CF00703"){
		        		btnApprovalSitu.setDisabled( false );    								//승인현황
		        	}
	        	} else {
	        		btnApprRequest.setDisabled( false );     									//승인요청
	        	}

	        }
        }

        if( dsSrchMap.get("laborGbn")  == "TX" ){    											//원천세
        }

    };

	// 전표생성
	scwin.btnSlipCreate_onclick = function() {
 		var nRow = dsSelMap.get("row");

        if( eval(nRow) < 0 ){
        	com.showMessage("CMW0073");    																//전표생성할 대상을 선택하세요.
        	return false;
        }

		var sPayDt  = dsTcmErndIncmMdtAdjList.getCellData( nRow , "payDt" );   		 					//지급일자
 		if (com.isEmpty(sPayDt)) {
        	com.showMessage("CMW0025", "지급일자", "", "", grdTcmErndIncmMdtAdjList.id, nRow, "payDt");	//$1은(는) 필수입력사항입니다.
            return ;
        }
               
        var sHrIfYn         = dsTcmErndIncmMdtAdjList.getCellData( nRow , "hrIfYn" );           		//인사 인터페이스 여부
        if( sHrIfYn != 'Y'){
        	com.showMessage("CMW0096");     															//인사 연동후 전표생성 처리해주세요.
        	return ;
        }

        if( dsTcmErndIncmMdtAdjList.getCellData( nRow , "subtIncmAmt" )  == 0){
        	com.showMessage("CMW0137");     															//정산 금액이 존재하지 않습니다.
        	return ;
        }

		if (confirm("이전에 생성된 자료는 삭제됩니다. 전표자료를 생성 하시겠습니까?")) {
        	ajaxLib.ajax("/cm/cm4015/CM40150500U/saveTcmErndAdjSlipAcum", {
	            method : "POST",
	            requestData : dsSelMap.getJSON(),
	            callback : function(result, e){
					com.showMessage("SCN0002", "중도정산 전표자료가 생성");								//$1 되었습니다.
					scwin.fnSearchList();
				},
	            errCallback : "fnErrCallback"
	        });
		}

	};

	// 전표취소
	scwin.btnSlipCancel_onclick = function() {
 		var nRow = dsSelMap.get("row");

        if( eval(nRow) < 0 ){
        	com.showMessage("CMW0074");  																//전표취소할 대상을 선택하세요
        	return false;
        }

		var sPayDt  = dsTcmErndIncmMdtAdjList.getCellData( nRow , "payDt" );    						//지급일자
 		if (com.isEmpty(sPayDt)) {
        	com.showMessage("CMW0025", "지급일자", "", "", grdTcmErndIncmMdtAdjList.id, nRow, "payDt");	//$1은(는) 필수입력사항입니다.
            return ;
        }
        
		if (confirm("기 생성된 자료는 삭제됩니다. 전표자료생성을 취소 하시겠습니까?")) {
        	ajaxLib.ajax("/cm/cm4015/CM40150500U/saveTcmErndAdjSlipAcumCancel", {
	            method : "POST",
	            requestData : dsSelMap.getJSON(),
	            callback : function(result, e){
					com.showMessage("SCN0002", "취소");//$1 되었습니다.
					scwin.fnSearchList();
				},
	            errCallback : "fnErrCallback"
	        });
		}
	};

    // 승인요청 버튼 클릭 시 전표생성 데이터 확인
    scwin.fnSlipDataCheck = function(){
    	var dataExist = dsTcmAprvCheck.get("dataExist");
    	var slipExist = dsTcmAprvCheck.get("slipExist");

 		console.log("중도정산자료여부 : " + dataExist);
 		console.log("전표생성데이터여부 : " + slipExist);

 		if (dataExist == "N") {
			com.showMessage("CSA0008", "중도정산 자료");		//$1이(가) 존재하지 않습니다.
			return false;
 		}

		scwin.fnApprRequest(); //승인요청 호출

    };

    // 전표검증 서비스 호출 : 정산일 경우 "승인요청" 팝업 호출
    scwin.fnSlipJournalizing = function(){

    	console.log("serverDate : " +  serverDate);
		dsSelMap.set("serverDate", serverDate);	//서버시간

        ajaxLib.ajax("/cm/cm4015/CM40150500U/saveTcmErndAdjSlipCheck", {
            method : "POST",
            requestData : dsSelMap.getJSON(),
            callback : function(result, e){
				console.log("전표검증결과 : " + result.data);
				if (result.data == "S") {
					scwin.fnSearchList();       
				}
			},
            errCallback : "fnErrCallback"
        });
    }

	//버튼 제어
    scwin.fnBtnAllDisabled = function(bAllDisable) {

        btnAdj.setDisabled( bAllDisable );             	//정산
        btnNadj.setDisabled( bAllDisable );           	//정산 취소
        btnHrCnnt.setDisabled( bAllDisable );           //인사 연동
        btnSlipCreate.setDisabled( bAllDisable );		//전표생성
        btnSlipCancel.setDisabled( bAllDisable );		//전표생성취소
        btnApproval.setDisabled( bAllDisable );         //승인
        btnApprovalSitu.setDisabled( bAllDisable );     //승인현황
        btnApprRequest.setDisabled( bAllDisable );      //승인요청

        for( var nRow = 0 ; nRow < dsTcmErndIncmMdtAdjList.getRowCount() ; nRow++){
         	grdTcmErndIncmMdtAdjList.setCellReadOnly( nRow , 'chk'   , bAllDisable );   //선택 수정불가
         	grdTcmErndIncmMdtAdjList.setCellReadOnly( nRow , 'payDt' , bAllDisable );   //지급일자 수정불가
        }

    };]]></script>


		<w2:require src="/ux/common/udc/udcListCount.xml"></w2:require>
		<w2:require src="/ux/common/udc/udcSearchCode.xml"></w2:require>
		<w2:require src="/ux/common/udc/udcICnumber.xml"></w2:require>
		<w2:require src="/ux/common/udc/udcYearcalendar.xml"></w2:require>
	</head>
	<body ev:onpageload="scwin.onpageload" ev:onpageunload="scwin.onpageunload">
		<xf:group style="" id="" class="content_body">
			<xf:group class="navigator_wrap" id="" style="">
				<w2:wframe id="wfm_title" src="/ux/common/navigator.xml" style=""></w2:wframe>		<!-- 근로소득 중도정산관리 -->
			</xf:group>
			<xf:group class="tbl_search" id="" style="">
				<xf:group class="tb_list" id="" style="" tagname="table">
					<w2:attributes>
						<w2:summary>조회조건 테이블 입니다.</w2:summary>
					</w2:attributes>
					<xf:group tagname="colgroup">
						<xf:group style="width:96px;" tagname="col"></xf:group>
						<xf:group style="width:auto;" tagname="col"></xf:group>
						<xf:group style="width:96px;

" tagname="col"></xf:group>
						<xf:group style="width:auto;" tagname="col"></xf:group>
						<xf:group style="width:96px;" tagname="col"></xf:group>
						<xf:group style="width:auto;" tagname="col"></xf:group>
					</xf:group>
					<xf:group style="" tagname="tr">
						<xf:group class="w2tb_th req" style="" tagname="th">
							<w2:attributes>
								<w2:scope>row</w2:scope>
							</w2:attributes>
							<w2:span class="" id="spnSiteDept" label="현장명" style=""></w2:span>
						</xf:group>
						<xf:group class="w2tb_td" style="" tagname="td">
							<w2:wframe id="wfmKeySiteInfo" src="/WEB-INF/ux/cm/cmcomm/schSiteInfo.xml" style=""></w2:wframe>
                            <w2:wframe id="wfmKeyDeptInfo" src="/WEB-INF/ux/cm/cmcomm/schDeptInfo.xml" style="display: none;"></w2:wframe>
						</xf:group>
						<xf:group class="w2tb_th" style="" tagname="th">
							<w2:attributes>
								<w2:scope>row</w2:scope>
							</w2:attributes>
							<w2:span class="" id="" label="주민번호" style=""></w2:span>
						</xf:group>
						<xf:group class="w2tb_td" style="" tagname="td">
                            <xf:input allowChar="0-9-" displayFormat="######-#######" id="keyResnoEnc"  placeholder="______-_______"
											initValue="" maxlength="14" minlength="" ref="data:dsSrchMap.keyResnoEnc" style="width:120px;" ev:onviewchange="scwin.keyResnoEnc_onviewchange" ev:onkeydown="scwin.keyResnoEnc_onkeydown">
							</xf:input>
						</xf:group>
						<xf:group tagname="th" class="w2tb_th req">
							<w2:attributes>
								<w2:scope>row</w2:scope>
							</w2:attributes>
							<w2:span class="" id="" label="귀속구분" style=""></w2:span>
						</xf:group>
						<xf:group tagname="td" class="w2tb_td">
							<w2:attributes></w2:attributes>
							<xf:select1 appearance="full" cols="" id="" rows="1" selectedIndex="0" style="" ref="data:dsSrchMap.keyRsdnNrsdYn"
											renderType="radiogroup">
											<xf:choices>
															<xf:item>
																			<xf:label><![CDATA[거주자]]></xf:label>
																			<xf:value><![CDATA[Y]]></xf:value>
															</xf:item>
															<xf:item>
																			<xf:label><![CDATA[비거주자]]></xf:label>
																			<xf:value><![CDATA[N]]></xf:value>
															</xf:item>
											</xf:choices>
							</xf:select1>
						</xf:group>


					</xf:group>
					<xf:group style="" tagname="tr">
						<xf:group class="w2tb_th req" tagname="th" style="">
							<w2:attributes>
								<w2:scope>row</w2:scope>
							</w2:attributes>
							<w2:span class="" id="" label="내/외국인" style=""></w2:span>
						</xf:group><xf:group class="w2tb_td" tagname="td" style="">
							<w2:attributes></w2:attributes>
							<xf:select1 appearance="full" cols="" id="keyNtvFrgnYn" rows="1" selectedIndex="0" style=""
											ref="data:dsSrchMap.keyNtvFrgnYn" renderType="radiogroup">
											<xf:choices>
															<xf:item>
																			<xf:label><![CDATA[내국인]]></xf:label>
																			<xf:value><![CDATA[Y]]></xf:value>
															</xf:item>
															<xf:item>
																			<xf:label><![CDATA[외국인]]></xf:label>
																			<xf:value><![CDATA[N]]></xf:value>
															</xf:item>
											</xf:choices>
							</xf:select1>
</xf:group><xf:group class="w2tb_th req" style="" tagname="th">
							<w2:attributes>
								<w2:scope>row</w2:scope>
							</w2:attributes>
							<w2:span class="" id="" label="귀속연도" style=""></w2:span>
						</xf:group>
						<xf:group class="w2tb_td" style="" tagname="td">
							<w2:attributes>
								<w2:colspan>3</w2:colspan>
							</w2:attributes>
							<w2:inputCalendar calendarClass="" calendarValueType="year" focusOnDateSelect="false"
								footerDiv="false" id="keyPvtYear" renderDiv="true" renderType="component" rightAlign="false" style="width: 100px;"
								weekStartsOn="0" ref="data:dsSrchMap.keyPvtYear">
							</w2:inputCalendar>
						</xf:group>
					</xf:group>
				</xf:group>


				<xf:group class="btn_tbl_search" style="" tagname="">
					<w2:anchor class="btn_sh" id="btnFind" outerDiv="false" style="" ev:onclick="scwin.btnFind_onclick">
						<xf:label><![CDATA[조회]]></xf:label>
					</w2:anchor>
				</xf:group>
			</xf:group>
			<xf:group style="" id="" class="defaultbox">
				<w2:textbox label="근로소득 중도정산관리" style="" id="" class="df_tt" tagname="h3"></w2:textbox>
                <xf:group class="right_wrap" id="" style="">
                    <xf:group class="descbox" id="" style="">
                    </xf:group>
                    <xf:group id="" style="height:27px;">

                    	<w2:anchor class="btn_gcm " id="btnAdj" outerDiv="false" style=""
                    		ev:onclick="scwin.btnAdj_onclick">
                    		<xf:label><![CDATA[정산요청]]></xf:label>
                    	</w2:anchor>
                    	<w2:anchor class="btn_gcm " id="btnNadj" outerDiv="false" style=""
                    		ev:onclick="scwin.btnNadj_onclick">
                    		<xf:label><![CDATA[정산취소]]></xf:label>
                    	</w2:anchor>
                    	<w2:anchor class="btn_gcm " id="btnHrCnnt" outerDiv="false" style=""
                    		ev:onclick="scwin.btnHrCnnt_onclick">
                    		<xf:label><![CDATA[정산집계]]></xf:label>
                    	</w2:anchor>

                    	<w2:anchor class="btn_gcm " clickEventElement="" disabled=""
                    		ev:onclick="scwin.btnSlipCreate_onclick" id="btnSlipCreate" outerDiv="false" style="">
                    		<xf:label><![CDATA[전표생성]]></xf:label>
                    	</w2:anchor>
                    	<w2:anchor class="btn_gcm " clickEventElement="" disabled=""
                    		ev:onclick="scwin.btnSlipCancel_onclick" id="btnSlipCancel" outerDiv="false" style="">
                    		<xf:label><![CDATA[전표생성취소]]></xf:label>
                    	</w2:anchor>
                    	<w2:anchor class="btn_gcm " clickEventElement="" id="btnApprRequest" outerDiv="false"
                    		style="" ev:onclick="scwin.btnApprRequest_onclick">
                    		<xf:label><![CDATA[승인요청]]></xf:label>
                    	</w2:anchor>
                    	<w2:anchor class="btn_gcm " clickEventElement="" id="btnApproval" outerDiv="false" style=""
                    		ev:onclick="scwin.btnApproval_onclick">
                    		<xf:label><![CDATA[승인]]></xf:label>
                    	</w2:anchor>
                    	<w2:anchor class="btn_gcm " id="btnApprovalSitu" outerDiv="false" style=""
                    		ev:onclick="scwin.btnApprovalSitu_onclick">
                    		<xf:label><![CDATA[승인현황]]></xf:label>
                    	</w2:anchor>
						<w2:anchor class="btn_gcm excel_down" clickEventElement="" id="btnExcelDwn" localeRef=""
							outerDiv="false" style="" toolTip="엑셀다운로드" ev:onclick="scwin.btnExcelDwn_onclick">
							<xf:label><![CDATA[엑셀다운로드]]></xf:label>
						</w2:anchor>
                    </xf:group>
                </xf:group>

			</xf:group>
			<w2:gridView readOnly="true" autoFit="allColumn" class="autoHeight" dataList="data:dsTcmErndIncmMdtAdjList"
				fixedColumnWithHidden="true" focusMode="row" id="grdTcmErndIncmMdtAdjList" rowNumHeaderValue="No" rowNumVisible=""
				rowStatusHeaderValue="" rowStatusVisible="" rowStatusWidth="30" scrollByColumn="false" style="height: 300px;"
				useShiftKey="true" visibleRowNum="" ev:oncellclick="scwin.grdTcmErndIncmMdtAdjList_oncellclick"
				ev:oncellindexchange="scwin.grdTcmErndIncmMdtAdjList_oncellindexchange">
				<w2:header id="header1" style="">
					<w2:row id="row2" style="">
						<w2:column removeBorderStyle="false" width="40" inputType="text" id="column51" value="선택"
							blockSelect="false" displayMode="label" style="">
						</w2:column>
						<w2:column blockSelect="false" displayMode="label" id="column49" inputType="text"
							removeBorderStyle="false" value="NO" width="40" style="">
						</w2:column>
						<w2:column removeBorderStyle="false" width="170" inputType="text" id="column68" value="전표상태"
							blockSelect="false" displayMode="label" style="">
						</w2:column>
						<w2:column removeBorderStyle="false" width="170" inputType="text" id="column55" value="상태"
							blockSelect="false" displayMode="label" style="">
						</w2:column>
						<w2:column blockSelect="false" id="column21" inputType="text" value="주민번호" width="130" style="">
						</w2:column>
						<w2:column blockSelect="false" id="column19" inputType="text" value="성명" width="120" style="">
						</w2:column>
						<w2:column removeBorderStyle="false" width="120" inputType="text" id="column54" value="회계일자"
							blockSelect="false" displayMode="label" style="">
						</w2:column>
						<w2:column blockSelect="false" id="column17" inputType="text" value="귀속연월 From" width="120" style="">
						</w2:column>
						<w2:column blockSelect="false" id="column15" inputType="text" value="귀속연월 To" width="120" style="">
						</w2:column>
						<w2:column blockSelect="false" displayMode="label" id="column37" inputType="text"
							removeBorderStyle="false" value="내/외국인" width="120" style="">
						</w2:column>
						<w2:column blockSelect="false" displayMode="label" id="column35" inputType="text"
							removeBorderStyle="false" value="거주구분" width="120" style="">
						</w2:column>
						<w2:column removeBorderStyle="false" width="120" inputType="text" id="column72" value="총급여"
							blockSelect="false" displayMode="label" style="">
						</w2:column>
						<w2:column removeBorderStyle="false" width="120" inputType="text" id="column69" value="기납부 소득세"
							blockSelect="false" displayMode="label" style="">
						</w2:column>
						<w2:column removeBorderStyle="false" width="120" inputType="text" id="column71" value="기납부 주민세"
							blockSelect="false" displayMode="label" style="">
						</w2:column>
						<w2:column removeBorderStyle="false" width="120" inputType="text" id="column57" value="결정 소득세"
							blockSelect="false" displayMode="label" style="">
						</w2:column>
						<w2:column removeBorderStyle="false" width="120" inputType="text" id="column59"
							blockSelect="false" displayMode="label" value="결정 주민세" style="">
						</w2:column>
						<w2:column removeBorderStyle="false" width="120" inputType="text" id="column65" value="차감 소득금액"
							blockSelect="false" displayMode="label" style="">
						</w2:column>
					</w2:row>
				</w2:header>
				<w2:gBody id="gBody4" style="">
					<w2:row id="row5" style="">
						<w2:column removeBorderStyle="false" width="40" inputType="checkbox" id="chk" value="N"
							blockSelect="false" displayMode="label" falseValue="N" trueValue="Y" valueType="other" readOnly="false">
						</w2:column>
						<w2:column blockSelect="false" displayMode="label" expression="rowindex()+1" id="column50"
							inputType="expression" removeBorderStyle="false" style="height:24px;" width="40">
						</w2:column>
						<w2:column removeBorderStyle="false" width="170" inputType="text" id="prgsStusNm"
							blockSelect="false" displayMode="label">
						</w2:column>
						<w2:column removeBorderStyle="false" width="170" inputType="select" id="stusCd"
							blockSelect="false" displayMode="label">
							<w2:choices>
								<w2:itemset nodeset="data:dsStusCdList">
									<w2:label ref="cdNm"></w2:label>
									<w2:value ref="cd"></w2:value>
								</w2:itemset>
							</w2:choices>
						</w2:column>
						<w2:column blockSelect="false" id="resnoEnc" inputType="text" style="height:24px;" width="130"
							displayFormat="######-#######">
						</w2:column>
						<w2:column blockSelect="false" id="wkrNm" inputType="text" style="height:24px;" width="120">
						</w2:column>
						<w2:column removeBorderStyle="false" width="120" inputType="calendar" id="payDt"
							blockSelect="false" displayMode="label" readOnly="false" viewType="icon">
						</w2:column>
						<w2:column blockSelect="false" id="rvtStrtYm" inputType="text" style="height:24px;" width="120"
							displayFormat="####-##">
						</w2:column>
						<w2:column blockSelect="false" id="rvtEndYm" inputType="text" style="height:24px;" width="120"
							displayFormat="####-##">
						</w2:column>
						<w2:column blockSelect="false" displayMode="label" id="ntvFrgnYn" inputType="select"
							removeBorderStyle="false" style="height:24px;" value="내국인" width="120">
							<w2:choices>
								<w2:item>
									<w2:label><![CDATA[내국인]]></w2:label>
									<w2:value><![CDATA[Y]]></w2:value>
								</w2:item>
								<w2:item>
									<w2:label><![CDATA[외국인]]></w2:label>
									<w2:value><![CDATA[N]]></w2:value>
								</w2:item>
							</w2:choices>
						</w2:column>
						<w2:column blockSelect="false" displayMode="label" id="rsdnNrsdYn" inputType="select"
							removeBorderStyle="false" style="height:24px;" value="거주자" width="120">
							<w2:choices>
								<w2:item>
									<w2:label><![CDATA[거주자]]></w2:label>
									<w2:value><![CDATA[Y]]></w2:value>
								</w2:item>
								<w2:item>
									<w2:label><![CDATA[비거주자]]></w2:label>
									<w2:value><![CDATA[N]]></w2:value>
								</w2:item>
							</w2:choices>
						</w2:column>
						<w2:column removeBorderStyle="false" width="120" inputType="text" id="totSalAmt"
							blockSelect="false" displayMode="label" displayFormat="#,###" dataType="number" textAlign="right">
						</w2:column>
						<w2:column removeBorderStyle="false" width="120" inputType="text" id="prvpyTxamtIctxAmt"
							blockSelect="false" displayMode="label" displayFormat="#,###" textAlign="right" dataType="number">
						</w2:column>
						<w2:column removeBorderStyle="false" width="120" inputType="text" id="prvpyTxamtRstxAmt"
							blockSelect="false" displayMode="label" displayFormat="#,###" textAlign="right" dataType="number">
						</w2:column>
						<w2:column removeBorderStyle="false" width="120" inputType="text" id="dcsnTxamtIctxAmt"
							blockSelect="false" displayMode="label" displayFormat="#,###" textAlign="right" dataType="number">
						</w2:column>
						<w2:column removeBorderStyle="false" width="120" inputType="text" id="dcsnTxamtRstxAmt"
							blockSelect="false" displayMode="label" displayFormat="#,###" textAlign="right" dataType="number">
						</w2:column>
						<w2:column removeBorderStyle="false" width="120" inputType="text" id="subtIncmAmt"
							blockSelect="false" displayMode="label" displayFormat="#,###" textAlign="right" dataType="number">
						</w2:column>
					</w2:row>
				</w2:gBody>
			</w2:gridView>

		</xf:group>
	</body>
</html>
