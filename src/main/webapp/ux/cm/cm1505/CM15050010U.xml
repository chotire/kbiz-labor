<?xml version="1.0" encoding="UTF-8"?>

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:ev="http://www.w3.org/2001/xml-events"
    xmlns:w2="http://www.inswave.com/websquare" xmlns:xf="http://www.w3.org/2002/xforms">
    <head>
        <w2:type>DEFAULT</w2:type>
        <w2:buildDate />
        <xf:model>
            <xf:instance>
                <data xmlns="" />
            </xf:instance>
            <w2:dataCollection baseNode="map">
                <w2:dataMap baseNode="map" id="dsSearchMap" style="">
                    <w2:keyInfo>
                        <w2:key dataType="text" id="siteCd" name="현장코드"></w2:key>
                        <w2:key dataType="text" id="actbgtPrgsYn" name="실행예산_진행_여부"></w2:key>
                        <w2:key dataType="text" id="firstPrgsYn" name="최초작엽여부"></w2:key>
                        <w2:key dataType="number" id="chgStusGbCdCnt" name="실행예산작업 추초과건수"></w2:key>
                        <w2:key dataType="text" id="upperBgtItemiCd" name="상위내역코드"></w2:key>
                        <w2:key id="chgDgr" name="변경차수" dataType="number"></w2:key>
                        <w2:key id="delYn" name="삭제포함여부" dataType="text"></w2:key>
                        <w2:key id="colHiddenYn" name="변경전 숨김여부" dataType="text"></w2:key>
                        <w2:key id="contColHiddenYn" name="도급예산 숨김여부" dataType="text"></w2:key>
                    </w2:keyInfo>
                </w2:dataMap>
                <w2:dataList baseNode="list" ev:oncelldatachange="scwin.dsActbgtWorkList_oncelldatachange"
                    ev:ondataload="scwin.dsActbgtConfmList_ondataload" id="dsActbgtWorkList" repeatNode="map" saveRemovedData="true"
                    style="" ev:onbeforecelldatachange="scwin.dsActbgtWorkList_onbeforecelldatachange">
                    <w2:columnInfo>
                        <w2:column dataType="text" id="rowStatus" name="상태값"></w2:column>
                        <w2:column dataType="text" id="chk" name="체크박스"></w2:column>
                        <w2:column dataType="text" id="gubun" name="구분"></w2:column>
                        <w2:column dataType="text" id="siteCd" name="현장코드"></w2:column>
                        <w2:column dataType="text" id="bgtItemiCd" name="예산내역코드"></w2:column>
                        <w2:column dataType="text" id="bgtItemiNm" name="품명"></w2:column>
                        <w2:column dataType="text" id="upperBgtItemiCd" name="상위공종코드"></w2:column>
                        <w2:column dataType="text" id="itemiYn" name="내역_여부"></w2:column>
                        <w2:column dataType="text" id="bgtItemiStdr" name="규격"></w2:column>
                        <w2:column dataType="text" id="bgtItemiUnit" name="단위"></w2:column>
                        <w2:column id="chgDgr" name="변경_차수" dataType="text"></w2:column>
                        <w2:column id="chgbfItexpGb" name="변경전_비목구분" dataType="text"></w2:column>
                        <w2:column id="chgbfContQty" name="변경전_도급_수량" dataType="number"></w2:column>
                        <w2:column id="chgbfContUct" name="변경전_도급_단가" dataType="number"></w2:column>
                        <w2:column id="chgbfContAmt" name="변경전_도급_금액" dataType="number"></w2:column>
                        <w2:column id="chgbfContMtrctUct" name="변경전_도급_재료비_단가" dataType="number"></w2:column>
                        <w2:column id="chgbfContMtrctAmt" name="변경전_도급_재료비_금액" dataType="number"></w2:column>
                        <w2:column id="chgbfContLbctUct" name="변경전_도급_노무비_단가" dataType="number"></w2:column>
                        <w2:column id="chgbfContLbctAmt" name="변경전_도급_노무비_금액" dataType="number"></w2:column>
                        <w2:column id="chgbfContExpnsUct" name="변경전_도급_경비_단가" dataType="number"></w2:column>
                        <w2:column id="chgbfContExpnsAmt" name="변경전_도급_경비_금액" dataType="number"></w2:column>
                        <w2:column id="chgbfActbgtQty" name="변경전_실행예산_수량" dataType="number"></w2:column>
                        <w2:column id="chgbfActbgtUct" name="변경전_실행예산_단가" dataType="number"></w2:column>
                        <w2:column id="chgbfActbgtAmt" name="변경전_실행예산_금액" dataType="number"></w2:column>
                        <w2:column id="chgbfActbgtMtrctUct" name="변경전_실행예산_재료비_단가" dataType="number"></w2:column>
                        <w2:column id="chgbfActbgtMtrctAmt" name="변경전_실행예산_재료비_금액" dataType="number"></w2:column>
                        <w2:column id="chgbfActbgtLbctUct" name="변경전_실행예산_노무비_단가" dataType="number"></w2:column>
                        <w2:column id="chgbfActbgtLbctAmt" name="변경전_실행예산_노무비_금액" dataType="number"></w2:column>
                        <w2:column id="chgbfActbgtExpnsUct" name="변경전_실행예산_경비_단가" dataType="number"></w2:column>
                        <w2:column id="chgbfActbgtExpnsAmt" name="변경전_실행예산_경비_금액" dataType="number"></w2:column>
                        <w2:column id="chgbfPlActbgtQty" name="변경전_손익_실행예산_수량" dataType="number"></w2:column>
                        <w2:column id="chgbfPlActbgtUct" name="변경전_손익_실행예산_단가" dataType="number"></w2:column>
                        <w2:column id="chgbfPlActbgtAmt" name="변경전_손익_실행예산_금액" dataType="number"></w2:column>
                        <w2:column id="chgbfPlActbgtMtrctUct" name="변경전_손익_실행예산_재료비_단가" dataType="number"></w2:column>
                        <w2:column id="chgbfPlActbgtMtrctAmt" name="변경전_손익_실행예산_재료비_금액" dataType="number"></w2:column>
                        <w2:column id="chgbfPlActbgtLbctUct" name="변경전_손익_실행예산_노무비_단가" dataType="number"></w2:column>
                        <w2:column id="chgbfPlActbgtLbctAmt" name="변경전_손익_실행예산_노무비_금액" dataType="number"></w2:column>
                        <w2:column id="chgbfPlActbgtExpnsUct" name="변경전_손익_실행예산_경비_단가" dataType="number"></w2:column>
                        <w2:column id="chgbfPlActbgtExpnsAmt" name="변경전_손익_실행예산_경비_금액" dataType="number"></w2:column>

                        <w2:column id="itexpGb" name="비목" dataType="text"></w2:column>
                        <w2:column id="contQty" name="도급_수량" dataType="number"></w2:column>
                        <w2:column id="contUct" name="도급_단가" dataType="number"></w2:column>
                        <w2:column id="contAmt" name="도급_금액" dataType="number"></w2:column>
                        <w2:column id="contMtrctUct" name="도급_재료비_단가" dataType="number"></w2:column>
                        <w2:column id="contMtrctAmt" name="도급_재료비_금액" dataType="number"></w2:column>
                        <w2:column id="contLbctUct" name="도급_노무비_단가" dataType="number"></w2:column>
                        <w2:column id="contLbctAmt" name="도급_노무비_금액" dataType="number"></w2:column>
                        <w2:column id="contExpnsUct" name="도급_경비_단가" dataType="number"></w2:column>
                        <w2:column id="contExpnsAmt" name="도급_경비_금액" dataType="number"></w2:column>
                        <w2:column id="actbgtQty" name="실행예산_수량" dataType="number"></w2:column>
                        <w2:column id="actbgtUct" name="실행예산_단가" dataType="number"></w2:column>
                        <w2:column id="actbgtAmt" name="실행예산_금액" dataType="number"></w2:column>
                        <w2:column id="actbgtMtrctUct" name="실행예산_재료비_단가" dataType="number"></w2:column>
                        <w2:column id="actbgtMtrctAmt" name="실행예산_재료비_금액" dataType="number"></w2:column>
                        <w2:column id="actbgtLbctUct" name="실행예산_노무비_단가" dataType="number"></w2:column>
                        <w2:column id="actbgtLbctAmt" name="실행예산_노무비_금액" dataType="number"></w2:column>
                        <w2:column id="actbgtExpnsUct" name="실행예산_경비_단가" dataType="number"></w2:column>
                        <w2:column id="actbgtExpnsAmt" name="실행예산_경비_금액" dataType="number"></w2:column>
                        <w2:column id="plActbgtQty" name="손익_실행예산_수량" dataType="number"></w2:column>
                        <w2:column id="plActbgtUct" name="손익_실행예산_단가" dataType="number"></w2:column>
                        <w2:column id="plActbgtAmt" name="손익_실행예산_금액" dataType="number"></w2:column>
                        <w2:column id="plActbgtMtrctUct" name="손익_실행예산_재료비_단가" dataType="number"></w2:column>
                        <w2:column id="plActbgtMtrctAmt" name="손익_실행예산_재료비_금액" dataType="number"></w2:column>
                        <w2:column id="plActbgtLbctUct" name="손익_실행예산_노무비_단가" dataType="number"></w2:column>
                        <w2:column id="plActbgtLbctAmt" name="손익_실행예산_노무비_금액" dataType="number"></w2:column>
                        <w2:column id="plActbgtExpnsUct" name="손익_실행예산_경비_단가" dataType="number"></w2:column>
                        <w2:column id="plActbgtExpnsAmt" name="손익_실행예산_경비_금액" dataType="number"></w2:column>

                        <w2:column id="incContQty" name="증감_도급_수량" dataType="number"></w2:column>
                        <w2:column id="incContUct" name="증감_도급_단가" dataType="number"></w2:column>
                        <w2:column id="incContAmt" name="증감_도급_금액" dataType="number"></w2:column>
                        <w2:column id="incActbgtQty" name="증감_실행_수량" dataType="number"></w2:column>
                        <w2:column id="incActbgtUct" name="증감_실행_단가" dataType="number"></w2:column>
                        <w2:column id="incActbgtAmt" name="증감_실행_금액" dataType="number"></w2:column>
                        <w2:column id="incPlActbgtUct" name="증감_손익_실행_단가" dataType="number"></w2:column>
                        <w2:column id="incPlActbgtAmt" name="증감_손익_실행_금액" dataType="number"></w2:column>
                        <w2:column id="actbgtRt" name="실행원가율" dataType="number"></w2:column>
                        <w2:column id="pcostQty" name="집행_원가_수량" dataType="number"></w2:column>
                        <w2:column id="pcostAmt" name="집행_원가_금액" dataType="number"></w2:column>
                        <w2:column id="rmkCn" name="비고_내용" dataType="text"></w2:column>
                        <w2:column id="stndItemiCd" name="표준_내역_코드" dataType="text"></w2:column>
                        <w2:column id="stndItemiNm" name="표준_내역_명" dataType="text"></w2:column>
                        <w2:column id="sortOdr" name="정렬_순서" dataType="number"></w2:column>
                        <w2:column id="lowCnt" name="하위레벨건수" dataType="number"></w2:column>
                        <w2:column id="bgtItemiLv" name="예산_내역_레벨" dataType="text"></w2:column>
                        <w2:column id="itemiYnNext" name="다음로우의 내역구분" dataType="text"></w2:column>
                        <w2:column id="popStndJobtypCd" name="표준공통팝업버튼" dataType="text"></w2:column>
                        <w2:column id="mngctBgtAmt" name="현장관리비 예산금액" dataType="number"></w2:column>
                        <w2:column id="actbgtChgTypeCd" name="실행예산변경유형코드" dataType="text"></w2:column>
                        <w2:column id="cntrtPrgsYn" name="계약진행여부" dataType="text"></w2:column>
                        <w2:column id="cntrtQty" name="계약완료수량" dataType="number"></w2:column>
                        <w2:column id="dstbBgtItemiCd" name="배분_예산내역코드" dataType="text"></w2:column>
                        <w2:column id="chgStusGbVal" name="변경_상태_구분_값" dataType="text"></w2:column>
                        <w2:column id="chgAprvPrgsYn" name="변경_결재_진행_여부" dataType="text"></w2:column>
                        <w2:column id="contConfmYn" name="도급_확정_여부" dataType="text"></w2:column>
                        <w2:column id="contConfmAprvPrgsYn" name="도급_확정_결재_진행_여부" dataType="text"></w2:column>
                        <w2:column id="workDstbBgtItemiCd" name="작업_배분_예산내역코드" dataType="text"></w2:column>
                        <w2:column id="bgtItemiJnlzYn" name="예산_내역_분개_여부" dataType="text"></w2:column>
                        <w2:column id="bgtItexpChgYn" name="예산_비목_변경_여부" dataType="text"></w2:column>
                        <w2:column id="bgtAmtVrtnYn" name="예산_금액_증감_여부" dataType="text"></w2:column>
                        <w2:column id="bgtNewAddYn" name="예산_신규_추가_여부" dataType="text"></w2:column>
                        <w2:column id="ctrlTypeCd" name="통제유형코드" dataType="text"></w2:column>
                        <w2:column id="exctAproYn" name="집행_승인_여부" dataType="text"></w2:column>
                        <w2:column id="originalYn" name="원본여부" dataType="text"></w2:column>
                        <w2:column id="bgtDividePath" name="분개공종경로" dataType="text"></w2:column>
                    </w2:columnInfo>
                    <w2:data use="false"></w2:data>
                </w2:dataList>
                <w2:dataList baseNode="list" id="dsUpperActbgtWorkList" repeatNode="map" saveRemovedData="true"
                    style="">
                    <w2:columnInfo>
                        <w2:column dataType="text" id="bgtItemiCd" name="공종코드"></w2:column>
                        <w2:column dataType="text" id="bgtItemiNm" name="공종명"></w2:column>
                        <w2:column dataType="text" id="upperBgtItemiCd" name="상위공종코드"></w2:column>
                        <w2:column dataType="number" id="bgtItemiLv" name="공종레벨"></w2:column>
                        <w2:column dataType="text" id="itemiYn" name="내역여부"></w2:column>
                        <w2:column dataType="text" id="sortOdr" name="정렬"></w2:column>
                        <w2:column id="upperItemiExistsCnt" name="하위공종건수" dataType="number"></w2:column>
                        <w2:column id="itemiExistsCnt" name="하위내역건수" dataType="number"></w2:column>
                    </w2:columnInfo>
                    <w2:data use="true"></w2:data>
                </w2:dataList>
                <w2:dataMap baseNode="map" id="dsBgtGbCd" style="">
                    <w2:keyInfo>
                        <w2:key dataType="text" id="chgDgr" name="변경차수"></w2:key>
                        <w2:key dataType="text" id="actbgtChgTypeCd" name="실행예산변경유형코드"></w2:key>
                        <w2:key dataType="number" id="actbgtChgTypeNm" name="실행예산변경유형명"></w2:key>
                        <w2:key dataType="text" id="fnncConfStusCd" name="재무확인상태코드"></w2:key>
                        <w2:key dataType="text" id="fnncConfStusNm" name="재무확인상태명"></w2:key>
                        <w2:key dataType="text" id="actbgtPrgsYn" name="실행예산_진행_여부"></w2:key>
                    </w2:keyInfo>
                </w2:dataMap>
                <w2:dataList baseNode="list" ev:oncelldatachange="scwin.dsActbgtConfmList_oncelldatachange"
                    ev:ondataload="scwin.dsActbgtConfmList_ondataload" id="dsActbgtWorkTotalList" repeatNode="map"
                    saveRemovedData="true" style="">
                    <w2:columnInfo>
                        <w2:column dataType="text" id="siteCd" name="현장코드"></w2:column>
                        <w2:column dataType="text" id="bgtItemiCd" name="예산내역코드"></w2:column>
                        <w2:column dataType="text" id="bgtItemiNm" name="품명"></w2:column>
                        <w2:column dataType="text" id="upperBgtItemiCd" name="상위공종코드"></w2:column>
                        <w2:column dataType="text" id="itemiYn" name="내역_여부"></w2:column>
                        <w2:column dataType="text" id="bgtItemiStdr" name="규격"></w2:column>
                        <w2:column dataType="text" id="bgtItemiUnit" name="단위"></w2:column>
                        <w2:column dataType="text" id="itexpGb" name="비목구분"></w2:column>
                        <w2:column id="itexpNm" name="비목명" dataType="text"></w2:column>
                        <w2:column dataType="number" id="actbgtQty" name="실행예산_수량"></w2:column>
                        <w2:column dataType="number" id="actbgtMtrctUct" name="실행예산_재료비_단가"></w2:column>
                        <w2:column dataType="number" id="actbgtLbctUct" name="실행예산_노무비_단가"></w2:column>
                        <w2:column dataType="number" id="actbgtExpnsUct" name="실행예산_경비_단가"></w2:column>
                        <w2:column dataType="number" id="actbgtUct" name="실행예산_단가"></w2:column>
                        <w2:column dataType="number" id="actbgtAmt" name="실행예산_금액"></w2:column>
                        <w2:column dataType="number" id="pcostQty" name="집행_원가_수량"></w2:column>
                        <w2:column dataType="number" id="pcostAmt" name="집행_원가_금액"></w2:column>
                        <w2:column dataType="number" id="sortOdr" name="정렬_순서"></w2:column>
                        <w2:column dataType="number" id="contMtrctUct" name="도급_재료_비용_단가 "></w2:column>
                        <w2:column dataType="number" id="contLbctUct" name="도급_노무비_단가 "></w2:column>
                        <w2:column dataType="number" id="contExpnsUct" name="도급_경비_단가 "></w2:column>
                        <w2:column dataType="number" id="contQty" name="도급_수량 "></w2:column>
                        <w2:column dataType="number" id="contUct" name="도급_단가"></w2:column>
                        <w2:column dataType="number" id="contAmt" name="도급_금액"></w2:column>
                        <w2:column dataType="text" id="bgtItemiLv" name="예산_내역_레벨"></w2:column>
                        <w2:column dataType="number" id="mngctBgtAmt" name="현장관리비 예산금액"></w2:column>
                        <w2:column dataType="text" id="actbgtChgTypeCd" name="실행예산변경유형코드"></w2:column>
                        <w2:column dataType="number" id="sitedQty" name="현설 수량"></w2:column>
                        <w2:column dataType="number" id="sitedAmt" name="현설 금액"></w2:column>
                        <w2:column dataType="text" id="chgStusGbVal" name="변경_상태_구분_값"></w2:column>
                        <w2:column id="actbgtChgTypeNm" name="실행예산변경유형명" dataType="text"></w2:column>
                        <w2:column id="cntrtPrgsYn" name="계약진행여부" dataType="text"></w2:column>
                        <w2:column id="chgAprvPrgsYn" name="변경_결재_진행_여부" dataType="text"></w2:column>
                    </w2:columnInfo>
                    <w2:data use="false"></w2:data>
                </w2:dataList>
            </w2:dataCollection>
            <w2:workflowCollection></w2:workflowCollection>
        </xf:model>
        <script src="/resources/js/common/cmn_CM.js" type="javascript" lazy="false"/>
        <script type="javascript" lazy="false"><![CDATA[
/**************************************************************************

 * 컬럼별 disable 처리 관련 사항.
    1. 내역에서 계약이 진행 중인 건은 모든 수정 불가.
    2. 계약이 되지 않은 건은 모든 수정 가능.
       단, 변경 전 수량이 1식인 경우는 단가만 수정가능.
           내역추가 건은 변경 전 수량이 없으므로 모든 컬럼 수정가능.
    3. 손익실행예산 컬럼들은 실행예산 컬럼이 변경되는 대로 같이 변경해준다.


 * 내역분개에 대한 정리
    1. 컬럼용도
      DSTB_BGT_ITEMI_CD : 분개한 내역의 hitory 성으로 분개한 어미와 자식 내역코드를 나타냄.
                          이후 어미내역코드 기준으로 sum 할 필요가 있음.
                          AS IS는 결재완료시 NULL 처리했으나 SUM 할 용도로 남겨놓기로 함.
      WORK_DSTB_BGT_ITEMI_CD : 결재상신시만 사용함. 어미와 자식간의 관계 구분용.
                               어미가 다른 분개 내역들을 동시에 상신할 경우
                               어미와 자식간의 내역을 알 수가 없기에
                               자식코드는 어미의 내역코드를 넣는 것으로 구분.

    2. 내역분개시 자식내역의 DSTB_BGT_ITEMI_CD 에 어미 내역코드를 넣는다.
                  어미내역의 DSTB_BGT_ITEMI_CD 변경하지 않는다.

    3. 내역분개시 자식내역의 WORK_DSTB_BGT_ITEMI_CD 에 어미 내역코드를 넣는다.
                  어미내역의 WORK_DSTB_BGT_ITEMI_CD 에는 변경하지 않는다. 이력관리용도.


 **************************************************************************/

/**************************************************************************
 * [1] onpageload(초기화포함)
 **************************************************************************/

    scwin.onpageload = function() {
        scwin.fnInitial();
    };

    /** 화면초기화 **/
    scwin.fnInitial = function() {
        btnStndSave.hide();
            
        //세션의 현장코드를 셋팅
        cmCom.setSite(wfmKeySiteInfo.getWindow());

        //조회조건 예산변경유형 코드셋팅
        com.selCdListVrbl("sbxActbgtChgType", {
            "upperCd": "CM004001",
            "charValN3": "Y"
            },
            "scwin.fnButtonControl()"
        );

        com.selCdListVrbl("grdActbgtWorkList:actbgtChgTypeCd", {"upperCd": "CM004001","charValN3": "Y"});
        //com.selCdListVrbl("grdActbgtWorkList:itexpGb", {"upperCd": "CM004100","setCd": "charValN1"});
        //com.setGridFix("grdActbgtWorkList", "udcGrdFix");
        
        com.selCdListVrbl("grdActbgtWorkList:itexpGb", {
            "upperCd": "CM004100",
            "setCd": "charValN1"
        });         

        scwin.chkColHidden_onchange();
        scwin.chkContColHidden_onchange();
        
        //UI팀용 함수 호출
        com.autoHeight();        
        
        if ((sessionStorage.deptCd != "869" ) && (sessionStorage.userId != "erptf")){
            btnAddPopup.visible(false);
        }
        
    };

/**************************************************************************
 * [2] 사용자 정의함수
 **************************************************************************/

    //상세정보(내역) 조회
    /* param1 : 조회될 UpperBgtItemiCd 상위공종코드
       param2 : 조회 후 포커스가 가게될 내역코드
    */
    scwin.fnSearchActbgtItemiList = function(sFindBgtItemiCd, sFocusBgtItemiCd) {
        dsActbgtWorkList.removeAll();
        dsSearchMap.set("upperBgtItemiCd", sFindBgtItemiCd);

        if (dsUpperActbgtWorkList.getCellData(trvUpperActbgtWork.getSelectedIndex()-1, "itemiExistsCnt") > 0){
            var sUrl = "selectActbgtWorkItemiList";
        } else {
            var sUrl = "selectActbgtWorkList";
        }

        ajaxLib.ajax("/cm/cm1505/CM15050010U/"+sUrl, {
            method: "POST",
            requestData: dsSearchMap.getJSON(),
            callback: function(result, e){
                dsActbgtWorkList.setJSON(result.data);
                var nIndex = dsActbgtWorkList.getMatchedIndex("bgtItemiCd", sFocusBgtItemiCd, true, 0, dsActbgtWorkList.getTotalRow());
                grdActbgtWorkList.setFocusedCell(nIndex[0], "chk", false);   //선택된 ROW로 focus 이동

                //컬럼별 disable
                for (var i=0; i < dsActbgtWorkList.getTotalRow(); i++ ){
                    if (dsActbgtWorkList.getCellData(i, "lowCnt") > 0) {    //하위내역 존재시 삭제 불가
                        grdActbgtWorkList.setDisabled("cell", i, "chk", true);
                    }

                    var nChgDgr = dsActbgtWorkList.getCellData(i, "chgDgr");                    //변경차수
                    var sCntrtPrgsYn = dsActbgtWorkList.getCellData(i, "cntrtPrgsYn");          //계약진행여부
                    var sChgStusGbVal = dsActbgtWorkList.getCellData(i, "chgStusGbVal");        //변경_상태_구분_값
                    var sItemiYn = dsActbgtWorkList.getCellData(i, "itemiYn");                  //내역여부
                    var sActbgtChgTypeCd = dsActbgtWorkList.getCellData(i, "actbgtChgTypeCd");  //구분-예산변경유형

                    if (sItemiYn == "Y") {
                        if ((nChgDgr == "0") || (nChgDgr == "")) {

                            //예산변경유형별 컬럼 disable
                            if (["I"].indexOf(sChgStusGbVal) > -1) {
                                var sVal = "I";
                            } else {
                                var sVal = "S";
                            }

                            //분개한 내역(직영집행, 변경조정)일 경우 어미의 변경 전 수량 컬럼을 가져와서 1식 여부 판단한다.
                            if (["CM0040016", "CM0040011", "CM0040012"].indexOf(sActbgtChgTypeCd) > -1){
                                var nMatchIndex = dsActbgtWorkList.getMatchedIndex("bgtItemiCd", dsActbgtWorkList.getCellData(i, "workDstbBgtItemiCd"));
                                var nChgbfContQty = Math.abs(dsActbgtWorkList.getCellData(nMatchIndex, "chgbfContQty"));
                                var nChgbfActbgtQty = Math.abs(dsActbgtWorkList.getCellData(nMatchIndex, "chgbfActbgtQty"));
                            } else {
                                var nChgbfcontQty = 0;
                                var nChgbfActbgtQty = 0;
                            }
                            scwin.fnGridColumnControl(sbxActbgtChgType.getValue(), i, sVal, nChgbfActbgtQty, nChgbfContQty);
                        } else {    //변경차수 존재.. 결재진행 중인 경우 수정불가.
                            grdActbgtWorkList.setRowDisabled(i, true);
                            scwin.fnGridColumnControl(sbxActbgtChgType.getValue(), i, "S");
                        }
                    } else {
                        scwin.fnGridColumnControl(sbxActbgtChgType.getValue(), i, "S");
                    }

                    dsActbgtWorkList.modifyAllStatus("R");
                }

            },
            errCallback: function(result, e) {
            }
        });
    };

    //예산변경유형에 따른 버튼 disable
    scwin.fnButtonControl = function() {
        if (dsSearchMap.get("siteCd") == ""){
            return;
        }

        btnItemPopup.setDisabled(false);
        let sActbgtChgType = sbxActbgtChgType.getValue();

        //내역을 조회하면서 예산변경유형을 추가로 했을 경우만 버튼 활성화
        if (trvUpperActbgtWork.getSelectedValue() != ""){
            if (sbxActbgtChgType.getValue() == "CM0040014") {
                btnAddPopup.setDisabled(false);
            } else {
                btnAddPopup.setDisabled(true);     
            }
        }

        //실행예산확정 진행 중인 경우 저장 불가
        if ((dsBgtGbCd.get("actbgtPrgsYn")=="Y") || (dsUpperActbgtWorkList.getTotalRow() <= 0)){
            sbxActbgtChgType.setDisabled(true);
            btnSave.setDisabled(true);
            btnItemInsertRow.setDisabled(true);
            btnItemDivide.setDisabled(true);
            btnChangeCancel.setDisabled(true);
            btnAutoOrder.setDisabled(true);
            btnDelRow.setDisabled(true);
        } else {
            sbxActbgtChgType.setDisabled(false);
            btnSave.setDisabled(false);
            btnAutoOrder.setDisabled(false);
            btnDelRow.setDisabled(false);

            //예산변경유형에 따른 버튼 disable
            if (["CM0040013", "CM0040014", "CM0040017"].indexOf(sActbgtChgType) > -1){  //초과, 추가, 추가원가
                btnItemInsertRow.setDisabled(false);
                btnItemDivide.setDisabled(true);
                btnChangeCancel.setDisabled(false);
                btnAdjust.setDisabled(false);
            } else if (["CM0040011"].indexOf(sActbgtChgType) > -1){   //변경(비목)
                btnItemInsertRow.setDisabled(true);
                btnItemDivide.setDisabled(false);
                btnChangeCancel.setDisabled(false);
                btnAdjust.setDisabled(false);
            } else if (["CM0040016", "CM0040012"].indexOf(sActbgtChgType) > -1){   //변경(조정), 변경(비목), 직영집행
                btnItemInsertRow.setDisabled(true);
                btnItemDivide.setDisabled(false);
                btnChangeCancel.setDisabled(true);
                btnAdjust.setDisabled(false);
            } else {
                btnItemInsertRow.setDisabled(false);
                btnItemDivide.setDisabled(false);
                btnChangeCancel.setDisabled(true);
                btnAdjust.setDisabled(false);
            }
        }
    };

    /* 예산변경유형별 컬럼 disable
       param : actbgtChgType -> 예산변경유형코드
       param : rowIndex -> grid rowindex
       param : type -> 'S' : 조회시 컬럼변경 , 'I' : 그리드 행추가시 컬럼 변경
    */
    /*
        변경전 기준으로 CHECK
        변경전 이 0 인경우는 수량, 단가 모두 EDIT 가능

        1) 변경전이 1 or -1 인 경우
            단가 만 edit, 수량 X
        2) 1번이 아닌 경우
            수량 edit, 단가 X

        선택된 예산변경유형과 내역의 예산변경유형이 다른 경우는 모든 수정 불가.
        현설/요청 수량 금액이 있는 경우 모든 수정 불가.
        원가 있는 경우 삭제 불가.
        외주자재계약존재여부, 집행승인여부 변경 불가.
        직영집행인 경우 통제유형코드가 통제성('CM0041010'), 비통제성('CM00410102')은 분개불가

        scwin.fnGridColumnControl(actbgtChgType, rowIndex, type, dstbChgbfActbgtQty, dstbChgbfContQty)
        actbgtChgType : 구분 (실행예산변경유형코드)
        rowIndex : 그리드 rowIndex
        type : "S" --> 조회시 , "I" --> 입력시
        dstbChgbfActbgtQty : 분개한 내역의 어미의 변경 전 실행예산 수량 컬럼
        dstbChgbfContQty : 분개한 내역의 어미의 변경 전 도급 수량 컬럼

    */
    scwin.fnGridColumnControl = function(actbgtChgType, rowIndex, type, dstbChgbfActbgtQty, dstbChgbfContQty) {

        let arrColumnList = [];
        let sRowReadOnlyYn = "";
        let sBgtItemiUnit = dsActbgtWorkList.getCellData(rowIndex, "bgtItemiUnit");         //단위
        let sItemiYn = dsActbgtWorkList.getCellData(rowIndex, "itemiYn");                   //내역여부
        let sActbgtChgTypeCd = dsActbgtWorkList.getCellData(rowIndex, "actbgtChgTypeCd");   //실행예산변경유형코드
        let sCntrtPrgsYn = dsActbgtWorkList.getCellData(rowIndex, "cntrtPrgsYn");           //계약진행여부
        let nCntrtQty = dsActbgtWorkList.getCellData(rowIndex, "cntrtQty");                 //계약수량
        let nMngctBgtAmt = dsActbgtWorkList.getCellData(rowIndex, "mngctBgtAmt");           //현장관리비 예산금액
        let nPcostAmt = dsActbgtWorkList.getCellData(rowIndex, "pcostAmt");                 //집행원가금액
        let nChgbfActbgtQty = dsActbgtWorkList.getCellData(rowIndex, "chgbfActbgtQty");     //변경전 실행예산수량
        let nContQty = dsActbgtWorkList.getCellData(rowIndex, "contQty");                   //도급 수량                
        let sChgStusGbVal = dsActbgtWorkList.getCellData(rowIndex, "chgStusGbVal");         //변경_상태_구분_값
        let sItexpGb = dsActbgtWorkList.getCellData(rowIndex, "itexpGb");                   //비목구분
        let sBgtItexpChgYn = dsActbgtWorkList.getCellData(rowIndex, "bgtItexpChgYn");       //예산_비목_변경_여부
        let sBgtAmtVrtnYn = dsActbgtWorkList.getCellData(rowIndex, "bgtAmtVrtnYn");         //예산_금액_증감_여부
        let sExctAproYn = dsActbgtWorkList.getCellData(rowIndex, "exctAproYn");             //집행_승인_여부
        let sChgAprvPrgsYn = dsActbgtWorkList.getCellData(rowIndex, "chgAprvPrgsYn");       //변경_결재_진행_여부
        let sStndItemiCd = dsActbgtWorkList.getCellData(rowIndex, "stndItemiCd");           //표준_내역_코드
        let sOriginalYn = dsActbgtWorkList.getCellData(rowIndex, "originalYn");             //원본여부
                        
        if (type == "S"){ //조회시
            /* 모든 수정 불가의 경우 (정렬 제외)
                 1. 계약진행여부, 집행승인여부, 변경결재진행여부 존재시 수정불가.
                 2. 공종인 경우
                 3. 선택된 예산변경유형과 내역의 예산변경유형이 다른 경우
                 4. 삭제된 경우
                 5. 표준공종 중 공동도급조정분인 경우 --> Z-0001-0001
                 6. 원본여부가 분개인 경우
            */

            if ((sCntrtPrgsYn == "Y") || (sExctAproYn == "Y") || (sChgAprvPrgsYn == "Y") || (sStndItemiCd == "Z-0001-0001")){
                sRowReadOnlyYn = "Y";
            } else if ((sItemiYn != "Y")  || ((sbxActbgtChgType.getValue() != sActbgtChgTypeCd) && (sActbgtChgTypeCd != "") )
                || (sChgStusGbVal == "D")) {
                sRowReadOnlyYn = "Y";
            } else if (sOriginalYn == "분개") {
                sRowReadOnlyYn = "Y";
            }

            //row readonly 일 경우 --> readOnly 로 변경하면 셀이 edit 가능한 것처럼 보여 컬럼으로 막는다.
            if ((sRowReadOnlyYn == "Y")) {
                 arrColumnList = ["chk", "bgtItemiNm", "bgtItemiStdr", "bgtItemiUnit", "itexpGb", 
                                    "contQty", "contUct", "contMtrctUct", "contLbctUct", "contExpnsUct",  
                                    "actbgtQty", "actbgtUct", "actbgtMtrctUct", "actbgtLbctUct", "actbgtExpnsUct"];
                 grdActbgtWorkList.setCellDisabled(rowIndex, "popStndJobtypCd", true);  //표준공종팝업 선택불가
            } else {
            //그 외는 컬럼별 readonly 일 경우
                if (["CM0040013", "CM0040017"].indexOf(actbgtChgType) > -1 ){                   //초과, 추가원가
                    arrColumnList = ["bgtItemiNm", "bgtItemiStdr", "bgtItemiUnit", "itexpGb", 
                                        "contQty", "contUct", "contMtrctUct", "contLbctUct", "contExpnsUct"];
                } else if (actbgtChgType == "CM0040014"){   //추가
                    arrColumnList = ["bgtItemiNm", "bgtItemiStdr", "bgtItemiUnit", "itexpGb"];
                } else if(["CM0040016", "CM0040011", "CM0040012"].indexOf(actbgtChgType) > -1){ //변경(조정), 변경(비목), 직영집행
                    
                    if (sChgStusGbVal != "I") {             //내역분개로 추가된 내역만 수정가능
                        arrColumnList = ["bgtItemiNm", "bgtItemiStdr", "bgtItemiUnit", 
                                            "contQty", "contUct", "contMtrctUct", "contLbctUct", "contExpnsUct",
                                            "actbgtQty", "actbgtUct", "actbgtMtrctUct", "actbgtLbctUct", "actbgtExpnsUct"];
                    } else {                                //배분내역이 있으면 수정 가능.
                        if ((Math.abs(nContQty) == 1) && (sBgtItemiUnit == "식")) {      //수량이 1이면 단가만 수정
                            arrColumnList = ["bgtItemiNm", "contQty"];
                        } else {                            //나머지는 수량 수정
                            arrColumnList = ["bgtItemiNm", "contUct", "contMtrctUct", "contLbctUct", "contExpnsUct"];
                        }
                    }

                    if (actbgtChgType != "CM0040011"){ //변경(비목)이 아닌 경우 비목 변경 불가
                        arrColumnList.push("itexpGb");
                    }

                    if ((actbgtChgType == "CM0040012") && (sItexpGb != "L") && ( sItexpGb !="O")) {      //직영집행은 노무비, 경비가 아니면 수정 불가
                        arrColumnList.push("chk");
                    }
                }

                //단수조정분일 경우는 array clear 후 다시 셋팅
                if (sStndItemiCd == "H-0001-0001"){
                    arrColumnList.splice(0, arrColumnList.length);
                    arrColumnList = ["bgtItemiNm"];
                }

                //공통적 컬럼 수정 불가 사항                                
                if (([1, -1].indexOf(nChgbfActbgtQty) > -1) && (sBgtItemiUnit == "식")){         //변경전 수량이 1 or -1 이면 수량 수정 불가
                    arrColumnList.push("actbgtQty", "contQty");     //1식 이면서 변경전 수량 1이면 수량 입력 불가
                } else if(nChgbfActbgtQty == 0){
                                                                    //0인 경우는 수량, 단가 컬럼 오픈    
                } else {
                    arrColumnList.push("actbgtUct", "actbgtMtrctUct", "actbgtLbctUct", "actbgtExpnsUct", 
                                        "contUct", "contMtrctUct", "contLbctUct", "contExpnsUct");    //그 외는 단가 불가
                }

                //현장관리비, 집행원가금액이 있을 경우
                if ((Math.abs(nMngctBgtAmt) > 0) || (Math.abs(nPcostAmt) > 0)) {
                    arrColumnList.push("bgtItemiNm", "bgtItemiStdr", "bgtItemiUnit", "itexpGb");
                }

                //표준공종 예산_금액_증감_여부
                if (sBgtAmtVrtnYn == "N"){
                    arrColumnList.push("contQty", "contUct", "contMtrctUct", "contLbctUct", "contExpnsUct", 
                                        "actbgtQty", "actbgtUct", "actbgtMtrctUct", "actbgtLbctUct", "actbgtExpnsUct");
                }

                //표준공종 예산_비목_변경_여부가 'N' or  //계약수량이 있을 경우 비목변경불가
                if ((sBgtItexpChgYn == "N") || (nCntrtQty > "0")){
                    arrColumnList.push("itexpGb");
                }
            }

            // 변경(조정)으로 예산변경유형으로 조회한 경우 표준코드가 없는 행은 선택가능 2019-10-30
            if (sbxActbgtChgType.getValue() == "CM0040016"){
                if (sActbgtChgTypeCd == ""){
                    if (sStndItemiCd != ""){
                        grdActbgtWorkList.setCellDisabled(rowIndex, "popStndJobtypCd", true);  //표준공종팝업 선택불가
                    }
                } else if (sActbgtChgTypeCd != "CM0040016"){   //내역의 구분이 변경(조정)
                    grdActbgtWorkList.setCellDisabled(rowIndex, "popStndJobtypCd", true);  //표준공종팝업 선택불가
                }
            } else {
                //신규행인 경우 외에는 표준팝업 선택 불가
                if (sChgStusGbVal != "I"){
                    grdActbgtWorkList.setCellDisabled(rowIndex, "popStndJobtypCd", true);  //표준공종팝업 선택불가
                }
            }

        } else if (type == "I"){  //내역추가시

            //내역 추가된 경우 재조회시 예산변경유형이 조회조건의 예산변경 유형과 다를 경우 막는다.
            if ((sbxActbgtChgType.getValue() != sActbgtChgTypeCd) && (sActbgtChgTypeCd != "")) {
                 arrColumnList = ["chk", "bgtItemiNm", "bgtItemiStdr", "bgtItemiUnit", "itexpGb", 
                                    "contQty", "contUct", "contMtrctUct", "contLbctUct", "contExpnsUct",
                                    "actbgtQty", "actbgtUct", "actbgtMtrctUct", "actbgtLbctUct", "actbgtExpnsUct"];
                 grdActbgtWorkList.setCellDisabled(rowIndex, "popStndJobtypCd", true);
            } else {
                if (["CM0040013", "CM0040017"].indexOf(actbgtChgType) > -1){ //초과, 추가원가
                    arrColumnList = ["contQty", "contUct", "contMtrctUct", "contLbctUct", "contExpnsUct"];
                } else if (actbgtChgType == "CM0040014"){ //추가

                } else if(["CM0040016", "CM0040011", "CM0040012"].indexOf(actbgtChgType) > -1){ //변경(조정), 변경(비목), 직영집행

                    if ((dstbChgbfContQty == 1) && (sBgtItemiUnit == "식")) { // 분개한 어미 내역이 1식인 경우(도급)
                        arrColumnList = ["bgtItemiNm", "contQty"];
                    } else {
                        arrColumnList = ["bgtItemiNm", "contUct", "contMtrctUct", "contLbctUct", "contExpnsUct"];
                    }

                    if (actbgtChgType == "CM0040016"){ //변경(조정)일 경우 비목 변경 불가
                        arrColumnList.push("itexpGb");
                    }

                    if ((dstbChgbfActbgtQty == 1) && (sBgtItemiUnit == "식")) { // 분개한 어미 내역이 1식인 경우(실행예산)
                        arrColumnList.push("actbgtQty");
                    } else {
                        arrColumnList.push("actbgtUct", "actbgtMtrctUct", "actbgtLbctUct", "actbgtExpnsUct");
                    }
                }

                //단수조정분일 경우는 array clear 후 다시 셋팅
                if (sStndItemiCd == "H-0001-0001"){
                    arrColumnList.splice(0, arrColumnList.length);
                    arrColumnList = ["bgtItemiNm"];
                }
                
                //비목 변경 불가.
                arrColumnList.push("itexpGb");
            }
        } else {
            return false;
        }

        //결재상신한 경우 구분의 글자색을 파란색으로 변경.
        let sAprvFontColor = (dsActbgtWorkList.getCellData(rowIndex, "chgAprvPrgsYn") == "Y") ? "blue" : "red";
        grdActbgtWorkList.setCellColor(rowIndex, "actbgtChgTypeCd", sAprvFontColor);

        //array의 컬럼명으로 컬럼 readonly
        arrColumnList.forEach(function(item, index, array){
            grdActbgtWorkList.setCellReadOnly(rowIndex, item, true);
        });
    };

    //조회시 변경 내역 존재 여부 체크 .. confirm 창
    scwin.fnBeforeCheckSearch = function(id, value) {
        if (dsActbgtWorkList.getModifiedIndex().length > 0){
            if (!confirm("수정된 내역이 있습니다. 재조회 하시겠습니까?")) {
                id.setValue(value);
                return false;
            }
        }

        scwin.fnButtonControl();
        if (trvUpperActbgtWork.getSelectedValue().length > 0) {
            scwin.fnSearchActbgtItemiList(trvUpperActbgtWork.getSelectedValue());
        }
    };

    /*  그리드 금액 체크
        실행예산 컬럼들을 화면에서는 수정을 하지만
        손익실행예산 컬럼의 금액을 예산 체크를 한다.
        실행예산 컬럼의 증감된 금액만큼 손익실행예산의 금액의 더한 후
        그 금액으로 예산체크를 한다.
    */
    scwin.fnAmtCheck = function(info) {
        
        let sColumnName = grdActbgtWorkList.getColumnID(info.colIndex);
        let row = info.rowIndex;
        let value = info.newValue;
        let nPcostAmt = dsActbgtWorkList.getCellData(row, "pcostAmt"); //집행원가금액

        //도급단가와 실행예산단가가 0 이하로 입력 못하게 한다.
        if ((sColumnName == "contUct")||(sColumnName == "actbgtUct")) {
            if (value < 0){
                dsActbgtWorkList.setCellData(row, sColumnName, info.oldValue);
                return false;
            }
        }

        //실행예산 변경시 현장관리비 예산금액이 0 보다 크면서 이하로 수정 못하도록 체크.        
        let nMngctBgtAmt = dsActbgtWorkList.getCellData(row, "mngctBgtAmt");
        let sCtrlTypeCd = dsActbgtWorkList.getCellData(row, "ctrlTypeCd");
        /*
        if ((nMngctBgtAmt > 0) && (["CM00410101", "CM00410102"].indexOf(sCtrlTypeCd) > -1)){    //통제성, 비통제성
            if (sColumnName == "actbgtQty") {
                var nChgbfPlActbgtQty = dsActbgtWorkList.getCellData(row, "chgbfPlActbgtQty");
                var nChgbfActbgtQty = dsActbgtWorkList.getCellData(row, "chgbfActbgtQty");
                var nPlActbgtQty = dsActbgtWorkList.getCellData(row, "plActbgtQty");
                var nDiffQty = (value - nChgbfActbgtQty);   //변경 전이 0 일 경우 같은 숫자를 넣어주자
                if (!fnMngctAmtCheck(row, sColumnName, info.oldValue, parseInt(parseFloat((nChgbfPlActbgtQty + nDiffQty) * dsActbgtWorkList.getCellData(row, "plActbgtUct")).toFixed(2)) )){
                    return false;
                }
            } else if (sColumnName == "actbgtUct") {
                var nChgbfPlActbgtUct = dsActbgtWorkList.getCellData(row, "chgbfPlActbgtUct");
                var nChgbfActbgtUct = dsActbgtWorkList.getCellData(row, "chgbfActbgtUct");
                var nPlActbgtUct = dsActbgtWorkList.getCellData(row, "plActbgtUct");
                var nDiffUct = (value - nChgbfActbgtUct);   //변경 전이 0 일 경우 같은 숫자를 넣어주자
                if (!fnMngctAmtCheck(row, sColumnName, info.oldValue, parseInt(parseFloat((nChgbfPlActbgtUct + nDiffUct) * dsActbgtWorkList.getCellData(row, "plActbgtQty")).toFixed(2)) )){
                    return false;
                }
            } 
        }
        */
        
        //현장관리비 체크 function
        function fnMngctAmtCheck(row, sColumnName , oldValue, sumAmt){
            if (nMngctBgtAmt > sumAmt){
                com.showMessage("CMW0097", "", "", "", grdActbgtWorkList.id, row, sColumnName) //현장관리비 금액 이하로 수정할 수 없습니다.");
                dsActbgtWorkList.setCellData( row , sColumnName , oldValue); //이전 값으로 되돌린다.
                return false;
            }
            return true;
        }   

        //집행금액 체크 function
        function fnPcostAmtCheck(row, sColumnName , oldValue, sumAmt){
            
            if (nPcostAmt > sumAmt){
                com.showMessage("CMW0098", "", "", "", grdActbgtWorkList.id, row, sColumnName) //집행원가금액보다 적은 금액을 입력할 수 없습니다.
                dsActbgtWorkList.setCellData( row , sColumnName , oldValue); //이전 값으로 되돌린다.
                return false;
            }
            return true;
        }

        //집행금액이 0 인 경우는 체크하지 않는다.
        /* 
        if ((nPcostAmt=="") || (nPcostAmt==0)){
            return true;
        } else {
            //기집행금액 이하로 수정한 것 체크..
            if (sColumnName == "actbgtQty") {
                let nChgbfPlActbgtQty = dsActbgtWorkList.getCellData(row, "chgbfPlActbgtQty");
                let nChgbfActbgtQty = dsActbgtWorkList.getCellData(row, "chgbfActbgtQty");
                let nPlActbgtQty = dsActbgtWorkList.getCellData(row, "plActbgtQty");
                let nDiffQty = (value - nChgbfActbgtQty);   //변경 전이 0 일 경우 같은 숫자를 넣어주자
                if (!fnPcostAmtCheck(row, sColumnName, info.oldValue, parseInt(parseFloat((nChgbfPlActbgtQty + nDiffQty) * dsActbgtWorkList.getCellData(row, "plActbgtUct")).toFixed(2)) )){
                    return false;
                }
            } else if (sColumnName == "actbgtUct") {
                let nChgbfPlActbgtUct = dsActbgtWorkList.getCellData(row, "chgbfPlActbgtUct");
                let nChgbfActbgtUct = dsActbgtWorkList.getCellData(row, "chgbfActbgtUct");
                let nPlActbgtUct = dsActbgtWorkList.getCellData(row, "plActbgtUct");
                let nDiffUct = (value - nChgbfActbgtUct);   //변경 전이 0 일 경우 같은 숫자를 넣어주자
                if (!fnPcostAmtCheck(row, sColumnName, info.oldValue, parseInt(parseFloat((nChgbfPlActbgtUct + nDiffUct) * dsActbgtWorkList.getCellData(row, "plActbgtQty")).toFixed(2)) )){
                    return false;
                }
            }
        }
        */
            
        return true;
    };

    /** 표준내역코드 조회 팝업 후처리 **/
    scwin.popStndJobtypCdCallback = function(obj) {
        let nRow = grdActbgtWorkList.getFocusedRowIndex();
        dsActbgtWorkList.setRowJSON(nRow, {
                stndItemiCd: obj.stndItemiCd,
                stndItemiNm: obj.stndItemiNm
            },
            true
        );

        //기존 내역 표준코드 처리로 오픈 후 일시적으로 구분값 셋팅 안함. 2022-07-08
        //dsActbgtWorkList.setCellData(nRow, "actbgtChgTypeCd", sbxActbgtChgType.getValue());
        
        if (dsActbgtWorkList.getCellData(nRow, "chgStusGbVal") == "") {                 
            dsActbgtWorkList.setCellData(nRow, "chgStusGbVal", "U");
           }
    };

    //추가행 다음행부터 마지막행까지 자동순번(10 단위로 한다.)
    scwin.fnSetNextSortOrd = function(nFocusRow){
        let nThisOrd = dsActbgtWorkList.getCellData(nFocusRow, "sortOdr");  //선택한 정렬번호
        let nStdOrd = Math.ceil(nThisOrd/10)*10;
        nStdOrd = (nThisOrd == nStdOrd) ? nStdOrd + 10 : nStdOrd;           //계산한 번호와 같으면 10을 더한다.
        for (let i=nFocusRow+1; i<dsActbgtWorkList.getTotalRow(); i++){
            dsActbgtWorkList.setCellData(i, "sortOdr", nStdOrd + ((i-(nFocusRow+1))*10) );
        }
    }

    /*  저장 ajax */
    scwin.fnSave = function() {
        ajaxLib.ajax("/cm/cm1505/CM15050010U/saveTcmActbgtWork", {
            method: "POST",
            requestData: {
               "tcmActbgtWorkVOs" : dsActbgtWorkList.getModifiedJSON(true)
            },
            callback: function(result, e) {
                if (result.data == true){
                    com.showMessage("CFA0012"); //"저장되었습니다."
                    scwin.fnSearchActbgtItemiList(trvUpperActbgtWork.getSelectedValue());
                }
            },
            errCallback: function(result, e) {
            }
        });
    };

/**************************************************************************
 * [4] Event 정의
 **************************************************************************/

    //조회버튼 클릭
    scwin.btnFind_onclick = function() {

        dsSearchMap.set("siteCd", wfmKeySiteInfo.getWindow().ibxKeySiteCd.getValue());  //현장 코드
        btnTreeSpanAll.setValue("전체 펼치기");

        if (dsSearchMap.get("siteCd") ==""){
            com.showMessage("SAA0031","현장"); //"현장을 선택하세요!");
            return false;
        }

        dsUpperActbgtWorkList.removeAll();
        dsActbgtWorkList.removeAll();
        ajaxLib.ajax("/cm/cm1505/CM15050000U/selectUpperActbgtWorkList", {
            method: "POST",
            requestData: dsSearchMap.getJSON(),
            callback: function(result, e){
                dsBgtGbCd.setJSON(result.data.selectBgtGbCd);
                dsUpperActbgtWorkList.setJSON(result.data.selectUpperActbgtWorkList);
                scwin.fnButtonControl();
            },
            errCallback: ""
        });
    };

    //발주처 공종 라벨 클릭
    scwin.trvUpperActbgtWork_onlabelclick = function(value,nodeElement,index) {

        if (dsActbgtWorkList.getModifiedIndex().length > 0){
            if (!confirm("수정된 내역이 있습니다. 재조회 하시겠습니까?")) {
                return false;
            }
        }

        //하위공종이 있는 경우 버튼 disable.
        if (dsUpperActbgtWorkList.getCellData(index-1, "upperItemiExistsCnt") > 0){
            btnItemInsertRow.setDisabled(true);
            btnItemDivide.setDisabled(true);
            btnChangeCancel.setDisabled(true);
            btnAddPopup.setDisabled(true);
        } else {
            //하위 공종이 없는 경우 예산변경유형에 따른 버튼 컨트롤.
            scwin.fnButtonControl();
        }

        scwin.fnSearchActbgtItemiList(value);
    };

    //조회조건의 예산변경유형 변경시
    scwin.sbxActbgtChgType_onviewchange = function(info) {
        scwin.fnBeforeCheckSearch(sbxActbgtChgType, info.oldValue);
    };

    /*  행추가 경우 체크
        param : nFocusedRowIndex --> 그리드 포커스 rowindex
        return : {  nFocusRow : 포커스 rowindex
                    nSortOdr : 정렬순서
                    sUpperBgtItemiCd : 상위내역코드
                 }
     */
    scwin.fnAddRowBeforeCheck = function(nFocusedRowIndex){
        
        let objReturn = {};
        //그리드에 행이 있다면 행선택 필수 체크
        if (dsActbgtWorkList.getRowCount() > 0){
            if (nFocusedRowIndex < 0){
                com.showMessage("CMW0099"); //먼저 상세내역을 선택 후 추가 버튼을 클릭하세요.
                objReturn = {sCheck: false};
            } else {

                let nFocusRow = grdActbgtWorkList.getRealRowIndex(nFocusedRowIndex);
                let sItemiYn = dsActbgtWorkList.getCellData(nFocusRow, "itemiYn");
                let sBgtNewAddYn = dsActbgtWorkList.getCellData(nFocusRow, "bgtNewAddYn");         //예산_신규_추가_여부
                let bCheck = false;
                if (sItemiYn == "N"){
                    com.showMessage("CMW0103"); //하위 공종이 있을 경우 내역을 추가할 수 없습니다.
                    bCheck = false;
                } else if (sBgtNewAddYn == "N"){
                    com.showMessage("CMW0159"); //표준코드가 예산관리(신규추가)이 '아니오'로 되어있는 경우는 추가할 수 없습니다.
                    bCheck = false;
                } else {
                    bCheck = true;
                }

                objReturn = {
                    bCheck: bCheck,
                    nFocusRow: nFocusRow,
                    nSortOdr: dsActbgtWorkList.getCellData(nFocusedRowIndex, "sortOdr"),
                    sUpperBgtItemiCd: dsActbgtWorkList.getCellData(nFocusRow, "upperBgtItemiCd")
                };
            }

        } else {
            //그리드에 행이 없을 경우 초기값 셋팅.
            let sSelectedValue = trvUpperActbgtWork.getSelectedValue();
            let bCheck = true;
            if (sSelectedValue == ""){
                bCheck = false;
                com.showMessage("CMW0116"); //발주처공종의 내역을 선택해주세요.
            }
            objReturn = {
                bCheck: bCheck,
                nFocusRow: -1,
                nSortOdr: 0,
                sUpperBgtItemiCd: sSelectedValue
            };
        }

        return objReturn;
    };

    //내역추가 클릭
    scwin.btnItemInsertRow_onclick = function() {
        //그리드에 행이 있다면 행선택 필수 체크
        let objReturn = scwin.fnAddRowBeforeCheck(grdActbgtWorkList.getFocusedRowIndex());
        if(!objReturn.bCheck){
            return false;
        }
        let nFocusRow = objReturn.nFocusRow;
        let sActbgtChgType = sbxActbgtChgType.getValue();

        //행추가 및 컬럼 셋팅.
        let nThisOrd = dsActbgtWorkList.getCellData(nFocusRow, "sortOdr");  //선택한 정렬번호
        let nStdOrd = Math.ceil((nThisOrd+1)/10)*10;
        nStdOrd = (nThisOrd == nStdOrd) ? nStdOrd + 10 : nStdOrd;           //계산한 번호와 같으면 10을 더한다.
        let objAddJson = [];
        for (let i=0; i<sbxInsertRowNumber.getValue(); i++){
            let arrAddJson = {
                siteCd: dsSearchMap.get("siteCd"),
                upperBgtItemiCd: objReturn.sUpperBgtItemiCd,
                itemiYn: "Y",
                //행추가시 품명, 규격, 단위는 빈칸으로 복사 되도록 요청.
//                bgtItemiNm: dsActbgtWorkList.getCellData(nFocusRow, "bgtItemiNm"),
//                bgtItemiStdr: dsActbgtWorkList.getCellData(nFocusRow, "bgtItemiStdr"),
//                bgtItemiUnit: dsActbgtWorkList.getCellData(nFocusRow, "bgtItemiUnit"),                
                actbgtChgTypeCd: sActbgtChgType,
                chgStusGbVal: "I",                                          //변경_상태_구분_값
                sortOdr: nStdOrd + (i*10)
            };
            objAddJson.push(arrAddJson);
        }

        dsActbgtWorkList.insertJSON(nFocusRow + 1, objAddJson);            //insert row
        grdActbgtWorkList.setFocusedCell(nFocusRow, "chk");

        //예산변경유형별 컬럼 disable
        for (let i=0; i<sbxInsertRowNumber.getValue(); i++){
            scwin.fnGridColumnControl(sActbgtChgType, nFocusRow+i+1, "I");
        }

        //추가행부터 마지막까지 자동순번
        scwin.fnSetNextSortOrd(nFocusRow + Number(sbxInsertRowNumber.getValue()));
    };

    /* 분개한 내역에서부터 상위공종 금액 계산
       sColumnName: 변경된 컬럼
       nMatchIndex: 그리드 rowIndex
       diffAmt: 변경된 컬럼의 변경 전후 차이 금액
    */
    function fnUpperAmtSum(sColumnName, nMatchIndex, diffAmt){        
        dsActbgtWorkList.setCellData(nMatchIndex, sColumnName, (dsActbgtWorkList.getCellData(nMatchIndex, sColumnName) - diffAmt));
        if (sColumnName.indexOf("cont", 0) == 0){    //도급 컬럼 중 하나일 경우.
            let nUpperContQty = Number(dsActbgtWorkList.getCellData(nMatchIndex, "contQty"));            
            let nUpperContMtrctUct = Number(dsActbgtWorkList.getCellData(nMatchIndex, "contMtrctUct"));
            let nUpperContLbctUct = Number(dsActbgtWorkList.getCellData(nMatchIndex, "contLbctUct"));
            let nUpperContExpnsUct = Number(dsActbgtWorkList.getCellData(nMatchIndex, "contExpnsUct"));
            let nUpperContUct = nUpperContMtrctUct + nUpperContLbctUct + nUpperContExpnsUct;
            
            dsActbgtWorkList.setRowJSON(nMatchIndex, {
                    "contUct": nUpperContUct,
                    "contAmt": parseInt(parseFloat(nUpperContQty * nUpperContUct).toFixed(2)),
                    "contMtrctAmt": parseInt(parseFloat(nUpperContQty * nUpperContMtrctUct).toFixed(2)),
                    "contLbctAmt": parseInt(parseFloat(nUpperContQty * nUpperContLbctUct).toFixed(2)),
                    "contExpnsAmt": parseInt(parseFloat(nUpperContQty * nUpperContExpnsUct).toFixed(2)),
                    "incContAmt": parseInt(parseFloat(nUpperContQty * nUpperContUct).toFixed(2)) - dsActbgtWorkList.getCellData(nMatchIndex, "chgbfContAmt"),
                },
                true
            );

        } else if (sColumnName.indexOf("actbgt", 0) == 0){ //실행예산 컬럼 중 하나일 경우 
            
            let nUpperActbgtQty = Number(dsActbgtWorkList.getCellData(nMatchIndex, "actbgtQty"));            
            let nUpperActbgtMtrctUct = Number(dsActbgtWorkList.getCellData(nMatchIndex, "actbgtMtrctUct"));
            let nUpperActbgtLbctUct = Number(dsActbgtWorkList.getCellData(nMatchIndex, "actbgtLbctUct"));
            let nUpperActbgtExpnsUct = Number(dsActbgtWorkList.getCellData(nMatchIndex, "actbgtExpnsUct"));
            let nUpperActbgtUct = nUpperActbgtMtrctUct + nUpperActbgtLbctUct + nUpperActbgtExpnsUct;
            
            dsActbgtWorkList.setRowJSON(nMatchIndex, {
                    "actbgtUct": nUpperActbgtUct,
                    "actbgtAmt": parseInt(parseFloat(nUpperActbgtQty * nUpperActbgtUct).toFixed(2)),
                    "actbgtMtrctAmt": parseInt(parseFloat(nUpperActbgtQty * nUpperActbgtMtrctUct).toFixed(2)),
                    "actbgtLbctAmt": parseInt(parseFloat(nUpperActbgtQty * nUpperActbgtLbctUct).toFixed(2)),
                    "actbgtExpnsAmt": parseInt(parseFloat(nUpperActbgtQty * nUpperActbgtExpnsUct).toFixed(2)), 
                },
                true
            );

            //손익실행의 수량, 단가 반영
            let nPlActbgtQty = Number(dsActbgtWorkList.getCellData(nMatchIndex, "plActbgtQty"));
            if (sColumnName == "actbgtQty") {                
                dsActbgtWorkList.setCellData(nMatchIndex, "plActbgtQty", nPlActbgtQty - diffAmt);                
            } else {
                let nPlActbgtUct = Number(dsActbgtWorkList.getCellData(nMatchIndex, "plActbgtUct"));
                let nPlActbgtMtrctUct = Number(dsActbgtWorkList.getCellData(nMatchIndex, "plActbgtMtrctUct"));
                let nPlActbgtLbctUct = Number(dsActbgtWorkList.getCellData(nMatchIndex, "plActbgtLbctUct"));
                let nPlActbgtExpnsUct = Number(dsActbgtWorkList.getCellData(nMatchIndex, "plActbgtExpnsUct"));
                            
                if (sColumnName == "actbgtMtrctUct"){                    
                    let nAfterUct = nPlActbgtMtrctUct - diffAmt;
                    dsActbgtWorkList.setCellData(nMatchIndex, "plActbgtMtrctUct", nAfterUct);                    
                    dsActbgtWorkList.setCellData(nMatchIndex, "plActbgtMtrctAmt", parseInt(parseFloat(nPlActbgtQty * nAfterUct).toFixed(2)));
                } else if (sColumnName == "actbgtLbctUct"){
                    let nAfterUct = nPlActbgtLbctUct - diffAmt;
                    dsActbgtWorkList.setCellData(nMatchIndex, "plActbgtLbctUct", nAfterUct);
                    dsActbgtWorkList.setCellData(nMatchIndex, "plActbgtLbctAmt", parseInt(parseFloat(nPlActbgtQty * nAfterUct).toFixed(2)));
                } else if (sColumnName == "actbgtExpnsUct"){
                    let nAfterUct = nPlActbgtExpnsUct - diffAmt;
                    dsActbgtWorkList.setCellData(nMatchIndex, "plActbgtExpnsUct", nAfterUct);
                    dsActbgtWorkList.setCellData(nMatchIndex, "plActbgtExpnsAmt", parseInt(parseFloat(nPlActbgtQty * nAfterUct).toFixed(2)));
                }
                
                dsActbgtWorkList.setCellData(nMatchIndex, "plActbgtUct", nPlActbgtUct - diffAmt);
            }

            //변경 후 손익실행금액 반영
            let nUpperPlActbgtQty = dsActbgtWorkList.getCellData(nMatchIndex, "plActbgtQty");
            let nUpperPlActbgtUct = dsActbgtWorkList.getCellData(nMatchIndex, "plActbgtUct");

            dsActbgtWorkList.setRowJSON(nMatchIndex, {
                    "plActbgtAmt": parseInt(parseFloat(nUpperPlActbgtQty * nUpperPlActbgtUct).toFixed(2)),
                    "incActbgtQty": dsActbgtWorkList.getCellData(nMatchIndex, "actbgtQty") - dsActbgtWorkList.getCellData(nMatchIndex, "chgbfActbgtQty"),
                    "incActbgtUct": dsActbgtWorkList.getCellData(nMatchIndex, "actbgtUct") - dsActbgtWorkList.getCellData(nMatchIndex, "chgbfActbgtUct"),
                    "incActbgtAmt": dsActbgtWorkList.getCellData(nMatchIndex, "actbgtAmt") - dsActbgtWorkList.getCellData(nMatchIndex, "chgbfActbgtAmt"),
                    "incPlActbgtQty": dsActbgtWorkList.getCellData(nMatchIndex, "actbgtQty") - dsActbgtWorkList.getCellData(nMatchIndex, "chgbfPlActbgtQty"),
                    "incPlActbgtUct": dsActbgtWorkList.getCellData(nMatchIndex, "plActbgtUct") - dsActbgtWorkList.getCellData(nMatchIndex, "chgbfPlActbgtUct"),
                    "incPlActbgtAmt": parseInt(parseFloat(nUpperPlActbgtQty * nUpperPlActbgtUct).toFixed(2)) - dsActbgtWorkList.getCellData(nMatchIndex, "chgbfPlActbgtAmt")
                },
                true
            );
        }
    }

    //저장시 validation 체크
    scwin.fnValidationCheck = function(){
        var bResult = true;
        var arrList = dsActbgtWorkList.getModifiedIndex();
        var sTargetColId = null, sTargetColNm = null;
        
        for (var i = 0; i < arrList.length; i++) {
            var obj = dsActbgtWorkList.getRowJSON(arrList[i]);
            //1. 변경된 데이터 validation [status : C,U 만해당]
            if (obj.rowStatus == "C" || obj.rowStatus == "U") {
                if (obj.itemiYn == "Y") {//내역여부
                    if (obj.bgtItemiNm == "") {
                        sTargetColId = "bgtItemiNm";
                        sTargetColNm = "품명";
                    } else if (obj.sortOdr == "") {
                        sTargetColId = "sortOdr";
                        sTargetColNm = "정렬순서";
                    }
                } else {//공종
                    if (obj.bgtItemiNm == "") {
                        sTargetColId = "bgtItemiNm";
                        sTargetColNm = "품명";
                    } else if (obj.sortOdr == "") {
                        sTargetColId = "sortOdr";
                        sTargetColNm = "정렬순서";
                    }
                }

                if (sTargetColId != null) {
                    com.showMessage("SAA0043", sTargetColNm, "", "", grdActbgtWorkList.id, arrList[i], sTargetColId);//$1은(는) 필수입력사항입니다.
                    bResult = false;
                    break;
                }

            }
        }

        
        if (["CM0040012", "CM0040016"].indexOf(sbxActbgtChgType.getValue()) > -1){ //직영집행, 변경(조정)의 경우            
            var arrMatchedIndex = dsActbgtWorkList.getMatchedIndex("actbgtChgTypeCd", sbxActbgtChgType.getValue());
            var nIncContAmt = 0, nIncActbgtAmt = 0;            
            for (i=0; i<arrMatchedIndex.length; i++){
                nIncContAmt += Number(dsActbgtWorkList.getCellData(arrMatchedIndex[i], "incContAmt"));
                nIncActbgtAmt += Number(dsActbgtWorkList.getCellData(arrMatchedIndex[i], "incActbgtAmt"));
            }  
            
            if ((nIncContAmt != 0) || (nIncActbgtAmt != 0)) {                  
                com.showMessage("CMW0163");
                bResult = false;
            }
            
        }

        return bResult;
    }

    //그리드 onviewchange 금액 수정시 체크
    /*
       1. 도급단가와 실행예산단가가 0 이하로 입력 못하게 한다.
       2. 실행예산 변경시 현장관리비 예산금액 이하로 수정 못하도록 체크
       3. 실행예산 변경시 집행원가이하로 수정 못하도록 체크
    */
    scwin.grdActbgtWorkList_onviewchange = function(info) {
        
        var sColumnName = grdActbgtWorkList.getColumnID(info.colIndex);
        var row = info.rowIndex;
        var value = info.newValue;
        
        if (["contQty", "contUct", "contMtrctUct", "contLbctUct", "contExpnsUct", 
             "actbgtQty", "actbgtUct", "actbgtMtrctUct","actbgtLbctUct", "actbgtExpnsUct"].indexOf(sColumnName) >= 0){
            // 숫자의 경우 "," 제거
            if (typeof(info.newValue) == "string"){
                value = info.newValue.replaceAll(",","");
                info.newValue = value;
                dsActbgtWorkList.setCellData(row, sColumnName, value);
            }

            //그리드 금액 체크
            if (!scwin.fnAmtCheck(info)){
                return false;
            }
        } else if (sColumnName == "itexpGb"){
            //직영집행의 분개내역은 노무비, 경비만 가능.
            if ((sbxActbgtChgType.getValue() == "CM0040012") && (["L","O"].indexOf(value) < 0)){
                com.showMessage("CMW0110"); //직영집행의 경우 노무비, 경비만 내역분개가 가능합니다.
                dsActbgtWorkList.setCellData(row, sColumnName, info.oldValue);
                return false;
            }
        }

        //컬럼 변경시 구분 셋팅        
        var arrColumnList = ["bgtItemiNm", "bgtItemiStdr", "bgtItemiUnit", "itexpGb", "contQty", "contUct", "contMtrctUct", "contLbctUct", "contExpnsUct",
                                "actbgtQty", "actbgtUct", "actbgtMtrctUct", "actbgtLbctUct", "actbgtExpnsUct", "stndItemiNm"];
        if (arrColumnList.indexOf(sColumnName) >= 0){
            dsActbgtWorkList.setCellData(row, "actbgtChgTypeCd", sbxActbgtChgType.getValue());
            if (dsActbgtWorkList.getCellData(row, "chgStusGbVal") == ""){
                dsActbgtWorkList.setCellData(row, "chgStusGbVal", "U");
            }
        }
        
        var nOldValue = info.oldValue == "" ? 0 : info.oldValue;
        var diffAmt = (parseInt((info.newValue * 1000) - parseFloat(nOldValue * 1000)))/1000;
        //분개대상과 분개한 내역의 각 컬럼별 숫자의 합을 같도록 변경처리.
        if (dsActbgtWorkList.getCellData(row, "workDstbBgtItemiCd").length > 0){
            if (["contQty", "contUct", "contMtrctUct", "contLbctUct", "contExpnsUct", 
                    "actbgtQty", "actbgtUct","actbgtMtrctUct", "actbgtLbctUct", "actbgtExpnsUct", ].indexOf(sColumnName) >= 0){
                //부모 내역 코드 찾기
                var nMatchIndex = dsActbgtWorkList.getMatchedIndex("bgtItemiCd", dsActbgtWorkList.getCellData(row, "workDstbBgtItemiCd"));
                if (nMatchIndex.length > 0){
                
                    /*    분개시 부모내역의 금액체크를 하지 않도록 수정. 2019-11-27         
                    var nChangeValue = Math.abs(dsActbgtWorkList.getCellData(nMatchIndex[0], sColumnName)) - Math.abs(diffAmt);
                    if (nChangeValue < 0){
                        com.showMessage("CMW0106", "", "", "", grdActbgtWorkList.id, row, sColumnName);// "분개내역의 기존 컬럼의 숫자보다 큰 수를 입력할 수 없습니다.");
                        dsActbgtWorkList.setCellData(row, sColumnName, nOldValue);
                        return false;
                    }
                    */
                    let nUpperAddAmt = dsActbgtWorkList.getCellData(nMatchIndex, sColumnName) - diffAmt;
                    if ((sColumnName == "contQty")||(sColumnName == "contUct")){            //도급
                        var nUpperQty = sColumnName == "contQty" ? nUpperAddAmt : dsActbgtWorkList.getCellData(nMatchIndex[0], "contQty");
                        var nUpperUct = sColumnName == "contUct" ? nUpperAddAmt : dsActbgtWorkList.getCellData(nMatchIndex[0], "contUct");
                    } else if ((sColumnName == "actbgtQty")||(sColumnName == "actbgtUct")){ //실행예산
                        var nUpperQty = sColumnName == "actbgtQty" ? nUpperAddAmt : dsActbgtWorkList.getCellData(nMatchIndex[0], "actbgtQty");
                        var nUpperUct = sColumnName == "actbgtUct" ? nUpperAddAmt : dsActbgtWorkList.getCellData(nMatchIndex[0], "actbgtUct");
                    } else {
                        //return false;
                    }

                    let nPcostAmt = dsActbgtWorkList.getCellData(nMatchIndex[0], "pcostAmt"); //부모내역의 집행금액
                    //집행금액이 0 인 경우는 체크하지 않는다.
                    if ((nPcostAmt != "") && (nPcostAmt != 0)){
                        if ((nUpperQty * nUpperUct) < nPcostAmt) {
                            com.showMessage("CMW0098", "", "", "", grdActbgtWorkList.id, row, sColumnName); //집행원가금액보다 적은 금액을 입력할 수 없습니다.
                            dsActbgtWorkList.setCellData(row, sColumnName, nOldValue);
                            return false;
                        }
                    }

                    //상위내역의 합계금액
                    fnUpperAmtSum(sColumnName, nMatchIndex[0], diffAmt);
                }
            }
        }
        
        //수량, 단가 변경시 금액 컬럼 합산.       
        let nTmpAmt = 0;  
        if (sColumnName.indexOf("cont", 0) == 0) {  //도급으로 시작하는 컬럼명일 경우
        
            let nContMtrctUct = Number(dsActbgtWorkList.getCellData(row, "contMtrctUct"));         //도급재료비계산
            let nContLbctUct = Number(dsActbgtWorkList.getCellData(row, "contLbctUct"));           //도급노무비계산
            let nContExpnsUct = Number(dsActbgtWorkList.getCellData(row, "contExpnsUct"));         //도급경비단가     
            let nContQty = dsActbgtWorkList.getCellData(row, "contQty");    
        
            if (sColumnName == "contQty") {
                nTmpAmt = ((value * 1000) * nContMtrctUct) / 1000;  //도급재료비계산
                dsActbgtWorkList.setCellData(row, "contMtrctAmt", parseInt(nTmpAmt.toFixed(2)) );
                
                nTmpAmt = ((value * 1000) * nContLbctUct) / 1000;   //도급노무비계산
                dsActbgtWorkList.setCellData(row, "contLbctAmt", parseInt(nTmpAmt.toFixed(2)) );
                
                nTmpAmt = ((value * 1000) * nContExpnsUct) / 1000;  //도급경비계산     
                dsActbgtWorkList.setCellData(row, "contExpnsAmt", parseInt(nTmpAmt.toFixed(2)) );                   
                        
                //dsActbgtWorkList.setCellData(row, "contAmt", parseInt(parseFloat(value * dsActbgtWorkList.getCellData(row, "contUct")).toFixed(2)) );
            } else if (sColumnName == "contMtrctUct") {             //도급재료비단가
                nTmpAmt = (value * (nContQty * 1000)) / 1000;
                dsActbgtWorkList.setCellData( row , "contMtrctAmt", parseInt(nTmpAmt.toFixed(2)) );
            } else if (sColumnName == "contLbctUct") {              //도급노무비단가
                nTmpAmt = (value * (nContQty * 1000)) / 1000;
                dsActbgtWorkList.setCellData( row , "contLbctAmt", parseInt(nTmpAmt.toFixed(2)) );
            } else if (sColumnName == "contExpnsUct") {             //도급경비단가
                nTmpAmt = (value * (nContQty * 1000)) / 1000;
                dsActbgtWorkList.setCellData( row , "contExpnsAmt", parseInt(nTmpAmt.toFixed(2)) );
            }   
            
            //도급 합단가, 합금액 계산               
            dsActbgtWorkList.setCellData(row, "contUct", nContMtrctUct + nContLbctUct + nContExpnsUct);    //도급단가계산
            
            let nContMtrctAmt = Number(dsActbgtWorkList.getCellData(row, "contMtrctAmt"));       //도급재료비금액
            let nContLbctAmt = Number(dsActbgtWorkList.getCellData(row, "contLbctAmt"));         //도급노무비금액
            let nContExpnsAmt = Number(dsActbgtWorkList.getCellData(row, "contExpnsAmt"));       //도급경비금액             
            dsActbgtWorkList.setCellData(row, "contAmt", nContMtrctAmt + nContLbctAmt + nContExpnsAmt);               
            
            //도급 증감분
            dsActbgtWorkList.setCellData(row, "incContQty", dsActbgtWorkList.getCellData(row, "contQty") - dsActbgtWorkList.getCellData(row, "chgbfContQty"));
            dsActbgtWorkList.setCellData(row, "incContUct", dsActbgtWorkList.getCellData(row, "contUct") - dsActbgtWorkList.getCellData(row, "chgbfContUct"));
            dsActbgtWorkList.setCellData(row, "incContAmt", dsActbgtWorkList.getCellData(row, "contAmt") - dsActbgtWorkList.getCellData(row, "chgbfContAmt"));
            
        } else if (sColumnName.indexOf("act", 0) == 0) {  //실행예산수량, 실행예산단가 변경시            
            let nActbgtMtrctUct = Number(dsActbgtWorkList.getCellData(row, "actbgtMtrctUct"));                  //실행재료비단가
            let nActbgtLbctUct = Number(dsActbgtWorkList.getCellData(row, "actbgtLbctUct"));                    //실행노무비단가
            let nActbgtExpnsUct = Number(dsActbgtWorkList.getCellData(row, "actbgtExpnsUct"));                  //실행경비단가    
            let nActbgtQty = Number(dsActbgtWorkList.getCellData(row, "actbgtQty"));                            //실행수량     
            let nPlActbgtQty = Number(dsActbgtWorkList.getCellData(row, "plActbgtQty"));            
            let nActbgtUct = Number(dsActbgtWorkList.getCellData(row, "actbgtUct"));
            let nPlActbgtUct = Number(dsActbgtWorkList.getCellData(row, "plActbgtUct"));
            let nChgbfActbgtQty = Number(dsActbgtWorkList.getCellData(row, "chgbfActbgtQty"));
            let nChgbfActbgtUct = Number(dsActbgtWorkList.getCellData(row, "chgbfActbgtUct"));
            let nChgbfActbgtMtrctUct = Number(dsActbgtWorkList.getCellData(row, "chgbfActbgtMtrctUct"));        //변경전_실행재료비단가
            let nChgbfActbgtLbctUct = Number(dsActbgtWorkList.getCellData(row, "chgbfActbgtLbctUct"));          //변경전_실행노무비단가
            let nChgbfActbgtExpnsUct = Number(dsActbgtWorkList.getCellData(row, "chgbfActbgtExpnsUct"));        //변경전_실행경비단가            
            let nChgbfPlActbgtQty = Number(dsActbgtWorkList.getCellData(row, "chgbfPlActbgtQty"));              //변경전_손익실행수량
            let nChgbfPlActbgtUct = Number(dsActbgtWorkList.getCellData(row, "chgbfPlActbgtUct"));              //변경전_손익실행단가
            
            let nPlActbgtMtrctUct = Number(dsActbgtWorkList.getCellData(row, "plActbgtMtrctUct"));              //손익실행재료비단가
            let nPlActbgtLbctUct = Number(dsActbgtWorkList.getCellData(row, "plActbgtLbctUct"));                //손익실행노무비단가
            let nPlActbgtExpnsUct = Number(dsActbgtWorkList.getCellData(row, "plActbgtExpnsUct"));              //손익실행경비단가
            let nChgbfPlActbgtMtrctUct = Number(dsActbgtWorkList.getCellData(row, "chgbfPlActbgtMtrctUct"));    //변경전_손익실행재료비단가
            let nChgbfPlActbgtLbctUct = Number(dsActbgtWorkList.getCellData(row, "chgbfPlActbgtLbctUct"));      //변경전_손익실행노무비단가
            let nChgbfPlActbgtExpnsUct = Number(dsActbgtWorkList.getCellData(row, "chgbfPlActbgtExpnsUct"));    //변경전_손익실행경비단가
            
            let nPlActbgtMtrctAmt = Number(dsActbgtWorkList.getCellData(row, "plActbgtMtrctAmt"));              //손익실행재료비금액
            let nPlActbgtLbctAmt = Number(dsActbgtWorkList.getCellData(row, "plActbgtLbctAmt"));                //손익실행노무비금액
            let nPlActbgtExpnsAmt = Number(dsActbgtWorkList.getCellData(row, "plActbgtExpnsAmt"));              //손익실행경비금액
            let nChgbfPlActbgtMtrctAmt = Number(dsActbgtWorkList.getCellData(row, "chgbfPlActbgtMtrctAmt"));    //변경전_손익실행재료비금액
            let nChgbfPlActbgtLbctAmt = Number(dsActbgtWorkList.getCellData(row, "chgbfPlActbgtLbctAmt"));      //변경전_손익실행노무비금액
            let nChgbfPlActbgtExpnsAmt = Number(dsActbgtWorkList.getCellData(row, "chgbfPlActbgtExpnsAmt"));    //변경전_손익실행경비금액                                                                     
                                    
            if (sColumnName == "actbgtQty") {                              
                
                nTmpAmt = ((value * 1000) * nActbgtMtrctUct) / 1000;    //실행재료비계산
                dsActbgtWorkList.setCellData(row, "actbgtMtrctAmt", parseInt(nTmpAmt.toFixed(2)));
                nPlActbgtQty = nChgbfActbgtQty + nActbgtQty - nChgbfActbgtQty;
                //let nDiffActbgtQty = value - nOldValue; //dsActbgtWorkList.getCellData(row, "actbgtQty");       
                
                nPlActbgtMtrctAmt = parseInt((((nPlActbgtMtrctUct * 1000) * nPlActbgtQty) / 1000).toFixed(2)); 
                dsActbgtWorkList.setCellData(row, "plActbgtMtrctAmt", nPlActbgtMtrctAmt);        
                
                nTmpAmt = ((value * 1000) * nActbgtLbctUct) / 1000;     //실행노무비계산
                dsActbgtWorkList.setCellData(row, "actbgtLbctAmt", parseInt(nTmpAmt.toFixed(2)));
                
                nPlActbgtLbctAmt = parseInt((((nPlActbgtLbctUct * 1000) * nPlActbgtQty) / 1000).toFixed(2));                 
                dsActbgtWorkList.setCellData(row, "plActbgtLbctAmt", nPlActbgtLbctAmt);                
                
                nTmpAmt = ((value * 1000) * nActbgtExpnsUct) / 1000;    //실행경비계산
                dsActbgtWorkList.setCellData(row, "actbgtExpnsAmt", parseInt(nTmpAmt.toFixed(2)));
                
                nPlActbgtExpnsAmt = parseInt((((nPlActbgtExpnsUct * 1000) * nPlActbgtQty) / 1000).toFixed(2)); 
                dsActbgtWorkList.setCellData(row, "plActbgtExpnsAmt", nPlActbgtExpnsAmt);                
                
                                                                                                          //변경 전이 0 일 경우 같은 숫자를 넣어주자
                dsActbgtWorkList.setCellData(row, "plActbgtQty", nPlActbgtQty);                         //손익실행예산 수량                                      
            } else if (sColumnName == "actbgtMtrctUct") {               //실행재료비단가
                nTmpAmt = (value * (nActbgtQty * 1000)) / 1000;
                dsActbgtWorkList.setCellData(row, "actbgtMtrctAmt", parseInt(nTmpAmt.toFixed(2)));                                
                
                nPlActbgtMtrctUct = (nChgbfPlActbgtMtrctUct + nActbgtMtrctUct - nChgbfActbgtMtrctUct);
                dsActbgtWorkList.setCellData(row, "plActbgtMtrctUct", nPlActbgtMtrctUct);
                
                nPlActbgtMtrctAmt = parseInt((((nPlActbgtMtrctUct * 1000) * nActbgtQty) / 1000).toFixed(2));                 
                dsActbgtWorkList.setCellData(row, "plActbgtMtrctAmt", nPlActbgtMtrctAmt);                
            } else if (sColumnName == "actbgtLbctUct") {                //실행노무비단가
                nTmpAmt = (value * (nActbgtQty * 1000)) / 1000;
                dsActbgtWorkList.setCellData(row, "actbgtLbctAmt", parseInt(nTmpAmt.toFixed(2)));
                
                nPlActbgtLbctUct = (nChgbfPlActbgtLbctUct + nActbgtLbctUct - nChgbfActbgtLbctUct);      //손익실행재료비단가 계산 
                dsActbgtWorkList.setCellData(row, "plActbgtLbctUct", nPlActbgtLbctUct);          
                
                nPlActbgtLbctAmt = parseInt((((nPlActbgtLbctUct * 1000) * nActbgtQty) / 1000).toFixed(2)); 
                dsActbgtWorkList.setCellData(row, "plActbgtLbctAmt", nPlActbgtLbctAmt);                      
            } else if (sColumnName == "actbgtExpnsUct") {               //실행경비단가
                nTmpAmt = (value * (nActbgtQty * 1000)) / 1000;
                dsActbgtWorkList.setCellData(row, "actbgtExpnsAmt", parseInt(nTmpAmt.toFixed(2)));
                
                nPlActbgtExpnsUct = (nChgbfPlActbgtExpnsUct + nActbgtExpnsUct - nChgbfActbgtExpnsUct);
                dsActbgtWorkList.setCellData(row, "plActbgtExpnsUct", nPlActbgtExpnsUct);
                
                plActbgtExpnsAmt = parseInt((((nPlActbgtExpnsUct * 1000) * nActbgtQty) / 1000).toFixed(2)); 
                dsActbgtWorkList.setCellData(row, "plActbgtExpnsAmt", plActbgtExpnsAmt);                                   
            }   
            
            //실행 합단가, 합금액 계산               
            dsActbgtWorkList.setCellData(row, "actbgtUct", nActbgtMtrctUct + nActbgtLbctUct + nActbgtExpnsUct);             //실행단가계산
            
            nActbgtMtrctAmt = Number(dsActbgtWorkList.getCellData(row, "actbgtMtrctAmt"));       //실행재료비금액
            nActbgtLbctAmt = Number(dsActbgtWorkList.getCellData(row, "actbgtLbctAmt"));         //실행노무비금액
            nActbgtExpnsAmt = Number(dsActbgtWorkList.getCellData(row, "actbgtExpnsAmt"));       //실행경비금액                 
            dsActbgtWorkList.setCellData(row, "actbgtAmt", nActbgtMtrctAmt + nActbgtLbctAmt + nActbgtExpnsAmt);             
            
            dsActbgtWorkList.setCellData(row, "plActbgtUct", nPlActbgtMtrctUct + nPlActbgtLbctUct + nPlActbgtExpnsUct);     //실행단가계산

            nPlActbgtMtrctAmt = Number(dsActbgtWorkList.getCellData(row, "plActbgtMtrctAmt"));        //손익실행재료비금액
            nPlActbgtLbctAmt = Number(dsActbgtWorkList.getCellData(row, "plActbgtLbctAmt"));          //손익실행노무비금액
            nPlActbgtExpnsAmt = Number(dsActbgtWorkList.getCellData(row, "plActbgtExpnsAmt"));        //손익실행경비금액                          
            dsActbgtWorkList.setCellData(row, "plActbgtAmt", nPlActbgtMtrctAmt + nPlActbgtLbctAmt + nPlActbgtExpnsAmt);


            //실행예산 수량이나 단가가 변경될 경우
            //차이가 나는 수량이나 단가만큼 손익컬럼에 반영함.
            /*
            if (sColumnName == "actbgtQty"){
                let nDiffQty = (nChgbfPlActbgtQty + nActbgtQty - nChgbfActbgtQty);   //변경 전이 0 일 경우 같은 숫자를 넣어주자
                dsActbgtWorkList.setCellData(row, "plActbgtQty", nDiffQty);
                dsActbgtWorkList.setCellData(row, "plActbgtAmt", parseInt(parseFloat(nPlActbgtUct * nDiffQty).toFixed(2)) );
            } else {
                let nDiffUct = (nChgbfPlActbgtUct + nActbgtUct - nChgbfActbgtUct);
                dsActbgtWorkList.setCellData(row, "plActbgtUct", nDiffUct);
                dsActbgtWorkList.setCellData(row, "plActbgtAmt", parseInt(parseFloat(nPlActbgtQty * nDiffUct).toFixed(2)) );
            }
            */
            
            //증감분 실행예산, 손익실행예산
            dsActbgtWorkList.setCellData(row, "incActbgtQty", dsActbgtWorkList.getCellData(row, "actbgtQty") - dsActbgtWorkList.getCellData(row, "chgbfActbgtQty"));
            dsActbgtWorkList.setCellData(row, "incActbgtUct", dsActbgtWorkList.getCellData(row, "actbgtUct") - dsActbgtWorkList.getCellData(row, "chgbfActbgtUct"));
            dsActbgtWorkList.setCellData(row, "incActbgtAmt", dsActbgtWorkList.getCellData(row, "actbgtAmt") - dsActbgtWorkList.getCellData(row, "chgbfActbgtAmt"));
            dsActbgtWorkList.setCellData(row, "incPlActbgtQty", dsActbgtWorkList.getCellData(row, "actbgtQty") - dsActbgtWorkList.getCellData(row, "chgbfPlActbgtQty"));
            dsActbgtWorkList.setCellData(row, "incPlActbgtUct", dsActbgtWorkList.getCellData(row, "plActbgtUct") - dsActbgtWorkList.getCellData(row, "chgbfPlActbgtUct"));
            dsActbgtWorkList.setCellData(row, "incPlActbgtAmt", dsActbgtWorkList.getCellData(row, "plActbgtAmt") - dsActbgtWorkList.getCellData(row, "chgbfPlActbgtAmt"));
        } else {
            return false;
        }

        let nContAmt = dsActbgtWorkList.getCellData(row, "contAmt");
        let nActbgtAmt = dsActbgtWorkList.getCellData(row, "actbgtAmt");
        let nActbgtRt = 0;

        //실행원가율
        if ((nActbgtAmt == "0") || (nActbgtAmt == "")) {
            nActbgtRt = 0.00;
        } else if ((nContAmt == "0") || (nContAmt == "")) {
            nActbgtRt = 100.00;
        } else {
            nActbgtRt = parseInt((nActbgtAmt / nContAmt) * 100);
        }
        dsActbgtWorkList.setCellData(row, "actbgtRt", nActbgtRt);
    };

    //내역분개 클릭
    /*
        1. 변경(조정), 직영집행만 가능. -- 변경(비목) 추가 2019-10-18
        2. 어미 내역은 모든 내역 수정 불가, 분개로 생긴 내역만 수량, 규격, 단위 수정 가능.
        3. 직영집행인 경우 직영집행승인여부가 "Y"인 경우는 분개 불가
           변경(조정), 변경(비목) 인 경우는 가능
        4. 직영집행인 경우 노무비, 경비만 분개 가능
        5. 분개로 생긴 내역의 수량 변경시 어미 수량 기존 실행수량 기준으로 나눠서 넣는다.
           ex) 기존 수량 21. 분개내역에 11개로 넣은면 어미 수량은 10개로 셋팅
               단, 집행된 수량이 넘지 않도록 체크, 기존 수량보다 큰 수는 못 넣도록 체크
        6. 손익 컬럼 분개내역에 복사(품명, 규격, 단위, 비목, 단가, 예산내역코드를 배분예산내역코드로..)
        7. 분개는 표준내역코드도 복사한다.
    */
    scwin.btnItemDivide_onclick = function() {
        if (grdActbgtWorkList.getFocusedRowIndex() < 0){
            com.showMessage("CMW0109"); //"먼저 내역을 선택 후 내역분개 버튼을 클릭하세요."
            return false;
        }

        let sItemiYn = dsActbgtWorkList.getCellData(grdActbgtWorkList.getRealRowIndex(grdActbgtWorkList.getFocusedRowIndex()), "itemiYn");
        if (sItemiYn == "N"){
            com.showMessage("CMW0159"); //공종은 내역분개를 할 수 없습니다.
            return false;
        }

        let nFocusRow = grdActbgtWorkList.getRealRowIndex(grdActbgtWorkList.getFocusedRowIndex());
        let sActbgtChgTypeCd = dsActbgtWorkList.getCellData(nFocusRow, "actbgtChgTypeCd");
        let sDstbBgtItemiCd = dsActbgtWorkList.getCellData(nFocusRow, "dstbBgtItemiCd");
        let sBgtItemiJnlzYn = dsActbgtWorkList.getCellData(nFocusRow, "bgtItemiJnlzYn");    //예산_내역_분개_여부
        let sChgAprvPrgsYn = dsActbgtWorkList.getCellData(nFocusRow, "chgAprvPrgsYn");      //변경_결재_진행_여부
        let sItexpGb = dsActbgtWorkList.getCellData(nFocusRow, "itexpGb");                  //비목구분
        let sExctAproYn = dsActbgtWorkList.getCellData(nFocusRow, "exctAproYn");            //직영집행승인여부
        let sCtrlTypeCd = dsActbgtWorkList.getCellData(nFocusRow, "ctrlTypeCd");            //통제유형코드
        let sStndItemiCd = dsActbgtWorkList.getCellData(nFocusRow, "stndItemiCd");          //표준내역코드
        let sCntrtPrgsYn = dsActbgtWorkList.getCellData(nFocusRow, "cntrtPrgsYn");          //계약진행여부

        if (sCntrtPrgsYn == "Y"){
            com.showMessage("CMW0156"); //계약진행여부가 Y 인 내역은 분개할 수 없습니다.
            return false;
        }

        if (sbxActbgtChgType.getValue() == "CM0040012") {   //직영집행의 경우
            if(["L","O"].indexOf(sItexpGb) < 0) {
                com.showMessage("CMW0110"); //직영집행의 경우 노무비, 경비만 내역분개가 가능합니다.
                return false;
            }

            if (sExctAproYn == "Y") {
                com.showMessage("CMW0140"); //직영집행의 경우 직영집행승인여부가 'Y' 인 내역은 분개할 수 없습니다.
                return false;
            }

            //직영집행인 경우 통제유형코드가 통제성('CM00410101'), 비통제성('CM00410102')은 수정불가
            if (["CM00410101", "CM00410102"].indexOf(sCtrlTypeCd) > -1){
                com.showMessage("CMW0150"); //직영집행의 경우 통제유형코드가 통제성, 비통제성인 경우 분개할 수 없습니다.
                return false;
            }
        }

        if (sChgAprvPrgsYn == "Y"){
            com.showMessage("CMW0126"); //실행예산 변경 결재 진행 중인 건이 있습니다.  결재완료 후 진행할 수 있습니다.
            return false;
        }

        if ((sActbgtChgTypeCd != "") && (sbxActbgtChgType.getValue() != sActbgtChgTypeCd)){
            com.showMessage("CMW0130"); //내역분개할 유형과 입력했던 구분 값이 다릅니다. 분개할 수 없습니다.
            return false;
        }

        if ((sBgtItemiJnlzYn == "N") && (sStndItemiCd != "")){
            com.showMessage("CMW0129"); //내역분개 불가 항목입니다. [표준내역-내역분개여부] 확인
            return false;
        }

        if (sDstbBgtItemiCd != ""){  //배분내역코드가 있으면 재분개 안됨
            com.showMessage("CMW0111"); //"분개한 내역을 다시 분개할 수 없습니다."
            return false;
        }
        
        let sActbgtChgType = sbxActbgtChgType.getValue();
        dsActbgtWorkList.setCellData(nFocusRow, "actbgtChgTypeCd", sActbgtChgType);
        dsActbgtWorkList.setCellData(nFocusRow, "chgStusGbVal", "U");
        dsActbgtWorkList.setCellData(nFocusRow, "workDstbBgtItemiCd", dsActbgtWorkList.getCellData(nFocusRow, "bgtItemiCd")+"*");

        /* 변경전 단가가 1일 경우 1식으로 판단.
           내역 분개시 1식인 경우 단가를 내려받고
                       1식이 아닌 경우 수량을 내려받는다.
        */
        let sBgtItemiUnit = dsActbgtWorkList.getCellData(nFocusRow, "bgtItemiUnit");        
        let nChgbfActbgtQty = Math.abs(dsActbgtWorkList.getCellData(nFocusRow, "chgbfActbgtQty"));
        let nChgbfContQty = Math.abs(dsActbgtWorkList.getCellData(nFocusRow, "chgbfContQty"));
        let nContQty = 0;
        let nContUct = 0;
        let nContMtrctUct = 0; 
        let nContLbctUct = 0;
        let nContExpnsUct = 0;   
        let nActbgtQty = 0;   
        let nActbgtUct = 0;   
        let nActbgtMtrctUct = 0;
        let nActbgtLbctUct = 0; 
        let nActbgtExpnsUct = 0;       
        let nPlActbgtQty = 0;   
        let nPlActbgtUct = 0;    
        let nPlActbgtMtrctUct = 0;
        let nPlActbgtLbctUct = 0; 
        let nPlActbgtExpnsUct = 0;                          
          
        if ((nChgbfContQty == 1) && (sBgtItemiUnit == "식")){
            nContQty = dsActbgtWorkList.getCellData(nFocusRow, "contQty");           
        } else {
            nContUct = dsActbgtWorkList.getCellData(nFocusRow, "contUct");
            nContMtrctUct = dsActbgtWorkList.getCellData(nFocusRow, "contMtrctUct"); 
            nContLbctUct = dsActbgtWorkList.getCellData(nFocusRow, "contLbctUct");
            nContExpnsUct = dsActbgtWorkList.getCellData(nFocusRow, "contExpnsUct");                        
        }
        
        if ((nChgbfActbgtQty == 1) && (sBgtItemiUnit == "식")){
            nActbgtQty = dsActbgtWorkList.getCellData(nFocusRow, "actbgtQty");       
            nPlActbgtQty = dsActbgtWorkList.getCellData(nFocusRow, "plActbgtQty");
        } else {
            nActbgtUct = dsActbgtWorkList.getCellData(nFocusRow, "actbgtUct");
            nActbgtMtrctUct = dsActbgtWorkList.getCellData(nFocusRow, "actbgtMtrctUct");
            nActbgtLbctUct = dsActbgtWorkList.getCellData(nFocusRow, "actbgtLbctUct");
            nActbgtExpnsUct = dsActbgtWorkList.getCellData(nFocusRow, "actbgtExpnsUct");
            nPlActbgtUct = dsActbgtWorkList.getCellData(nFocusRow, "plActbgtUct");
            nPlActbgtMtrctUct = dsActbgtWorkList.getCellData(nFocusRow, "plActbgtMtrctUct");
            nPlActbgtLbctUct = dsActbgtWorkList.getCellData(nFocusRow, "plActbgtLbctUct");
            nPlActbgtExpnsUct = dsActbgtWorkList.getCellData(nFocusRow, "plActbgtExpnsUct");            
        }
        
        //행추가 및 컬럼 셋팅.
        let nThisOrd = dsActbgtWorkList.getCellData(nFocusRow, "sortOdr");  //선택한 정렬번호
        let nStdOrd = Math.ceil((nThisOrd+1)/10)*10;
        nStdOrd = (nThisOrd == nStdOrd) ? nStdOrd + 10 : nStdOrd;           //계산한 번호와 같으면 10을 더한다.
        let objAddJson = [];
        for (let i=0; i < sbxInsertRowNumber.getValue(); i++ ){
            let arrAddJson = {
                siteCd: dsSearchMap.get("siteCd"),
                upperBgtItemiCd: dsActbgtWorkList.getCellData(nFocusRow, "upperBgtItemiCd"),
                itemiYn: "Y",
                gubun: sbxActbgtChgType.getText(),
                bgtItemiNm: dsActbgtWorkList.getCellData(nFocusRow, "bgtItemiNm"),
                bgtItemiStdr: dsActbgtWorkList.getCellData(nFocusRow, "bgtItemiStdr"),
                bgtItemiUnit: dsActbgtWorkList.getCellData(nFocusRow, "bgtItemiUnit"),
                itexpGb: dsActbgtWorkList.getCellData(nFocusRow, "itexpGb"),
                actbgtChgTypeCd: sActbgtChgType,
                contQty: nContQty,                                                          //도급수량
                contUct: nContUct,                                                          //도급단가
                contMtrctUct: nContMtrctUct,                                                //도급_재료비_단가
                contLbctUct: nContLbctUct,                                                  //도급_노무비_단가
                contExpnsUct: nContExpnsUct,                                                //도급_경비_단가
                actbgtQty: nActbgtQty,                                                      //실행예산수량
                actbgtUct: nActbgtUct,                                                      //실행예산단가
                actbgtMtrctUct: nActbgtMtrctUct,                                            //실행_재료비_단가
                actbgtLbctUct: nActbgtLbctUct,                                              //실행_노무비_단가
                actbgtExpnsUct: nActbgtExpnsUct,                                            //실행_경비_단가
                plActbgtQty: nPlActbgtQty,                                                  //손익실행예산수량
                plActbgtUct: nPlActbgtUct,                                                  //손익실행예산단가
                plActbgtMtrctUct: nPlActbgtMtrctUct,                                        //손익실행_재료비_단가
                plActbgtLbctUct: nPlActbgtLbctUct,                                          //손익실행_노무비_단가
                plActbgtExpnsUct: nPlActbgtExpnsUct,                                        //손익실행_경비_단가
                dstbBgtItemiCd: dsActbgtWorkList.getCellData(nFocusRow, "bgtItemiCd"),      //배분_예산내역코드
                workDstbBgtItemiCd: dsActbgtWorkList.getCellData(nFocusRow, "bgtItemiCd"),  //배분_예산내역코드
                stndItemiCd: dsActbgtWorkList.getCellData(nFocusRow, "stndItemiCd"),        //표준내역코드
                stndItemiNm: dsActbgtWorkList.getCellData(nFocusRow, "stndItemiNm"),        //표준내역명
                sortOdr: nStdOrd + (i*10),                                                  //정렬순서
                chgStusGbVal: "I",                                                          //변경_상태_구분_값
                contConfmYn: dsActbgtWorkList.getCellData(nFocusRow, "contConfmYn"),        //도급_확정_여부
                contConfmAprvPrgsYn: dsActbgtWorkList.getCellData(nFocusRow, "contConfmAprvPrgsYn")     //도급_확정_결재_진행_여부
            };
            objAddJson.push(arrAddJson);
        }
        dsActbgtWorkList.insertJSON(nFocusRow + 1, objAddJson);            //insert row
        grdActbgtWorkList.setFocusedCell(nFocusRow, "chk");

        //예산변경유형별 컬럼 disable
        for (let i=0; i < sbxInsertRowNumber.getValue(); i++ ){
            scwin.fnGridColumnControl(sActbgtChgType, nFocusRow+i+1, "I", nChgbfActbgtQty, nChgbfContQty);
        }

        //추가행부터 마지막까지 자동순번
        scwin.fnSetNextSortOrd(nFocusRow + Number(sbxInsertRowNumber.getValue()));
    };

    //행삭제전 체크로직 
    scwin.fnDelRowCheck = function(nRow) {
        
        //신규가 아닐 경우만 체크한다.
        var sMassage = "";
        if (dsActbgtWorkList.getCellData(nRow, "chgStusGbVal") != "I") {
            if (Math.abs(dsActbgtWorkList.getCellData(nRow, "chgbfContAmt")) != 0){
                sMassage = "변경전 도급예산"
            }

            if (Math.abs(dsActbgtWorkList.getCellData(nRow, "chgbfActbgtAmt")) != 0){
                sMassage = sMassage + ",변경전 실행예산"
            }

            if (Math.abs(dsActbgtWorkList.getCellData(nRow, "chgbfPlActbgtAmt")) != 0){
                sMassage = sMassage + ",변경전 손익실행예산"
            }

            if (Math.abs(dsActbgtWorkList.getCellData(nRow, "contAmt")) != 0){
                sMassage = "도급예산"
            }

            if (Math.abs(dsActbgtWorkList.getCellData(nRow, "actbgtAmt")) != 0){
                sMassage = sMassage + ", 실행예산"
            }

            if (Math.abs(dsActbgtWorkList.getCellData(nRow, "plActbgtAmt")) != 0){
                sMassage = sMassage + ", 손익실행예산"
            }

            if (Math.abs(dsActbgtWorkList.getCellData(nRow, "pcostAmt")) > 0){
                sMassage = sMassage + ", 집행원가"
            }

            if (Math.abs(dsActbgtWorkList.getCellData(nRow, "mngctBgtAmt")) > 0){
                sMassage = sMassage + ", 현장관리비"
            }
            
            if (dsActbgtWorkList.getCellData(nRow, "bgtDividePath") != ""){
                sMassage = sMassage + ", 공종분개"
            }            

            if (sMassage.length > 0) {
                com.showMessage("CMW0112", sMassage); //" 존재하기 때문에 삭제할 수 없습니다.");
                return false;
            }

            if (dsActbgtWorkList.getCellData(nRow, "workDstbBgtItemiCd").indexOf("*") > -1){
                com.showMessage("SAA0076", "분개한 내역 중 부모내역"); //$1은(는) 삭제할 수 없습니다.
                return false;
            }
        }    
        
        return true;
    };

    //행삭제
    scwin.btnDelRow_onclick = function() {
        var chkArr = grdActbgtWorkList.getCheckedIndex("chk");        
        
        for (var i=chkArr.length-1; i>-1; i--){

            //그리드 금액 체크
            if (!scwin.fnDelRowCheck(chkArr[i])){
                return false;
            }                
            
            var sDstbBgtItemiCd = dsActbgtWorkList.getCellData(chkArr[i], "workDstbBgtItemiCd");    //삭제할 내역의 배분코드
            var nIndex = dsActbgtWorkList.getMatchedIndex("bgtItemiCd", sDstbBgtItemiCd);           //배분코드로 어미내역 찾기
            // 어미내역에 삭제할 내역의 금액 차이 금액 감소
            if (nIndex.length > 0){
                
                let nContQty = dsActbgtWorkList.getCellData(nIndex[0], "contQty");
                let sBgtItemiUnit = dsActbgtWorkList.getCellData(nIndex[0], "bgtItemiUnit");
            
                //도급 1식일 경우 도급 수량은 증감 없음.
                if ((Math.abs(nContQty) == 1) && (sBgtItemiUnit == "식")) {                
                    dsActbgtWorkList.setRowJSON(nIndex[0], {
                            rowStatus: "U",          //도급예산수량
                            contUct: dsActbgtWorkList.getCellData(nIndex[0], "contUct") + dsActbgtWorkList.getCellData(chkArr[i], "contUct"),                   //도급예산단가
                            contAmt: dsActbgtWorkList.getCellData(nIndex[0], "contAmt") + dsActbgtWorkList.getCellData(chkArr[i], "contAmt"),                   //도급예산금액
                            contMtrctUct: dsActbgtWorkList.getCellData(nIndex[0], "contMtrctUct") + dsActbgtWorkList.getCellData(chkArr[i], "contMtrctUct"),    //도급예산_재료비_단가
                            contMtrctAmt: dsActbgtWorkList.getCellData(nIndex[0], "contMtrctAmt") + dsActbgtWorkList.getCellData(chkArr[i], "contMtrctAmt"),    //도급예산_재료비_금액
                            contLbctUct: dsActbgtWorkList.getCellData(nIndex[0], "contLbctUct") + dsActbgtWorkList.getCellData(chkArr[i], "contLbctUct"),       //도급예산_노무비_단가
                            contLbctAmt: dsActbgtWorkList.getCellData(nIndex[0], "contLbctAmt") + dsActbgtWorkList.getCellData(chkArr[i], "contLbctAmt"),       //도급예산_노무비_금액
                            contExpnsUct: dsActbgtWorkList.getCellData(nIndex[0], "contExpnsUct") + dsActbgtWorkList.getCellData(chkArr[i], "contExpnsUct"),    //도급예산_경비_단가
                            contExpnsAmt: dsActbgtWorkList.getCellData(nIndex[0], "contExpnsAmt") + dsActbgtWorkList.getCellData(chkArr[i], "contExpnsAmt"),    //도급예산_경비_금액
                            incContAmt: dsActbgtWorkList.getCellData(nIndex[0], "contAmt") + dsActbgtWorkList.getCellData(chkArr[i], "contAmt") - dsActbgtWorkList.getCellData(nIndex[0], "chgbfContAmt"),                                                                                    
                        },
                        true
                    );
                } else {
                    dsActbgtWorkList.setRowJSON(nIndex[0], {
                            rowStatus: "U",
                            contQty: dsActbgtWorkList.getCellData(nIndex[0], "contQty") + dsActbgtWorkList.getCellData(chkArr[i], "contQty"),                   //도급예산수량
                            contAmt: dsActbgtWorkList.getCellData(nIndex[0], "contAmt") + dsActbgtWorkList.getCellData(chkArr[i], "contAmt"),                   //도급예산금액
                            contMtrctAmt: dsActbgtWorkList.getCellData(nIndex[0], "contMtrctAmt") + dsActbgtWorkList.getCellData(chkArr[i], "contMtrctAmt"),    //도급예산_재료비_금액
                            contLbctAmt: dsActbgtWorkList.getCellData(nIndex[0], "contLbctAmt") + dsActbgtWorkList.getCellData(chkArr[i], "contLbctAmt"),       //도급예산_노무비_금액
                            contExpnsAmt: dsActbgtWorkList.getCellData(nIndex[0], "contExpnsAmt") + dsActbgtWorkList.getCellData(chkArr[i], "contExpnsAmt"),    //도급예산_경비_금액
                            incContAmt: dsActbgtWorkList.getCellData(nIndex[0], "contAmt") + dsActbgtWorkList.getCellData(chkArr[i], "contAmt") - dsActbgtWorkList.getCellData(nIndex[0], "chgbfContAmt"),
                        },
                        true
                    );                
                }    
                
                let nActbgtQty = dsActbgtWorkList.getCellData(nIndex[0], "actbgtQty");           
                
                //실행예산 1식일 경우 실행예산, 손익수량은 증감 없음.
                if ((Math.abs(nActbgtQty) == 1) && (sBgtItemiUnit == "식")){                
                    dsActbgtWorkList.setRowJSON(nIndex[0], {
                            rowStatus: "U",          //도급예산수량
                            actbgtUct: dsActbgtWorkList.getCellData(nIndex[0], "actbgtUct") + dsActbgtWorkList.getCellData(chkArr[i], "actbgtUct"),                         //실행예산_단가
                            actbgtAmt: dsActbgtWorkList.getCellData(nIndex[0], "actbgtAmt") + dsActbgtWorkList.getCellData(chkArr[i], "actbgtAmt"),                         //실행예산_금액
                            actbgtMtrctUct: dsActbgtWorkList.getCellData(nIndex[0], "actbgtMtrctUct") + dsActbgtWorkList.getCellData(chkArr[i], "actbgtMtrctUct"),          //실행예산_재료비_단가
                            actbgtMtrctAmt: dsActbgtWorkList.getCellData(nIndex[0], "actbgtMtrctAmt") + dsActbgtWorkList.getCellData(chkArr[i], "actbgtMtrctAmt"),          //실행예산_재료비_금액
                            actbgtLbctUct: dsActbgtWorkList.getCellData(nIndex[0], "actbgtLbctUct") + dsActbgtWorkList.getCellData(chkArr[i], "actbgtLbctUct"),             //실행예산_노무비_단가
                            actbgtLbctAmt: dsActbgtWorkList.getCellData(nIndex[0], "actbgtLbctAmt") + dsActbgtWorkList.getCellData(chkArr[i], "actbgtLbctAmt"),             //실행예산_노무비_금액
                            actbgtExpnsUct: dsActbgtWorkList.getCellData(nIndex[0], "actbgtExpnsUct") + dsActbgtWorkList.getCellData(chkArr[i], "actbgtExpnsUct"),          //실행예산_경비_단가
                            actbgtExpnsAmt: dsActbgtWorkList.getCellData(nIndex[0], "actbgtExpnsAmt") + dsActbgtWorkList.getCellData(chkArr[i], "actbgtExpnsAmt"),          //실행예산_경비_금액                                                                                    
                            plActbgtUct: dsActbgtWorkList.getCellData(nIndex[0], "plActbgtUct") + dsActbgtWorkList.getCellData(chkArr[i], "plActbgtUct"),                   //손익_실행예산_단가
                            plActbgtAmt: dsActbgtWorkList.getCellData(nIndex[0], "plActbgtAmt") + dsActbgtWorkList.getCellData(chkArr[i], "plActbgtAmt"),                   //손익_실행예산_금액
                            plActbgtMtrctUct: dsActbgtWorkList.getCellData(nIndex[0], "plActbgtMtrctUct") + dsActbgtWorkList.getCellData(chkArr[i], "plActbgtMtrctUct"),    //손익_실행예산_재료비_단가
                            plActbgtMtrctAmt: dsActbgtWorkList.getCellData(nIndex[0], "plActbgtMtrctAmt") + dsActbgtWorkList.getCellData(chkArr[i], "plActbgtMtrctAmt"),    //손익_실행예산_재료비_금액
                            plActbgtLbctUct: dsActbgtWorkList.getCellData(nIndex[0], "plActbgtLbctUct") + dsActbgtWorkList.getCellData(chkArr[i], "plActbgtLbctUct"),       //손익_실행예산_노무비_단가
                            plActbgtLbctAmt: dsActbgtWorkList.getCellData(nIndex[0], "plActbgtLbctAmt") + dsActbgtWorkList.getCellData(chkArr[i], "plActbgtLbctAmt"),       //손익_실행예산_노무비_금액
                            plActbgtExpnsUct: dsActbgtWorkList.getCellData(nIndex[0], "plActbgtExpnsUct") + dsActbgtWorkList.getCellData(chkArr[i], "plActbgtExpnsUct"),    //손익_실행예산_경비_단가
                            plActbgtExpnsAmt: dsActbgtWorkList.getCellData(nIndex[0], "plActbgtExpnsAmt") + dsActbgtWorkList.getCellData(chkArr[i], "plActbgtExpnsAmt"),    //손익_실행예산_경비_금액                            
                            incActbgtUct: dsActbgtWorkList.getCellData(nIndex[0], "actbgtUct") + dsActbgtWorkList.getCellData(chkArr[i], "actbgtUct") - dsActbgtWorkList.getCellData(nIndex[0], "chgbfActbgtUct"),
                            incActbgtAmt: dsActbgtWorkList.getCellData(nIndex[0], "actbgtAmt") + dsActbgtWorkList.getCellData(chkArr[i], "actbgtAmt") - dsActbgtWorkList.getCellData(nIndex[0], "chgbfActbgtAmt"),
                            incPlActbgtUct: dsActbgtWorkList.getCellData(nIndex[0], "plActbgtUct") + dsActbgtWorkList.getCellData(chkArr[i], "plActbgtUct") - dsActbgtWorkList.getCellData(nIndex[0], "chgbfPlActbgtUct"),
                            incPlActbgtAmt: dsActbgtWorkList.getCellData(nIndex[0], "plActbgtAmt") + dsActbgtWorkList.getCellData(chkArr[i], "plActbgtAmt") - dsActbgtWorkList.getCellData(nIndex[0], "chgbfPlActbgtAmt"),
                        },
                        true
                    );
                } else {
                    dsActbgtWorkList.setRowJSON(nIndex[0], {
                            rowStatus: "U",
                            actbgtQty: dsActbgtWorkList.getCellData(nIndex[0], "actbgtQty") + dsActbgtWorkList.getCellData(chkArr[i], "actbgtQty"),                         //실행예산_수량
                            actbgtAmt: dsActbgtWorkList.getCellData(nIndex[0], "actbgtAmt") + dsActbgtWorkList.getCellData(chkArr[i], "actbgtAmt"),                         //실행예산_금액
                            actbgtMtrctAmt: dsActbgtWorkList.getCellData(nIndex[0], "actbgtMtrctAmt") + dsActbgtWorkList.getCellData(chkArr[i], "actbgtMtrctAmt"),          //실행예산_재료비_금액
                            actbgtLbctAmt: dsActbgtWorkList.getCellData(nIndex[0], "actbgtLbctAmt") + dsActbgtWorkList.getCellData(chkArr[i], "actbgtLbctAmt"),             //실행예산_노무비_금액
                            actbgtExpnsAmt: dsActbgtWorkList.getCellData(nIndex[0], "actbgtExpnsAmt") + dsActbgtWorkList.getCellData(chkArr[i], "actbgtExpnsAmt"),          //실행예산_경비_금액                            
                            plActbgtQty: dsActbgtWorkList.getCellData(nIndex[0], "plActbgtQty") + dsActbgtWorkList.getCellData(chkArr[i], "plActbgtQty"),                   //손익_실행예산_수량
                            plActbgtAmt: dsActbgtWorkList.getCellData(nIndex[0], "plActbgtAmt") + dsActbgtWorkList.getCellData(chkArr[i], "plActbgtAmt"),                   //손익_실행예산_금액                            
                            plActbgtMtrctAmt: dsActbgtWorkList.getCellData(nIndex[0], "plActbgtMtrctAmt") + dsActbgtWorkList.getCellData(chkArr[i], "plActbgtMtrctAmt"),    //손익_실행예산_재료비_금액
                            plActbgtLbctAmt: dsActbgtWorkList.getCellData(nIndex[0], "plActbgtLbctAmt") + dsActbgtWorkList.getCellData(chkArr[i], "plActbgtLbctAmt"),       //손익_실행예산_노무비_금액
                            plActbgtExpnsAmt: dsActbgtWorkList.getCellData(nIndex[0], "plActbgtExpnsAmt") + dsActbgtWorkList.getCellData(chkArr[i], "plActbgtExpnsAmt"),    //손익_실행예산_경비_금액
                            incActbgtAmt: dsActbgtWorkList.getCellData(nIndex[0], "actbgtAmt") + dsActbgtWorkList.getCellData(chkArr[i], "actbgtAmt") - dsActbgtWorkList.getCellData(nIndex[0], "chgbfActbgtAmt"),
                            incPlActbgtAmt: dsActbgtWorkList.getCellData(nIndex[0], "plActbgtAmt") + dsActbgtWorkList.getCellData(chkArr[i], "plActbgtAmt") - dsActbgtWorkList.getCellData(nIndex[0], "chgbfPlActbgtAmt"),                                                        
                        },
                        true
                    );                
                }                 
            }

            //내역 삭제 -- 한건씩 삭제하자.
            dsActbgtWorkList.setRowJSON(chkArr[i], {
                    contQty: "0",               //도급예산수량
                    contUct: "0",               //도급예산단가
                    contAmt: "0",               //도급예산금액
                    contMtrctUct: "0",          //도급_재료비_단가
                    contMtrctAmt: "0",          //도급_재료비_금액
                    contLbctUct: "0",           //도급_노무비_단가
                    contLbctAmt: "0",           //도급_노무비_금액
                    contExpnsUct: "0",          //도급_경비_단가
                    contExpnsAmt: "0",          //도급_경비_금액          
                    actbgtQty: "0",             //실행예산_수량
                    actbgtUct: "0",             //실행예산_단가
                    actbgtAmt: "0",             //실행예산금액
                    actbgtMtrctUct: "0",        //실행예산_재료비_단가
                    actbgtMtrctAmt: "0",        //실행예산_재료비_금액
                    actbgtLbctUct: "0",         //실행예산_노무비_단가
                    actbgtLbctAmt: "0",         //실행예산_노무비_금액
                    actbgtExpnsUct: "0",        //실행예산_경비_단가
                    actbgtExpnsAmt: "0",        //실행예산_경비_금액
                    plActbgtQty: "0",           //손익_실행예산_수량
                    plActbgtUct: "0",           //손익_실행예산_단가
                    plActbgtAmt: "0",           //손익_실행예산_금액
                    plActbgtMtrctUct: "0",      //손익_실행예산_재료비_단가
                    plActbgtMtrctAmt: "0",      //손익_실행예산_재료비_금액
                    plActbgtLbctUct: "0",       //손익_실행예산_노무비_단가
                    plActbgtLbctAmt: "0",       //손익_실행예산_노무비_금액
                    plActbgtExpnsUct: "0",      //손익_실행예산_경비_단가
                    plActbgtExpnsAmt: "0",      //손익_실행예산_경비_금액
                    chgStusGbVal: "D",
                    dstbBgtItemiCd: "",         //배분_예산내역코드
                    workDstbBgtItemiCd: ""      //작업_배분_예산내역코드
                },
                true
            );
            dsActbgtWorkList.removeRow(chkArr[i]);

            //분개한 내역일 경우
            if (sDstbBgtItemiCd != ""){

                //분개한 자식 내역 코드 찾기
                var nMatchIndex = [];
                for (var j=0; j<dsActbgtWorkList.getTotalRow(); j++){
                    var sRowItemiCd = dsActbgtWorkList.getCellData(j, "workDstbBgtItemiCd");
                    var sRowTypeCd = dsActbgtWorkList.getCellData(j, "actbgtChgTypeCd");
                    if ((sRowItemiCd == sDstbBgtItemiCd) && (sRowTypeCd != "")){
                        nMatchIndex.push(j);
                    }
                }

                //분개한 내역이 모두 없어지면 부모내역 각 컬럼 원상복귀.
                if (nMatchIndex.length == 0){
                    var nDivideIndex = dsActbgtWorkList.getMatchedIndex("bgtItemiCd", sDstbBgtItemiCd); //배분코드로 어미내역 찾기
                    if (nDivideIndex.length > 0){
                        dsActbgtWorkList.setRowJSON(nDivideIndex[0], {
                                rowStatus: "U",
                                actbgtChgTypeCd: "",                        //구분
                                itexpGb: dsActbgtWorkList.getCellData(nDivideIndex[0], "chgbfItexpGb"),                     //비목구분
//                                contQty: dsActbgtWorkList.getCellData(nDivideIndex[0], "chgbfContQty"),                     //도급예산수량
//                                contUct: dsActbgtWorkList.getCellData(nDivideIndex[0], "chgbfContUct"),                     //도급예산단가
//                                contMtrctUct: dsActbgtWorkList.getCellData(nDivideIndex[0], "chgbfContMtrctUct"),           //도급예산_재료비_단가
//                                contLbctUct: dsActbgtWorkList.getCellData(nDivideIndex[0], "chgbfContLbctUct"),             //도급예산_노무비_단가
//                                contExpnsUct: dsActbgtWorkList.getCellData(nDivideIndex[0], "chgbfContExpnsUct"),           //도급예산_경비_단가
//                                actbgtQty: dsActbgtWorkList.getCellData(nDivideIndex[0], "chgbfActbgtQty"),                 //실행예산_수량
//                                actbgtUct: dsActbgtWorkList.getCellData(nDivideIndex[0], "chgbfActbgtUct"),                 //실행예산_단가
//                                actbgtMtrctUct: dsActbgtWorkList.getCellData(nDivideIndex[0], "chgbfActbgtMtrctUct"),       //실행예산_재료비_단가
//                                actbgtLbctUct: dsActbgtWorkList.getCellData(nDivideIndex[0], "chgbfActbgtLbctUct"),         //실행예산_노무비_단가
//                                actbgtExpnsUct: dsActbgtWorkList.getCellData(nDivideIndex[0], "chgbfActbgtExpnsUct"),       //실행예산_경비_단가
//                                plActbgtQty: dsActbgtWorkList.getCellData(nDivideIndex[0], "chgbfPlActbgtQty"),             //손익_실행예산_수량
//                                plActbgtUct: dsActbgtWorkList.getCellData(nDivideIndex[0], "chgbfPlActbgtUct"),             //손익_실행예산_단가
//                                plActbgtMtrctUct: dsActbgtWorkList.getCellData(nDivideIndex[0], "chgbfPlActbgtMtrctUct"),   //손익_실행예산_재료비_단가
//                                plActbgtLbctUct: dsActbgtWorkList.getCellData(nDivideIndex[0], "chgbfPlActbgtLbctUct"),     //손익_실행예산_노무비_단가
//                                plActbgtExpnsUct: dsActbgtWorkList.getCellData(nDivideIndex[0], "chgbfPlActbgtExpnsUct"),   //손익_실행예산_경비_단가                                                                                                
                                //dstbBgtItemiCd: "",                                                                       //배분_예산내역코드
                                workDstbBgtItemiCd: "",                                                                     //작업_배분_예산내역코드
                                chgStusGbVal: "",                                                                           //변경_상태_구분_값
                            },
                            true
                        );
                    }
                }
            }
        }
    };

    //저장
    scwin.btnSave_onclick = function() {
        if(scwin.fnValidationCheck()){
            if (confirm("저장 하시겠습니까?")) {
                scwin.fnSave();
            }
        }
    };
    
    //표준코드 저장
    scwin.btnStndSave_onclick = function() {        
        let arrList = dsActbgtWorkList.getModifiedIndex();                        
        let bResult = true;
        for (let i = 0; i<arrList.length; i++) {    
            let obj = dsActbgtWorkList.getRowJSON(arrList[i]);

            if (obj.rowStatus == "U") {
                if (obj.itemiYn == "Y") {//내역여부
                    if (obj.bgtItemiNm != "") {                        
                        bResult = false;
                        break;
                    }
                }
            }        
        }    
        
        if (bResult) {
            com.showMessage("SAA0043", "표준코드");//$1은(는) 필수입력사항입니다.
            return false;
        }
            
        if (confirm("저장 하시겠습니까?")) {
            ajaxLib.ajax("/cm/cm1505/CM15050010U/updateTcmActbgtStndItemiCd", {
                method: "POST",
                requestData: {
                   "tcmActbgtWorkVOs" : dsActbgtWorkList.getModifiedJSON(true)
                },
                callback: function(result, e) {
                    if (result.data == true){
                        com.showMessage("CFA0012"); //"저장되었습니다."
                        scwin.fnSearchActbgtItemiList(trvUpperActbgtWork.getSelectedValue());
                    }
                },
                errCallback: function(result, e) {
                }
            });        
        }        
    };    

    //검색조건의 예산변경유형 변경 이벤트
    scwin.cbxDelYn_onviewchange = function(info) {
        scwin.fnBeforeCheckSearch(cbxDelYn, info.checked);
    };

    //변경취소 클릭
    scwin.btnChangeCancel_onclick = function() {
        var chkArr = grdActbgtWorkList.getCheckedIndex("chk");
        var sMessage = "";

        if (chkArr.length <= 0){
            com.showMessage("EMA0007"); //"선택된 행이 없습니다."
            return false;
        }

        //변경된 사항 체크
        for (var i=0; i<chkArr.length; i++){
            if (dsActbgtWorkList.getCellData(chkArr[i], "chgStusGbVal") == ""){
                sMessage = chkArr[i]+1 + "번째 행은 변경된 사항이 없는 행" + "\n";
            }

            //추가된 행은 변경취소 할 수 없음.
            if (dsActbgtWorkList.getCellData(chkArr[i], "chgStusGbVal") == "I"){
                sMessage = chkArr[i]+1 + "번째 행은 추가된 행" + "\n";
            }

            //분개된 행은 변경취소 불가. 분개행 삭제 후 취소 가능하도록! 2019-10-22
            if (dsActbgtWorkList.getCellData(chkArr[i], "workDstbBgtItemiCd") != ""){
                sMessage = chkArr[i]+1 + "번째 행은 분개된 내역이 있는 행" + "\n";
            }
        }

        if (sMessage.length>0){
            com.showMessage("CMW0113", sMessage);  //"으로 변경취소 할 수 없습니다."
            return false;
        }

        for (var i=0; i<chkArr.length; i++){
            dsActbgtWorkList.setRowJSON(chkArr[i], {
                    rowStatus: "U",
                    actbgtChgTypeCd: "",                                                                //구분
                    itexpGb: dsActbgtWorkList.getCellData(chkArr[i], "chgbfItexpGb"),                   //비목구분
                    contQty: dsActbgtWorkList.getCellData(chkArr[i], "chgbfContQty"),                   //도급예산수량                    
                    contUct: dsActbgtWorkList.getCellData(chkArr[i], "chgbfContUct"),                   //도급예산단가
                    contAmt: dsActbgtWorkList.getCellData(chkArr[i], "chgbfContAmt"),                   //도급예산금액
                    contMtrctUct: dsActbgtWorkList.getCellData(chkArr[i], "chgbfContMtrctUct"),         //도급_재료비_단가
                    contMtrctAmt: dsActbgtWorkList.getCellData(chkArr[i], "chgbfContMtrctAmt"),         //도급_재료비_금액
                    contLbctUct: dsActbgtWorkList.getCellData(chkArr[i], "chgbfContLbctUct"),           //도급_노무비_단가
                    contLbctAmt: dsActbgtWorkList.getCellData(chkArr[i], "chgbfContLbctAmt"),           //도급_노무비_금액
                    contExpnsUct: dsActbgtWorkList.getCellData(chkArr[i], "chgbfContExpnsUct"),         //도급_경비_단가
                    contExpnsAmt: dsActbgtWorkList.getCellData(chkArr[i], "chgbfContExpnsAmt"),         //도급_경비_금액                                                                              
                    actbgtQty: dsActbgtWorkList.getCellData(chkArr[i], "chgbfActbgtQty"),               //실행예산_수량
                    actbgtUct: dsActbgtWorkList.getCellData(chkArr[i], "chgbfActbgtUct"),               //실행예산_단가
                    actbgtAmt: dsActbgtWorkList.getCellData(chkArr[i], "chgbfActbgtAmt"),               //실행예산_금액
                    actbgtMtrctUct: dsActbgtWorkList.getCellData(chkArr[i], "chgbfActbgtMtrctUct"),     //실행예산_재료비_단가
                    actbgtMtrctAmt: dsActbgtWorkList.getCellData(chkArr[i], "chgbfActbgtMtrctAmt"),     //실행예산_재료비_금액
                    actbgtLbctUct: dsActbgtWorkList.getCellData(chkArr[i], "chgbfActbgtLbctUct"),       //실행예산_노무비_단가
                    actbgtLbctAmt: dsActbgtWorkList.getCellData(chkArr[i], "chgbfActbgtLbctAmt"),       //실행예산_노무비_금액
                    actbgtExpnsUct: dsActbgtWorkList.getCellData(chkArr[i], "chgbfActbgtExpnsUct"),     //실행예산_경비_단가
                    actbgtExpnsAmt: dsActbgtWorkList.getCellData(chkArr[i], "chgbfActbgtExpnsAmt"),     //실행예산_경비_금액                                                                       
                    plActbgtQty: dsActbgtWorkList.getCellData(chkArr[i], "chgbfPlActbgtQty"),           //손익_실행예산_수량
                    plActbgtUct: dsActbgtWorkList.getCellData(chkArr[i], "chgbfPlActbgtUct"),           //손익_실행예산_단가
                    plActbgtAmt: dsActbgtWorkList.getCellData(chkArr[i], "chgbfPlActbgtAmt"),           //손익_실행예산_단가
                    plActbgtMtrctUct: dsActbgtWorkList.getCellData(chkArr[i], "chgbfPlActbgtMtrctUct"), //손익_실행예산_단가
                    plActbgtMtrctAmt: dsActbgtWorkList.getCellData(chkArr[i], "chgbfPlActbgtMtrctAmt"), //손익_실행예산_단가
                    plActbgtLbctUct: dsActbgtWorkList.getCellData(chkArr[i], "chgbfPlActbgtLbctUct"),   //손익_실행예산_단가
                    plActbgtLbctAmt: dsActbgtWorkList.getCellData(chkArr[i], "chgbfPlActbgtLbctAmt"),   //손익_실행예산_단가
                    plActbgtExpnsUct: dsActbgtWorkList.getCellData(chkArr[i], "chgbfPlActbgtExpnsUct"), //손익_실행예산_단가
                    plActbgtExpnsAmt: dsActbgtWorkList.getCellData(chkArr[i], "chgbfPlActbgtExpnsAmt"), //손익_실행예산_단가
                    chgStusGbVal: "",                                                                   //변경_상태_구분_값
                },
                true
            );
        }
    };

    //상세정보(내역) 그리드의 셀클릭
    scwin.grdActbgtWorkList_oncellclick = function(row,col) {
        
        let sColunmName = grdActbgtWorkList.getColumnID( col );
        if (sColunmName == "popStndJobtypCd") {
            let popOps = {
                popup_name: "표준내역",
                url: "/ux/cm/cm1500/CM15000015P.xml",
                data: {
                    multiSelectYn: false,
                    bgtNewAddYn: "Y",
                    siteCd: dsSearchMap.get("siteCd")
                },
                widType: "L",
                height: "678",
                callbackFn: "scwin.popStndJobtypCdCallback"
            };
            com.popup_open(popOps);
        } else if (sColunmName == "originalYn") {
            
            //내역 분개 조정 팝업 전 validation check 
            if (!scwin.fnPopUpActbgtByBgtItemiCdCheck(row,col)) return false;         
         
            let sOriginalYn = dsActbgtWorkList.getCellData(row, sColunmName);      
            let sBgtItemiCd = dsActbgtWorkList.getCellData(row, (sOriginalYn == "원본") ? "bgtItemiCd" : "dstbBgtItemiCd");
            
            let popOps = {
                popup_name: "내역조정",
                url: "/ux/cm/cm1505/CM15050011P.xml",
                data: {
                    "siteCd": dsSearchMap.get("siteCd"), 
                    "bgtItemiCd": sBgtItemiCd,
                    "dstbBgtItemiCd": sBgtItemiCd
                },
                width: "1400",
                height: "678",
                callbackFn: "scwin.fnPopUpActbgtByBgtItemiCd"
            };
            com.popup_open(popOps);
        }
    };
    
    //내역 분개 조정 팝업 전 validation check 
    scwin.fnPopUpActbgtByBgtItemiCdCheck = function(row, col) {        
        let sColunmName = grdActbgtWorkList.getColumnID(col);    
        let sChgStusGbVal = dsActbgtWorkList.getCellData(row, "chgStusGbVal");    //변경상태            
        let sOriginalYn = dsActbgtWorkList.getCellData(row, sColunmName);       //원본여부
        let sBgtItemiCd = null;
        let sDstbBgtItemiCd = null;                   
        let targetBgtItemiCd = null;         
        
        //변경 진행 중이나 분개가 되지 않은 건은 패스.
        if ((sOriginalYn == "") || (sChgStusGbVal != "")) return false;            
        
        //같은 분개내역 코드를 찾기 
        if (sOriginalYn == "원본") {
            targetBgtItemiCd = dsActbgtWorkList.getCellData(row, "bgtItemiCd");         
        } else if (sOriginalYn == "분개") {
            targetBgtItemiCd = dsActbgtWorkList.getCellData(row, "dstbBgtItemiCd");
            
            //분개일 경우 원본상태가 변경 중인 경우 수정 안됨.         
            let nBgtItemiCdIndex = dsActbgtWorkList.getMatchedIndex("bgtItemiCd", targetBgtItemiCd);            
            let sSctbgtChgTypeCd = dsActbgtWorkList.getCellData(nBgtItemiCdIndex[0], "actbgtChgTypeCd");   //원본은 무조건 하나임.
                
            if (sSctbgtChgTypeCd != ""){
                com.showMessage("CMW0176");     //"원본이 변경 진행 중인 경우 분개내역을 수정할 수 없습니다.".
                return false;
            }                      
            
        } else {        
            return false;
        }        
                                       
        //분개된 내역 중 변경 중인 건이 존재하면 수정 안됨.
        let nMatchIndex = dsActbgtWorkList.getMatchedIndex("dstbBgtItemiCd", targetBgtItemiCd);
        for (let i=0; i<nMatchIndex.length; i++){                     
            let sSctbgtChgTypeCd = dsActbgtWorkList.getCellData(nMatchIndex[i], "actbgtChgTypeCd");
            
            if (sSctbgtChgTypeCd != ""){
                com.showMessage("CMW0175");     //분개 내역 중 변경 진행 중인 건이 존재하는 경우 분개한 내역을 수정할 수 없습니다.
                return false;
            }                      
        }       
          
        return true;     
    };
    
    /** 내역조정 팝업 후처리 **/
    scwin.fnPopUpActbgtByBgtItemiCd = function(obj) {    
        scwin.fnSearchActbgtItemiList(trvUpperActbgtWork.getSelectedValue());
    };    
    

    //내역관리 상세정보(내역) 엑셀다운
    scwin.btnExcelDwn_onclick = function() {
        grdActbgtWorkList.advancedExcelDownload({
            fileName:"실행예산변경.xlsx",
            removeColumns:"0",
            useSubTotal : true,             // Sub-Total 표시 
            headerFontColor : "#FFFFFF",    // Header Font Color
            headerColor : "#D9D9D9",        // Header Back Color
            subTotalColor : "#FCE4D6",      // SubTotal Back Color
            footerColor : "#BDD7EE"         // Footer Color
        });
    };

    //자동순번 클릭
    scwin.btnAutoOrder_onclick = function() {
        for (let i=0; i<dsActbgtWorkList.getTotalRow(); i++){
            dsActbgtWorkList.setCellData(i, "sortOdr", (i+1)*10);
        }
        
        ajaxLib.ajax("/cm/cm1505/CM15050010U/updateTcmActbgtWorkBySortOrd", {
            method: "POST",
            requestData: {
               "tcmActbgtWorkVOs": dsActbgtWorkList.getModifiedJSON(true)
            },
            callback: function(result, e) {
                if (result.data == true){
                    com.showMessage("CFA0012"); //"저장되었습니다."
                    scwin.fnSearchActbgtItemiList(trvUpperActbgtWork.getSelectedValue());
                }
            },
            errCallback: function(result, e) {
            }
        });        
    };

    //내역조회 팝업
    scwin.btnItemPopup_onclick = function() {
        var popOps = {
            popup_name: "내역조회",
            url: "/ux/cm/cm1505/CM15050010P.xml",
            data: {
                "siteCd": dsSearchMap.get("siteCd")
            },
            widType: "L",
            height: "678",
            callbackFn: "scwin.fnItemPopupReturn"
        };
        com.popup_open(popOps);
    };

    //내역조회팝업 리턴 이벤트
    scwin.fnItemPopupReturn = function(obj){        
        let sValue = (obj.itemiYn == "Y") ? obj.upperBgtItemiCd : obj.bgtItemiCd;
        trvUpperActbgtWork.findNodeByValue(sValue, true);
        scwin.fnSearchActbgtItemiList(sValue, obj.bgtItemiCd);
    };

    //전체 펼치기, 접기
    scwin.btnTreeSpanAll_onclick = function() {
        if (dsUpperActbgtWorkList.getTotalRow() <= 0) {
            return false;
        }

        if (btnTreeSpanAll.getValue() == "전체 펼치기"){
            btnTreeSpanAll.setValue("전체 접기");
            trvUpperActbgtWork.spanAll(true);
        } else {
            btnTreeSpanAll.setValue("전체 펼치기");
            trvUpperActbgtWork.spanNode({depth:2}, false);
        }
    };

    //도급예산 숨김 클릭
    scwin.chkContColHidden_onchange = function() {
        var vChk = chkContColHidden.getValue() === "N" ? true : false;
        var arrColumnList = ["contQty", "contMtrctUct", "contMtrctAmt", "contLbctUct", "contLbctAmt", "contExpnsUct", 
                            "contExpnsAmt", "contUct", "contAmt"];        
        arrColumnList.forEach(function(item, index, array){
            grdActbgtWorkList.setColumnVisible(item, vChk);
        });
    };    

    //변경전 숨김 클릭
    scwin.chkColHidden_onchange = function() {        
        var vChk = chkColHidden.getValue() === "N" ? true : false;
        var arrColumnList = ["bgtItemiCd", "chgbfContQty", "chgbfContUct", "chgbfContAmt", "chgbfActbgtQty", "chgbfActbgtUct",
                             "chgbfActbgtAmt", "chgbfPlActbgtUct", "chgbfPlActbgtAmt"];
        arrColumnList.forEach(function(item, index, array){
            grdActbgtWorkList.setColumnVisible(item, vChk);
        });
    };

    //현장코드 변경 이벤트
    scwin.WFrameSiteInfo_change_callback = function(){
        dsSearchMap.set("siteCd", wfmKeySiteInfo.getWindow().ibxKeySiteCd.getValue());  //현장 코드
        scwin.btnFind_onclick();
    };

    //단수조정 클릭 이벤트
    scwin.btnAdjust_onclick = function() {
        
        var sUpperBgtItemiCd = trvUpperActbgtWork.getSelectedValue();
        if (sUpperBgtItemiCd == ""){
            com.showMessage("CMW0116"); //발주처공종의 내역을 선택해주세요.
            return false;
        }

        var nFocusRow = grdActbgtWorkList.getFocusedRowIndex();
        if (["CM0040012", "CM0040016"].indexOf(sbxActbgtChgType.getValue()) > -1){ //직영집행, 변경(조정)의 경우
            //필수 체크
            if (nFocusRow < 0){
                com.showMessage("CMW0099");   //먼저 상세내역을 선택 후 추가 버튼을 클릭하세요.
                return false;
            } else if (dsActbgtWorkList.getCellData(nFocusRow, "actbgtChgTypeCd") == ""){
                com.showMessage("CMW0164");   //선택한 내역이 구분이 "변경(조정)" 이나 "직영집행" 상태여야 단수조정이 가능합니다.
                return false;
            }

            //선택한 내역의 분개한 내역들 중 가장 마지막 row 아래로 단수조정 row 추가되도록!
            var sWorkDstbBgtItemiCd = dsActbgtWorkList.getCellData(nFocusRow, "workDstbBgtItemiCd");
            var nDivideIndex = dsActbgtWorkList.getMatchedIndex("workDstbBgtItemiCd", sWorkDstbBgtItemiCd.replaceAll("*","")); //자식내역 전부 찾기
            nFocusRow = nDivideIndex[nDivideIndex.length - 1];
        } else {

        }

        //행추가 및 컬럼 셋팅.
        var sActbgtChgType = sbxActbgtChgType.getValue();
        var nThisOrd = dsActbgtWorkList.getCellData(nFocusRow, "sortOdr");  //선택한 정렬번호
        var nStdOrd = Math.ceil((nThisOrd+1)/10)*10;
        nStdOrd = (nThisOrd == nStdOrd) ? nStdOrd + 10 : nStdOrd;           //계산한 번호와 같으면 10을 더한다.
        var objAddJson = [];
        var arrAddJson = {
            siteCd: dsSearchMap.get("siteCd"),                                      //현장코드
            upperBgtItemiCd: sUpperBgtItemiCd,                                      //상위_예산내역코드
            itemiYn: "Y",                                                           //내역_여부
            gubun: sbxActbgtChgType.getText(),                                      //예산내역코드
            bgtItemiNm: "단수조정분",                                               //예산_내역_명
            bgtItemiStdr: dsActbgtWorkList.getCellData(nFocusRow, "bgtItemiStdr"),  //예산_내역_규격
            bgtItemiUnit: dsActbgtWorkList.getCellData(nFocusRow, "bgtItemiUnit"),  //예산_내역_단위
            itexpGb: dsActbgtWorkList.getCellData(nFocusRow, "itexpGb"),            //비목구분
            actbgtChgTypeCd: sActbgtChgType,                                        //구분
            contQty: 0,                                                             //도급수량
            contUct: 0,                                                             //도급단가
            actbgtQty: 0,                                                           //실행예산수량
            actbgtUct: 0,                                                           //실행예산단가
            plActbgtQty: 0,                                                         //손익실행예산수량
            plActbgtUct: 0,                                                         //손익실행예산단가
            stndItemiCd: "H-0001-0001",                                             //표준내역코드
            stndItemiNm: "단수조정분",                                              //표준내역명
            sortOdr: nStdOrd + 10,                                                  //정렬순서
            chgStusGbVal: "I"                                                       //변경_상태_구분_값
        };
        objAddJson.push(arrAddJson);
        dsActbgtWorkList.insertJSON(nFocusRow + 1, objAddJson);
        grdActbgtWorkList.setFocusedCell(nFocusRow, "chk");

        //예산변경유형별 컬럼 disable
        scwin.fnGridColumnControl(sActbgtChgType, nFocusRow+1, "I");

        //추가행부터 마지막까지 자동순번
        scwin.fnSetNextSortOrd(nFocusRow);
    };

    //추가잡업 버튼 클릭 이벤트 
	scwin.btnAddPopup_onclick = function() {
        let popOps = {
            popup_name: "추가작업",
            url: "/ux/cm/cm1505/CM15050012P.xml",
            data: dsSearchMap.getJSON(),
            width: "1400",
            height: "700",
            callbackFn: "scwin.fnPopUpActbgtByBgtItemiCd"
        };
                
        com.popup_open(popOps);
	};
]]></script>
        <w2:require src="/ux/common/udc/udcGridFix.xml"></w2:require>
    </head>
    <body ev:onpageload="scwin.onpageload" ev:onpageunload="scwin.onpageunload">
        <xf:group class="content_body" id="" style="">
            <xf:group class="navigator_wrap" id="" style="">
                <w2:wframe id="wfm_title" src="/ux/common/navigator.xml" style=""></w2:wframe>
            </xf:group>
            <xf:group class="tbl_search" id="" style="">
                <xf:group class="tb_list" id="" style="" tagname="table">
                    <w2:attributes>
                        <w2:summary>조회조건 테이블 입니다.</w2:summary>
                    </w2:attributes>
                    <xf:group tagname="colgroup">
                        <xf:group style="width:67px;" tagname="col"></xf:group>
                        <xf:group style="width:auto;" tagname="col"></xf:group>
                        <xf:group tagname="col" style="width:121px;"></xf:group>
                        <xf:group tagname="col" style="width:auto;"></xf:group>
                        <xf:group style="width:121px;" tagname="col"></xf:group>
                        <xf:group style="width:auto;" tagname="col"></xf:group>
                    </xf:group>
                    <xf:group style="" tagname="tr">
                        <xf:group class="w2tb_th req" style="" tagname="th">
                            <w2:attributes>
                                <w2:scope>row</w2:scope>
                            </w2:attributes>
                            <w2:span class="" id="" label="현장" style=""></w2:span>
                        </xf:group>
                        <xf:group class="w2tb_td" style="" tagname="td">
                            <w2:wframe id="wfmKeySiteInfo" src="/WEB-INF/ux/cm/cmcomm/schSiteInfo.xml" style=""></w2:wframe>
                        </xf:group>
                        <xf:group tagname="th" class="w2tb_th req">
                            <w2:attributes>
                                <w2:scope>row</w2:scope>
                            </w2:attributes>
                            <w2:span class="" id="" label="예산변경유형" style=""></w2:span>
                        </xf:group>
                        <xf:group tagname="td" class="w2tb_td">
                            <w2:attributes>
                                <w2:scope>row</w2:scope>
                            </w2:attributes>
                            <xf:select1 allOption="" appearance="minimal" chooseOption="" class="req" direction="auto" disabled="false"
                                disabledClass="w2selectbox_disabled" displayMode="label" id="sbxActbgtChgType" ref="" style="width:150px;"
                                submenuSize="auto" textAlign="left" mandatory="true" ev:onchange="scwin.sbxActbgtChgType_onchange"
                                ev:onviewchange="scwin.sbxActbgtChgType_onviewchange">
                                <xf:choices></xf:choices>
                            </xf:select1>
                        </xf:group>
                        <xf:group class="w2tb_th" style="" tagname="th">
                            <w2:attributes>
                                <w2:scope>row</w2:scope>
                            </w2:attributes>
                            <w2:span class="" id="" label="삭제포함여부" style=""></w2:span>
                        </xf:group><xf:group class="w2tb_td" style="" tagname="td">
                            <w2:attributes></w2:attributes>
                            <xf:select appearance="full" class="" cols="" falseValue="N" id="cbxDelYn" ref="data:dsSearchMap.delYn" renderType="checkboxgroup" rows="" selectedindex="" style="" ev:onviewchange="scwin.cbxDelYn_onviewchange">
                                <xf:choices>
                                    <xf:item>
                                        <xf:label></xf:label>
                                        <xf:value><![CDATA[Y]]></xf:value>
                                    </xf:item>
                                </xf:choices>
                            </xf:select>
                        </xf:group><xf:group class="w2tb_th" style="" tagname="th">
                            <w2:attributes>
                                <w2:scope>row</w2:scope>
                            </w2:attributes>
                            <w2:span class="" id="" label="실행예산구분" style=""></w2:span>
                        </xf:group>
                        <xf:group class="w2tb_td" style="" tagname="td">
                            <w2:span class="txt_unit fc_blue" id="" label="가실행예산" style=""
                                ref="data:dsBgtGbCd.actbgtChgTypeNm">
                            </w2:span>
                            <w2:span class="txt_unit fc_red" id="" label="[완료]" style=""
                                ref="data:dsBgtGbCd.fnncConfStusNm">
                            </w2:span>
                        </xf:group>


                    </xf:group>
                </xf:group>
                <xf:group class="btn_tbl_search" style="" tagname="">
                    <w2:anchor class="btn_sh" id="btnFind" outerDiv="false" style="" ev:onclick="scwin.btnFind_onclick">
                        <xf:label><![CDATA[조회]]></xf:label>
                    </w2:anchor>
                </xf:group>
            </xf:group>
            <xf:group class="defaultbox" id="" style="">
                <xf:group class="lybox_wrap fix_300 foldingbox1 on" id="" style="">
                    <xf:group class="lybox" id="" style="">
                        <xf:group class="lycolumn" id="" style="">
                            <xf:group class="lyinner" id="" style="">
                                <xf:group class="defaultbox" id="" style="">
                                    <w2:textbox class="df_tt" id="" label="실행예산공종" style="" tagname="h3"></w2:textbox>
                                    <xf:group class="right_wrap" id="" style="">
                                        <w2:anchor class="btn_gcm" id="btnTreeSpanAll" outerDiv="false" style="" disabled="false" ev:onclick="scwin.btnTreeSpanAll_onclick">
                                            <xf:label><![CDATA[전체 펼치기]]></xf:label>
                                        </w2:anchor>
                                    </xf:group>
                                </xf:group>
                                <w2:anchor class="btn_folding" id="" outerDiv="false" style="">
                                    <xf:label></xf:label>
                                </w2:anchor>
                                <w2:treeview class="autoHeight" dataType="listed" id="trvUpperActbgtWork" lineShow="" style="height:300px" tooltipGroupClass="false" useDrag="" ev:onlabelclick="scwin.trvUpperActbgtWork_onlabelclick" showTreeDepth="1">
                                    <w2:itemset nodeset="data:dsUpperActbgtWorkList">
                                        <w2:label ref="bgtItemiNm"></w2:label>
                                        <w2:value ref="bgtItemiCd"></w2:value>
                                        <w2:depth ref="bgtItemiLv"></w2:depth>
                                        <w2:folder ref="itemiYn"></w2:folder>
                                        <w2:checkbox ref=""></w2:checkbox>
                                        <w2:checkboxDisabled ref=""></w2:checkboxDisabled>
                                        <w2:image ref=""></w2:image>
                                        <w2:iconImage ref=""></w2:iconImage>
                                        <w2:selectedImage ref=""></w2:selectedImage>
                                        <w2:expandedImage ref=""></w2:expandedImage>
                                        <w2:leafImage ref=""></w2:leafImage>
                                    </w2:itemset>
                                </w2:treeview>
                            </xf:group>
                        </xf:group>
                        
                        <xf:group class="lycolumn" id="" style="">
                            <xf:group class="lyinner" id="" style="">                                
                                <xf:group class="defaultbox" id="" style="">
                                    <w2:textbox class="df_tt" id="" label="상세정보(내역)" style="" tagname="h3"></w2:textbox>
                                    <xf:group class="right_wrap" id="" style="">
                                        <xf:group id="" style="">
                                            <xf:select appearance="full" class="" cols="" ev:onchange="scwin.chkContColHidden_onchange"
                                                ev:oncheckboxclick="" falseValue="N" id="chkContColHidden"
                                                ref="data:dsSearchMap.contColHiddenYn" renderType="checkboxgroup" rows="" selectedindex="0"
                                                style="" useCheckboxTitle="" ev:onviewchange="" title="">
                                                <xf:choices>
                                                    <xf:item>
                                                        <xf:label><![CDATA[도급예산 숨김]]></xf:label>
                                                        <xf:value><![CDATA[Y]]></xf:value>
                                                    </xf:item>
                                                </xf:choices>
                                            </xf:select>
                                            <xf:select appearance="full" class="" cols="" ev:onchange="scwin.chkColHidden_onchange"
                                                ev:oncheckboxclick="scwin.chkColHidden_oncheckboxclick"
                                                ev:onviewchange="scwin.chkColHidden_onviewchange" falseValue="N" id="chkColHidden"
                                                ref="data:dsSearchMap.colHiddenYn" renderType="checkboxgroup" rows="" selectedindex="0"
                                                style="" title="" useCheckboxTitle="">
                                                <xf:choices>
                                                    <xf:item>
                                                        <xf:label><![CDATA[변경전 숨김]]></xf:label>
                                                        <xf:value><![CDATA[Y]]></xf:value>
                                                    </xf:item>
                                                </xf:choices>
                                            </xf:select>
                                            <w2:anchor class="btn_gcm" ev:onclick="scwin.btnAddPopup_onclick" id="btnAddPopup"
                                                outerDiv="false" style="" disabled="true">
                                                <xf:label><![CDATA[추가작업]]></xf:label>
                                            </w2:anchor>
                                            <w2:anchor class="btn_gcm" ev:onclick="scwin.btnItemPopup_onclick" id="btnItemPopup"
                                                outerDiv="false" style="" disabled="true">
                                                <xf:label><![CDATA[내역검색]]></xf:label>
                                            </w2:anchor>
                                            <w2:anchor class="btn_gcm" disabled="true" ev:onclick="scwin.btnAdjust_onclick" id="btnAdjust"
                                                outerDiv="false" style="">
                                                <xf:label><![CDATA[단수조정]]></xf:label>
                                            </w2:anchor>
                                            <xf:input class="ar" id="sbxInsertRowNumber" style="width:60px; " allowChar="0-9" maxlength="3"
                                                dataType="number">
                                                <w2:attributes>
                                                    <w2:value>1</w2:value>
                                                </w2:attributes>
                                            </xf:input>
                                            <w2:anchor class="btn_gcm" id="btnItemInsertRow" outerDiv="false" style=""
                                                ev:onclick="scwin.btnItemInsertRow_onclick" disabled="true">
                                                <xf:label><![CDATA[내역추가]]></xf:label>
                                            </w2:anchor>
                                            <w2:anchor class="btn_gcm" id="btnItemDivide" outerDiv="false" style=""
                                                ev:onclick="scwin.btnItemDivide_onclick" disabled="true">
                                                <xf:label><![CDATA[내역분개]]></xf:label>
                                            </w2:anchor>
                                            <w2:anchor class="btn_gcm" id="btnChangeCancel" outerDiv="false" style=""
                                                ev:onclick="scwin.btnChangeCancel_onclick" disabled="true">
                                                <xf:label><![CDATA[변경취소]]></xf:label>
                                            </w2:anchor>
                                            <w2:anchor class="btn_gcm" clickEventElement="" id="btnSave" outerDiv="false" style=""
                                                ev:onclick="scwin.btnSave_onclick" disabled="true">
                                                <xf:label><![CDATA[저장]]></xf:label>
                                            </w2:anchor>
                                            <w2:anchor class="btn_gcm" clickEventElement="" disabled="false"
                                                ev:onclick="scwin.btnStndSave_onclick" id="btnStndSave" outerDiv="false" style="">
                                                <xf:label><![CDATA[표준코드저장]]></xf:label>
                                            </w2:anchor>
                                            <w2:anchor class="btn_gcm" clickEventElement="" ev:onclick="scwin.btnAutoOrder_onclick"
                                                id="btnAutoOrder" outerDiv="false" style="" disabled="true">
                                                <xf:label><![CDATA[자동순번저장]]></xf:label>
                                            </w2:anchor>
                                            <w2:anchor class="btn_gcm row_del" clickEventElement="" id="btnDelRow" outerDiv="false" style=""
                                                toolTip="행삭제" ev:onclick="scwin.btnDelRow_onclick">
                                                <xf:label><![CDATA[행삭제]]></xf:label>
                                            </w2:anchor>
                                            <w2:anchor class="btn_gcm excel_down" clickEventElement="" id="btnExcelDwn" localeRef=""
                                                outerDiv="false" style="" toolTip="엑셀다운로드" ev:onclick="scwin.btnExcelDwn_onclick">
                                                <xf:label><![CDATA[엑셀다운로드]]></xf:label>
                                            </w2:anchor>
                                        </xf:group>
                                    </xf:group>
                                </xf:group>
                                <w2:gridView autoFit="lastColumn" class="autoHeight s_narrow" dataList="data:dsActbgtWorkList"
                                    fixedColumnWithHidden="" focusMode="row" id="grdActbgtWorkList" readOnly="false" rowNumHeaderValue="No"
                                    rowNumVisible="" rowStatusHeaderValue="" rowStatusVisible="" rowStatusWidth="30" scrollByColumn="false"
                                    style="height: 300px;" useShiftKey="true" visibleRowNum="" selectByLabel="true" copyOption="display"
                                    ev:onviewchange="scwin.grdActbgtWorkList_onviewchange"
                                    ev:oncellclick="scwin.grdActbgtWorkList_oncellclick" checkReadOnlyOnPaste="true" keyMoveEditMode="true"
                                    readOnlyTabIgnore="true" fixedRow="" fixedColumn="7" enterKeyMove="down" contextMenu="true"
                                    preventAddRowOnPaste="true" ev:oncustompaste="" ev:onafteredit="" ignoreNonEditableCell="true" tooltipDisplay="true">
                                    <w2:header id="header1" style="">
                                        <w2:row id="row6" style="">
                                            <w2:column hidden="false" removeBorderStyle="false" width="40" inputType="checkbox"
                                                style="height:102px;" id="column244" blockSelect="false" displayMode="label" rowSpan="3">
                                            </w2:column>
                                            <w2:column hidden="false" removeBorderStyle="false" width="45" inputType="text"
                                                style="height:102px;" id="column246" value="No." blockSelect="false" displayMode="label"
                                                rowSpan="3">
                                            </w2:column>
                                            <w2:column hidden="false" removeBorderStyle="false" width="90" inputType="text"
                                                style="height:102px;" id="column248" value="구분" blockSelect="false" displayMode="label"
                                                rowSpan="3">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="70" inputType="text" style="height:102px;"
                                                id="column425" value="원본여부" blockSelect="false" displayMode="label" colSpan=""
                                                rowSpan="3">
                                            </w2:column>
                                            <w2:column hidden="false" removeBorderStyle="false" width="140" inputType="text"
                                                style="height:102px;" id="column250" value="품명" blockSelect="false" displayMode="label"
                                                class="req" rowSpan="3">
                                            </w2:column>
                                            <w2:column hidden="false" removeBorderStyle="false" width="80" inputType="text"
                                                style="height:102px;" id="column252" value="규격" blockSelect="false" displayMode="label"
                                                rowSpan="3">
                                            </w2:column>
                                            <w2:column hidden="false" removeBorderStyle="false" width="80" inputType="text"
                                                style="height:102px;" id="column254" value="단위" blockSelect="false" displayMode="label"
                                                class="" rowSpan="3">
                                            </w2:column>
                                            <w2:column hidden="false" removeBorderStyle="false" width="80" inputType="text"
                                                style="height:102px;" id="column256" value="비목" blockSelect="false" displayMode="label"
                                                class="" rowSpan="3">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="92" inputType="text" style="height:102px;"
                                                id="column282" value="예산내역코드" blockSelect="false" displayMode="label" rowSpan="3"
                                                hidden="false" colSpan="">
                                            </w2:column>
                                            <w2:column blockSelect="false" colSpan="3" displayMode="label" id="column94" inputType="text"
                                                removeBorderStyle="false" style="height:34px;" value="변경전_도급예산" width="115"
                                                hidden="false">
                                            </w2:column>
                                            <w2:column blockSelect="false" colSpan="3" displayMode="label" id="column91" inputType="text"
                                                removeBorderStyle="false" style="height:34px;" value="변경전_실행예산" width="115"
                                                hidden="false">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="115" inputType="text" style="height:34px;"
                                                id="column212" value="변경전_손익실행예산" blockSelect="false" displayMode="label" colSpan="2"
                                                hidden="false">
                                            </w2:column>
                                            <w2:column blockSelect="false" colSpan="9" displayMode="label" id="column88" inputType="text"
                                                removeBorderStyle="false" style="height:34px;" value="도급예산" width="185">
                                            </w2:column>
                                            <w2:column blockSelect="false" colSpan="9" displayMode="label" id="column85" inputType="text"
                                                removeBorderStyle="false" style="height:34px;" value="실행예산" width="70">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="70" inputType="text" style="height:34px;"
                                                id="column223" value="손익실행예산" blockSelect="false" displayMode="label" colSpan="2">
                                            </w2:column>
                                            <w2:column hidden="false" removeBorderStyle="false" width="124" inputType="text"
                                                style="height:34px;" id="column271" value="증감" blockSelect="false" displayMode="label"
                                                colSpan="3">
                                            </w2:column>
                                            <w2:column hidden="false" removeBorderStyle="false" width="70" inputType="text"
                                                style="height:102px;" id="column258" value="실행&lt;br/&gt;원가율&lt;br/&gt;(%)"
                                                blockSelect="false" displayMode="label" rowSpan="3">
                                            </w2:column>
                                            <w2:column blockSelect="false" displayMode="label" id="column160" inputType="text"
                                                removeBorderStyle="false" rowSpan="3" style="height:102px;" value="계약진행&lt;br/&gt;여부"
                                                width="80">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="75" inputType="text" style="height:102px;"
                                                id="column278" value="계약수량" blockSelect="false" displayMode="label" rowSpan="3">
                                            </w2:column>
                                            <w2:column blockSelect="false" colSpan="2" displayMode="label" id="column152" inputType="text"
                                                removeBorderStyle="false" style="height:34px;" value="집행원가" width="84">
                                            </w2:column>
                                            <w2:column hidden="false" removeBorderStyle="false" width="100" inputType="text"
                                                style="height:102px;" id="column260" value="현장관리비&lt;br/&gt;예산금액" blockSelect="false"
                                                displayMode="label" rowSpan="3">
                                            </w2:column>
                                            <w2:column hidden="false" removeBorderStyle="false" width="80" inputType="text"
                                                style="height:102px;" id="column262" value="직영집행&lt;br/&gt;승인여부" blockSelect="false"
                                                displayMode="label" rowSpan="3">
                                            </w2:column>
                                            <w2:column hidden="true" removeBorderStyle="false" width="180" inputType="text"
                                                style="height:102px;" id="column265" value="표준코드" blockSelect="false" displayMode="label"
                                                colSpan="2" rowSpan="3">
                                            </w2:column>
                                            <w2:column hidden="false" removeBorderStyle="false" width="50" inputType="text"
                                                style="height:102px;" id="column269" value="정렬&lt;br/&gt;순서" blockSelect="false"
                                                displayMode="label" class="req" rowSpan="3">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="300" inputType="text" style="height:90px;"
                                                id="column430" value="분개공종경로" blockSelect="false" displayMode="label" colSpan=""
                                                rowSpan="3">
                                            </w2:column>
                                        </w2:row>
                                        <w2:row id="row7" style="">
                                            <w2:column blockSelect="false" displayMode="label" id="column119" inputType="text"
                                                removeBorderStyle="false" style="height:34px;" value="수량" width="100" hidden="false"
                                                colSpan="" rowSpan="2">
                                            </w2:column>
                                            <w2:column blockSelect="false" displayMode="label" id="column118" inputType="text"
                                                removeBorderStyle="false" style="height:34px;" value="합계" width="230" hidden="false"
                                                colSpan="2" rowSpan="">
                                            </w2:column>
                                            <w2:column blockSelect="false" displayMode="label" id="column116" inputType="text"
                                                removeBorderStyle="false" style="height:34px;" value="수량" width="100" hidden="false"
                                                colSpan="" rowSpan="2">
                                            </w2:column>
                                            <w2:column blockSelect="false" displayMode="label" id="column115" inputType="text"
                                                removeBorderStyle="false" style="height:34px;" value="합계" width="230" hidden="false"
                                                colSpan="2" rowSpan="">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="230" inputType="text" style="height:34px;"
                                                id="column213" value="합계" blockSelect="false" displayMode="label" hidden="false" colSpan="2"
                                                rowSpan="">
                                            </w2:column>
                                            <w2:column blockSelect="false" displayMode="label" id="column113" inputType="text"
                                                removeBorderStyle="false" style="height:34px;" value="수량" width="100" rowSpan="2">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="70" inputType="text" style="height:34px;"
                                                id="column361" value="재료비" blockSelect="false" displayMode="label" colSpan="2">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="70" inputType="text" style="height:34px;"
                                                id="column386" value="노무비" blockSelect="false" displayMode="label" colSpan="2">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="70" inputType="text" style="height:34px;"
                                                id="column376" value="경비" blockSelect="false" displayMode="label" colSpan="2">
                                            </w2:column>
                                            <w2:column blockSelect="false" displayMode="label" id="column112" inputType="text"
                                                removeBorderStyle="false" style="height:34px;" value="합계" width="230" colSpan="2">
                                            </w2:column>
                                            <w2:column blockSelect="false" displayMode="label" id="column110" inputType="text"
                                                removeBorderStyle="false" style="height:34px;" value="수량" width="100" rowSpan="2">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="70" inputType="text" style="height:34px;"
                                                id="column421" value="재료비" blockSelect="false" displayMode="label" colSpan="2">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="70" inputType="text" style="height:34px;"
                                                id="column411" value="노무비" blockSelect="false" displayMode="label" colSpan="2">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="70" inputType="text" style="height:34px;"
                                                id="column401" value="경비" blockSelect="false" displayMode="label" colSpan="2">
                                            </w2:column>
                                            <w2:column blockSelect="false" displayMode="label" id="column109" inputType="text"
                                                removeBorderStyle="false" style="height:34px;" value="합계" width="230" colSpan="2">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="230" inputType="text" style="height:34px;"
                                                id="column224" value="합계" blockSelect="false" displayMode="label" colSpan="2">
                                            </w2:column>
                                            <w2:column hidden="false" removeBorderStyle="false" width="115" inputType="text"
                                                style="height:34px;" id="column275" value="도급예산금액" blockSelect="false" displayMode="label"
                                                rowSpan="2">
                                            </w2:column>
                                            <w2:column hidden="false" removeBorderStyle="false" width="115" inputType="text"
                                                style="height:34px;" id="column276" value="실행예산금액" blockSelect="false" displayMode="label"
                                                rowSpan="2">
                                            </w2:column>
                                            <w2:column hidden="false" removeBorderStyle="false" width="124" inputType="text"
                                                style="height:34px;" id="column277" value="손익실행예산금액" blockSelect="false" displayMode="label"
                                                rowSpan="2">
                                            </w2:column>
                                            <w2:column blockSelect="false" displayMode="label" id="column153" inputType="text"
                                                removeBorderStyle="false" style="height:34px;" value="수량" width="110" rowSpan="2">
                                            </w2:column>
                                            <w2:column blockSelect="false" displayMode="label" id="column149" inputType="text"
                                                removeBorderStyle="false" style="height:34px;" value="금액" width="115" rowSpan="2">
                                            </w2:column>
                                        </w2:row>
                                        <w2:row style="" id="row10">
                                            <w2:column removeBorderStyle="false" width="115" inputType="text" id="column350"
                                                blockSelect="false" displayMode="label" style="" value="단가">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="115" inputType="text" id="column349"
                                                blockSelect="false" displayMode="label" style="" value="금액">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="115" inputType="text" id="column347"
                                                blockSelect="false" displayMode="label" style="" value="단가">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="115" inputType="text" id="column346"
                                                blockSelect="false" displayMode="label" style="" value="금액">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="115" inputType="text" id="column345"
                                                blockSelect="false" displayMode="label" style="" value="단가">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="115" inputType="text" id="column344"
                                                blockSelect="false" displayMode="label" style="" value="금액">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="115" inputType="text" id="column342" value="단가"
                                                blockSelect="false" displayMode="label" style="">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="115" inputType="text" id="column341" value="금액"
                                                blockSelect="false" displayMode="label" style="">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="115" inputType="text" id="column362" value="단가"
                                                blockSelect="false" displayMode="label" style="">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="115" inputType="text" id="column392" value="금액"
                                                blockSelect="false" displayMode="label" style="">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="115" inputType="text" id="column387" value="단가"
                                                blockSelect="false" displayMode="label" style="">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="115" inputType="text" id="column382" value="금액"
                                                blockSelect="false" displayMode="label" style="">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="115" inputType="text" id="column377" value="단가"
                                                blockSelect="false" displayMode="label" style="">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="115" inputType="text" id="column372" value="금액"
                                                blockSelect="false" displayMode="label" style="">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="115" inputType="text" id="column339" value="단가"
                                                blockSelect="false" displayMode="label" style="">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="115" inputType="text" id="column338" value="금액"
                                                blockSelect="false" displayMode="label" style="">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="115" inputType="text" id="column422" value="단가"
                                                blockSelect="false" displayMode="label" style="">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="115" inputType="text" id="column417" value="금액"
                                                blockSelect="false" displayMode="label" style="">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="115" inputType="text" id="column412" value="단가"
                                                blockSelect="false" displayMode="label" style="">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="115" inputType="text" id="column407" value="금액"
                                                blockSelect="false" displayMode="label" style="">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="115" inputType="text" id="column402" value="단가"
                                                blockSelect="false" displayMode="label" style="">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="115" inputType="text" id="column397" value="금액"
                                                blockSelect="false" displayMode="label" style="">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="115" inputType="text" id="column337" value="단가"
                                                blockSelect="false" displayMode="label" style="">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="115" inputType="text" id="column336" value="금액"
                                                blockSelect="false" displayMode="label" style="">
                                            </w2:column>
                                        </w2:row>
                                    </w2:header>
                                    <w2:gBody id="gBody4" style="">
                                        <w2:row id="row5" style="">
                                            <w2:column blockSelect="false" displayMode="label" id="chk" inputType="checkbox"
                                                readOnly="false" removeBorderStyle="false" width="49">
                                            </w2:column>
                                            <w2:column blockSelect="false" displayMode="label" expression="rowindex()+1" id="column22"
                                                inputType="expression" removeBorderStyle="false" width="45">
                                            </w2:column>
                                            <w2:column blockSelect="false" displayMode="label" id="actbgtChgTypeCd" inputType="select"
                                                removeBorderStyle="false" width="90" readOnly="true" disabled="false">
                                                <w2:choices></w2:choices>
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="70" inputType="link" style="" id="originalYn"
                                                value="" blockSelect="false" displayMode="label" readOnly="">
                                            </w2:column>
                                            <w2:column blockSelect="false" displayMode="label" id="bgtItemiNm" inputType="text"
                                                removeBorderStyle="false" textAlign="left" width="140" maxByteLength="300">
                                            </w2:column>
                                            <w2:column blockSelect="false" displayMode="label" id="bgtItemiStdr" inputType="text"
                                                removeBorderStyle="false" textAlign="left" width="80" maxByteLength="200">
                                            </w2:column>
                                            <w2:column blockSelect="false" displayMode="label" id="bgtItemiUnit" inputType="text"
                                                removeBorderStyle="false" width="80" maxByteLength="50">
                                            </w2:column>
                                            <w2:column blockSelect="false" displayMode="label" id="itexpGb" inputType="select"
                                                removeBorderStyle="false" width="80" selectedData="true">
                                                <w2:choices>
                                                    <w2:item>
                                                        <w2:label><![CDATA[자재]]></w2:label>
                                                        <w2:value><![CDATA[M]]></w2:value>
                                                    </w2:item>
                                                    <w2:item>
                                                        <w2:label><![CDATA[노무]]></w2:label>
                                                        <w2:value><![CDATA[L]]></w2:value>
                                                    </w2:item>
                                                    <w2:item>
                                                        <w2:label><![CDATA[외주]]></w2:label>
                                                        <w2:value><![CDATA[S]]></w2:value>
                                                    </w2:item>
                                                    <w2:item>
                                                        <w2:label><![CDATA[경비]]></w2:label>
                                                        <w2:value><![CDATA[O]]></w2:value>
                                                    </w2:item>
                                                </w2:choices>
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="92" inputType="text" id="bgtItemiCd"
                                                blockSelect="false" displayMode="label" readOnly="true" hidden="false">
                                            </w2:column>
                                            <w2:column blockSelect="false" displayMode="label" id="chgbfContQty" inputType="text"
                                                removeBorderStyle="false" width="100" textAlign="right" displayFormat="#,##0.000"
                                                defaultValue="0.000" readOnly="true">
                                            </w2:column>
                                            <w2:column blockSelect="false" displayMode="label" id="chgbfContUct" inputType="text"
                                                removeBorderStyle="false" width="115" textAlign="right" readOnly="true"
                                                displayFormat="#,##0" defaultValue="0">
                                            </w2:column>
                                            <w2:column blockSelect="false" displayMode="label" id="chgbfContAmt" inputType="text"
                                                removeBorderStyle="false" width="115" textAlign="right" readOnly="true"
                                                displayFormat="#,##0" defaultValue="0">
                                            </w2:column>
                                            <w2:column blockSelect="false" displayMode="label" id="chgbfActbgtQty" inputType="text"
                                                removeBorderStyle="false" width="100" textAlign="right" displayFormat="#,##0.000"
                                                defaultValue="0.000" readOnly="true">
                                            </w2:column>
                                            <w2:column blockSelect="false" displayMode="label" id="chgbfActbgtUct" inputType="text"
                                                removeBorderStyle="false" width="115" textAlign="right" readOnly="true"
                                                displayFormat="#,##0" defaultValue="0">
                                            </w2:column>
                                            <w2:column blockSelect="false" displayMode="label" id="chgbfActbgtAmt" inputType="text"
                                                removeBorderStyle="false" width="115" textAlign="right" readOnly="true"
                                                displayFormat="#,##0" defaultValue="0">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="115" inputType="text" id="chgbfPlActbgtUct"
                                                blockSelect="false" displayMode="label" textAlign="right" displayFormat="#,##0"
                                                readOnly="true" defaultValue="0">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="115" inputType="text" id="chgbfPlActbgtAmt"
                                                blockSelect="false" displayMode="label" textAlign="right" displayFormat="#,##0"
                                                readOnly="true" defaultValue="0">
                                            </w2:column>
                                            <w2:column blockSelect="false" displayMode="label" id="contQty" inputType="text"
                                                removeBorderStyle="false" width="100" textAlign="right" displayFormat="#,##0.000"
                                                defaultValue="0.000" allowChar="0-9.,-\s" applyFormat="all" maxByteLength="18">
                                            </w2:column>
                                            <w2:column width="70" inputType="text" id="contMtrctUct" blockSelect="false" displayMode="label"
                                                textAlign="right" allowChar="0-9,-\s" displayFormat="#,##0" defaultValue="0"
                                                maxLength="15">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="70" inputType="text" id="contMtrctAmt"
                                                blockSelect="false" displayMode="label" textAlign="right" displayFormat="#,##0"
                                                defaultValue="0" maxLength="15" readOnly="true">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="70" inputType="text" id="contLbctUct"
                                                blockSelect="false" displayMode="label" textAlign="right" allowChar="0-9,-\s"
                                                displayFormat="#,##0" defaultValue="0" maxLength="15" ignoreChar="》">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="70" inputType="text" id="contLbctAmt"
                                                blockSelect="false" displayMode="label" textAlign="right" displayFormat="#,##0"
                                                defaultValue="0" maxLength="15" readOnly="true">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="70" inputType="text" id="contExpnsUct"
                                                blockSelect="false" displayMode="label" textAlign="right" allowChar="0-9,-\s"
                                                displayFormat="#,##0" defaultValue="0" maxLength="15">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="70" inputType="text" id="contExpnsAmt"
                                                blockSelect="false" displayMode="label" textAlign="right" displayFormat="#,##0"
                                                defaultValue="0" maxLength="15" readOnly="true">
                                            </w2:column>
                                            <w2:column blockSelect="false" displayMode="label" id="contUct" inputType="text"
                                                removeBorderStyle="false" width="115" textAlign="right" displayFormat="#,##0"
                                                defaultValue="0" maxByteLength="15" allowChar="0-9,\s" maxLength="15" readOnly="true">
                                            </w2:column>
                                            <w2:column blockSelect="false" displayMode="label" id="contAmt" inputType="text"
                                                removeBorderStyle="false" width="115" textAlign="right" displayFormat="#,##0"
                                                defaultValue="0" readOnly="true" maxByteLength="9" maxLength="15">
                                            </w2:column>
                                            <w2:column blockSelect="false" displayMode="label" id="actbgtQty" inputType="text"
                                                removeBorderStyle="false" width="100" textAlign="right" displayFormat="#,##0.000"
                                                defaultValue="0.000" applyFormat="all" allowChar="0-9.,-\s" maxByteLength=""
                                                maxLength="18">
                                            </w2:column>
                                            <w2:column blockSelect="false" displayMode="label" id="actbgtMtrctUct" inputType="text" value=""
                                                removeBorderStyle="false" width="100" textAlign="right" displayFormat="#,##0"
                                                defaultValue="0" applyFormat="all" allowChar="0-9.,-\s" maxByteLength="" maxLength="18">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="70" inputType="text" id="actbgtMtrctAmt"
                                                blockSelect="false" displayMode="label" textAlign="right" displayFormat="#,##0"
                                                defaultValue="0" maxLength="15" readOnly="true" applyFormat="">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="70" inputType="text" id="actbgtLbctUct"
                                                blockSelect="false" displayMode="label" textAlign="right" allowChar="0-9,-\s"
                                                displayFormat="#,##0" defaultValue="0" maxLength="15">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="70" inputType="text" id="actbgtLbctAmt"
                                                blockSelect="false" displayMode="label" textAlign="right" displayFormat="#,##0"
                                                defaultValue="0" maxLength="15" readOnly="true">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="70" inputType="text" id="actbgtExpnsUct"
                                                blockSelect="false" displayMode="label" textAlign="right" allowChar="0-9,-\s"
                                                displayFormat="#,##0" defaultValue="0" maxLength="15">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="70" inputType="text" id="actbgtExpnsAmt"
                                                blockSelect="false" displayMode="label" textAlign="right" displayFormat="#,##0"
                                                defaultValue="0" maxLength="15" readOnly="true">
                                            </w2:column>
                                            <w2:column blockSelect="false" displayMode="label" id="actbgtUct" inputType="text"
                                                removeBorderStyle="false" width="115" textAlign="right" displayFormat="#,##0"
                                                defaultValue="0" maxByteLength="15" allowChar="0-9,\s" maxLength="15" readOnly="true">
                                            </w2:column>
                                            <w2:column blockSelect="false" displayMode="label" id="actbgtAmt" inputType="text"
                                                removeBorderStyle="false" width="115" textAlign="right" displayFormat="#,##0"
                                                defaultValue="0" readOnly="true" maxByteLength="9" maxLength="15">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="115" inputType="text" id="plActbgtUct"
                                                blockSelect="false" displayMode="label" textAlign="right" displayFormat="#,##0"
                                                readOnly="true" defaultValue="0">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="115" inputType="text" id="plActbgtAmt"
                                                blockSelect="false" displayMode="label" textAlign="right" displayFormat="#,##0"
                                                readOnly="true" defaultValue="0" maxLength="15">
                                            </w2:column>
                                            <w2:column blockSelect="false" displayMode="label" id="incContAmt" inputType="text"
                                                removeBorderStyle="false" width="115" textAlign="right" readOnly="true"
                                                displayFormat="#,##0" defaultValue="0">
                                            </w2:column>
                                            <w2:column blockSelect="false" displayMode="label" id="incActbgtAmt" inputType="text"
                                                removeBorderStyle="false" width="115" textAlign="right" readOnly="true"
                                                displayFormat="#,##0" defaultValue="0">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="124" inputType="text" id="incPlActbgtAmt"
                                                blockSelect="false" displayMode="label" textAlign="right" displayFormat="#,##0"
                                                readOnly="true" defaultValue="0">
                                            </w2:column>
                                            <w2:column blockSelect="false" displayMode="label" id="actbgtRt" inputType="text"
                                                removeBorderStyle="false" width="70" readOnly="true" displayFormat="#,##0.00%"
                                                textAlign="right">
                                            </w2:column>
                                            <w2:column blockSelect="false" displayMode="label" id="cntrtPrgsYn" inputType="text"
                                                removeBorderStyle="false" width="100" textAlign="center" readOnly="true">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="75" inputType="text" id="cntrtQty"
                                                blockSelect="false" displayMode="label" defaultValue="0" textAlign="right"
                                                displayFormat="#,##0" readOnly="true">
                                            </w2:column>
                                            <w2:column blockSelect="false" displayMode="label" id="pcostQty" inputType="text"
                                                removeBorderStyle="false" width="84" textAlign="right" displayFormat="#,##0.000"
                                                defaultValue="0.000" readOnly="true">
                                            </w2:column>
                                            <w2:column blockSelect="false" displayMode="label" id="pcostAmt" inputType="text"
                                                removeBorderStyle="false" width="100" textAlign="right" readOnly="true"
                                                displayFormat="#,##0" defaultValue="0">
                                            </w2:column>
                                            <w2:column blockSelect="false" displayMode="label" id="mngctBgtAmt" inputType="text"
                                                removeBorderStyle="false" width="100" textAlign="right" readOnly="true"
                                                displayFormat="#,##0" defaultValue="0">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="80" inputType="text" id="exctAproYn"
                                                blockSelect="false" displayMode="label" readOnly="true">
                                            </w2:column>
                                            <w2:column blockSelect="false" displayMode="label" id="stndItemiNm" inputType="text"
                                                removeBorderStyle="false" width="175" readOnly="true" textAlign="left">
                                            </w2:column>
                                            <w2:column blockSelect="false" class="bl0" displayMode="label" id="popStndJobtypCd"
                                                imageSrc="/resources/images/content/ico_grid_find.png" inputType="image" readOnly="false"
                                                removeBorderStyle="false" viewType="icon" width="30">
                                            </w2:column>
                                            <w2:column blockSelect="false" displayMode="label" id="sortOdr" inputType="text"
                                                removeBorderStyle="false" width="50" maxByteLength="6" allowChar="0-9" defaultValue="0">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="300" inputType="text" style="" id="bgtDividePath"
                                                value="" blockSelect="false" displayMode="label" readOnly="true">
                                            </w2:column>
                                        </w2:row>
                                    </w2:gBody>
                                    <w2:footer style="" id="footer1">
                                        <w2:row style="" id="row8">
                                            <w2:column removeBorderStyle="false" width="40" inputType="text" id="column205"
                                                blockSelect="false" displayMode="label">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="45" inputType="text" id="column204"
                                                blockSelect="false" displayMode="label">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="90" inputType="text" id="column203" value="합계"
                                                blockSelect="false" displayMode="label">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="70" inputType="text" style="" id="column429"
                                                value="" blockSelect="false" displayMode="label">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="140" inputType="text" id="column202"
                                                blockSelect="false" displayMode="label">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="80" inputType="text" id="column201"
                                                blockSelect="false" displayMode="label">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="80" inputType="text" id="column200"
                                                blockSelect="false" displayMode="label">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="80" inputType="text" id="column199"
                                                blockSelect="false" displayMode="label">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="92" inputType="text" id="column285"
                                                blockSelect="false" displayMode="label">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="100" inputType="expression" id="column198"
                                                blockSelect="false" displayMode="label">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="115" inputType="text" id="column197"
                                                blockSelect="false" displayMode="label">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="115" inputType="expression" id="column196"
                                                blockSelect="false" displayMode="label" expression="sum('chgbfContAmt')"
                                                displayFormat="#,##0" textAlign="right">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="100" inputType="text" id="column195"
                                                blockSelect="false" displayMode="label">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="115" inputType="text" id="column194"
                                                blockSelect="false" displayMode="label">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="115" inputType="expression" id="column193"
                                                blockSelect="false" displayMode="label" expression="sum('chgbfActbgtAmt')" textAlign="right"
                                                displayFormat="#,##0">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="115" inputType="text" id="column215"
                                                blockSelect="false" displayMode="label">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="115" inputType="expression" id="column220"
                                                blockSelect="false" displayMode="label" expression="sum('chgbfPlActbgtAmt')"
                                                textAlign="right" displayFormat="#,##0">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="100" inputType="text" id="column192"
                                                blockSelect="false" displayMode="label">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="115" inputType="text" id="column191"
                                                blockSelect="false" displayMode="label">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="115" inputType="expression" id="column190"
                                                blockSelect="false" displayMode="label" expression="sum('contMtrctAmt')" textAlign="right"
                                                displayFormat="#,##0">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="70" inputType="text" id="column364"
                                                blockSelect="false" displayMode="label">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="70" inputType="expression" id="column394"
                                                blockSelect="false" displayMode="label" displayFormat="#,##0"
                                                expression="sum('contLbctAmt')" textAlign="right">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="70" inputType="text" id="column389"
                                                blockSelect="false" displayMode="label">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="70" inputType="expression" id="column384"
                                                blockSelect="false" displayMode="label" displayFormat="#,##0"
                                                expression="sum('contExpnsAmt')" textAlign="right">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="70" inputType="text" id="column379"
                                                blockSelect="false" displayMode="label">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="70" inputType="expression" id="column374"
                                                blockSelect="false" displayMode="label" displayFormat="#,##0" expression="sum('contAmt')"
                                                textAlign="right">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="100" inputType="text" id="column189"
                                                blockSelect="false" displayMode="label">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="115" inputType="text" id="column188"
                                                blockSelect="false" displayMode="label">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="115" inputType="expression" id="column187"
                                                blockSelect="false" displayMode="label" expression="sum('actbgtMtrctAmt')" textAlign="right"
                                                displayFormat="#,##0">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="70" inputType="text" id="column424"
                                                blockSelect="false" displayMode="label">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="70" inputType="expression" id="column419"
                                                blockSelect="false" displayMode="label" displayFormat="#,##0" textAlign="right"
                                                expression="sum('actbgtLbctAmt')">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="70" inputType="text" id="column414"
                                                blockSelect="false" displayMode="label">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="70" inputType="expression" id="column409"
                                                blockSelect="false" displayMode="label" displayFormat="#,##0" textAlign="right"
                                                expression="sum('actbgtExpnsAmt')">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="70" inputType="text" id="column404"
                                                blockSelect="false" displayMode="label">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="70" inputType="expression" id="column399"
                                                blockSelect="false" displayMode="label" displayFormat="#,##0" textAlign="right"
                                                expression="sum('actbgtAmt')">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="115" inputType="text" id="column226"
                                                blockSelect="false" displayMode="label">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="115" inputType="expression" id="column231"
                                                blockSelect="false" displayMode="label" textAlign="right" displayFormat="#,##0"
                                                expression="sum('plActbgtAmt')">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="115" inputType="expression" id="column184"
                                                blockSelect="false" displayMode="label" expression="sum('incContAmt')" textAlign="right"
                                                displayFormat="#,##0">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="115" inputType="expression" id="column181"
                                                blockSelect="false" displayMode="label" expression="sum('incActbgtAmt')" textAlign="right"
                                                displayFormat="#,##0">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="124" inputType="expression" id="column241"
                                                blockSelect="false" displayMode="label" textAlign="right" displayFormat="#,##0"
                                                expression="sum('incPlActbgtAmt')">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="70" inputType="text" id="column180"
                                                blockSelect="false" displayMode="label">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="100" inputType="text" id="column179"
                                                blockSelect="false" displayMode="label">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="75" inputType="text" id="column281"
                                                blockSelect="false" displayMode="label">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="84" inputType="text" id="column177"
                                                blockSelect="false" displayMode="label">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="100" inputType="expression" id="column176"
                                                blockSelect="false" displayMode="label" expression="sum('pcostAmt')" textAlign="right"
                                                displayFormat="#,##0">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="100" inputType="expression" id="column175"
                                                blockSelect="false" displayMode="label" expression="sum('mngctBgtAmt')" textAlign="right"
                                                displayFormat="#,##0">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="80" inputType="text" id="column210"
                                                blockSelect="false" displayMode="label">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="104" inputType="text" id="column172"
                                                blockSelect="false" displayMode="label">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="30" inputType="text" id="column171"
                                                blockSelect="false" displayMode="label">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="50" inputType="text" id="column170"
                                                blockSelect="false" displayMode="label">
                                            </w2:column>
                                            <w2:column removeBorderStyle="false" width="70" inputType="text" style="" id="column434"
                                                value="" blockSelect="false" displayMode="label">
                                            </w2:column>
                                        </w2:row>
                                    </w2:footer>
                                </w2:gridView>
                            </xf:group>
                        </xf:group>
                    </xf:group>
                </xf:group>
            </xf:group>                    
        </xf:group>
    </body>
</html>
