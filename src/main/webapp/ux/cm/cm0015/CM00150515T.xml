<?xml version="1.0" encoding="UTF-8"?>
<!-- <?xml-stylesheet href="/src/main/webapp/resources_ux/css/common.css" type="text/css"?>
<?xml-stylesheet href="/src/main/webapp/resources_ux/css/content.css" type="text/css"?> -->

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:w2="http://www.inswave.com/websquare"
	xmlns:xf="http://www.w3.org/2002/xforms">
	<head>
		<w2:type>DEFAULT</w2:type>
		<w2:buildDate />
		<xf:model>
			<xf:instance>
				<data xmlns="" />
			</xf:instance>
			<w2:dataCollection baseNode="map">
				<w2:dataList baseNode="list" repeatNode="map" id="dsCdCM004100" saveRemovedData="true">
					<w2:columnInfo>
						<w2:column id="charValN1" name="공통상세코드" dataType="text"></w2:column>
						<w2:column id="cdNm" name="이름" dataType="text"></w2:column>
					</w2:columnInfo>
				</w2:dataList>
				<w2:dataMap baseNode="map" id="dsSearchParamMap" ev:onmodelchange="scwin.dsSearchParamMap_onmodelchange">
					<w2:keyInfo>
						<w2:key id="pjtId" name="프로젝트ID" dataType="text"></w2:key>
						<w2:key id="bgtItemiCd" name="예산내역코드" dataType="text"></w2:key>
						<w2:key id="upperBgtItemiCd" name="상위_예산내역코드" dataType="text"></w2:key>
					</w2:keyInfo>
				</w2:dataMap>
				<w2:dataList baseNode="list" repeatNode="map" id="dsTcmTactbgtItemiTreeList" saveRemovedData="true">
					<w2:columnInfo>
						<w2:column id="bgtItemiCd" name="예산내역코드" dataType="text"></w2:column>
						<w2:column id="bgtItemiNm" name="예산_내역_명" dataType="text"></w2:column>
						<w2:column id="upperBgtItemiCd" name="상위_예산내역코드" dataType="text"></w2:column>
						<w2:column id="bgtItemiLv" name="예산_내역_레벨" dataType="text"></w2:column>
						<w2:column id="itemiYn" name="내역_여부" dataType="text"></w2:column>
					</w2:columnInfo>
				</w2:dataList>
				<w2:dataList baseNode="list" repeatNode="map" id="dsTcmTactbgtItemiList" saveRemovedData="true"
				    ev:ondataload="scwin.dsTcmTactbgtItemiList_ondataload" ev:oncelldatachange="scwin.dsTcmTactbgtItemiList_oncelldatachange">
				    <w2:columnInfo>
				        <w2:column id="chk" name="체크박스" dataType="text"></w2:column>
				        <w2:column id="no" name="No" dataType="text"></w2:column>
				        <w2:column id="gubun" name="구분" dataType="text"></w2:column>
				        <w2:column id="bgtItemiNm" name="품명" dataType="text"></w2:column>
				        <w2:column id="bgtItemiStdr" name="규격" dataType="text"></w2:column>
				        <w2:column id="bgtItemiUnit" name="단위" dataType="text"></w2:column>
				        <w2:column id="itexpGb" name="비목" dataType="text"></w2:column>
				        <w2:column id="contBgtMtrctUct" name="도급_예산_재료비_단가" dataType="number"></w2:column>
				        <w2:column id="contBgtMtrctAmt" name="도급_예산_재료비_금액" dataType="number"></w2:column>
				        <w2:column id="contBgtLbctUct" name="도급_예산_노무비_단가" dataType="number"></w2:column>
				        <w2:column id="contBgtLbctAmt" name="도급_예산_노무비_금액" dataType="number"></w2:column>
				        <w2:column id="contBgtExpnsUct" name="도급_예산_경비_단가" dataType="number"></w2:column>
				        <w2:column id="contBgtExpnsAmt" name="도급_예산_경비_금액" dataType="number"></w2:column>
				        <w2:column id="contBgtQty" name="도급예산_수량" dataType="number"></w2:column>
				        <w2:column id="contBgtUct" name="도급예산_단가" dataType="number"></w2:column>
				        <w2:column id="contBgtAmt" name="도급예산_금액" dataType="number"></w2:column>
				        <w2:column id="actbgtMtrctUct" name="실행예산_재료비_단가" dataType="number"></w2:column>
				        <w2:column id="actbgtMtrctAmt" name="실행예산_재료비_금액" dataType="number"></w2:column>
				        <w2:column id="actbgtLbctUct" name="실행예산_노무비_단가" dataType="number"></w2:column>
				        <w2:column id="actbgtLbctAmt" name="실행예산_노무비_금액" dataType="number"></w2:column>
				        <w2:column id="actbgtExpnsUct" name="실행예산_경비_단가" dataType="number"></w2:column>
				        <w2:column id="actbgtExpnsAmt" name="실행예산_경비_금액" dataType="number"></w2:column>
				        <w2:column id="actbgtQty" name="실행예산_수량" dataType="number"></w2:column>
				        <w2:column id="actbgtUct" name="실행예산_단가" dataType="number"></w2:column>
				        <w2:column id="actbgtAmt" name="실행예산_금액" dataType="number"></w2:column>
				        <w2:column id="actbgtRt" name="실행원가율(%)" dataType="text"></w2:column>
				        <w2:column id="rmkCn" name="비고" dataType="text"></w2:column>
				        <w2:column id="stndItemiCd" name="표준내역코드" dataType="text"></w2:column>
				        <w2:column id="stndItemiNm" name="표준내역명" dataType="text"></w2:column>
				        <w2:column id="sortOdr" name="정렬순서" dataType="text"></w2:column>
				        <w2:column id="bgtItemiLv" name="예산_내역_레벨" dataType="text"></w2:column>
				        <w2:column id="itemiYn" name="내역_여부" dataType="text"></w2:column>
				        <w2:column id="pjtId" name="프로젝트ID" dataType="text"></w2:column>
				        <w2:column id="bgtItemiCd" name="예산내역코드" dataType="text"></w2:column>
				        <w2:column id="bdmtItemCd" name="아이템코드" dataType="text"></w2:column>
				        <w2:column id="bdmtItemNm" name="아이템명" dataType="text"></w2:column>
				        <w2:column id="upperBgtItemiCd" name="상위_예산내역코드" dataType="text"></w2:column>
				        <w2:column id="itemiYnNext" name="하위레벨이 공종인지 내역인지 구분" dataType="text"></w2:column>
				        <w2:column id="bgtItemiLvNext" name="하위행의 레벨" dataType="text"></w2:column>
				    </w2:columnInfo>
				    <w2:data use="false"></w2:data>
				</w2:dataList>
				<w2:dataMap baseNode="map" id="dsAprvInfoMap">
					<w2:keyInfo>
						<w2:key id="pjtId" name="프로젝트ID" dataType="text"></w2:key>
						<w2:key id="aprvNo" name="결재번호" dataType="text"></w2:key>
						<w2:key id="aprvStusCd" name="결재상태코드" dataType="text"></w2:key>
						<w2:key id="aprvStusNm" name="결재상태명" dataType="text"></w2:key>
						<w2:key id="userNm" name="작성자" dataType="text"></w2:key>
					</w2:keyInfo>
				</w2:dataMap>
				<w2:dataList baseNode="list" repeatNode="map" id="dsEstPlanChrgrList" saveRemovedData="true">
					<w2:columnInfo>
						<w2:column id="pjtId" name="프로젝트ID" dataType="text"></w2:column>
						<w2:column id='chrgrEmpno' name="담당자_사번" dataType="text"></w2:column>
						<w2:column id="userNm" name="사용자명" dataType="text"></w2:column>
						<w2:column id="jbclCd" name="직급코드[CF0061]" dataType="text"></w2:column>
						<w2:column id="jbclNm" name="직급명" dataType="text"></w2:column>
						<w2:column id="deptCd" name="부서코드" dataType="text"></w2:column>
						<w2:column id="deptNm" name="부서명" dataType="text"></w2:column>
					</w2:columnInfo>
				</w2:dataList>
			</w2:dataCollection>
			<w2:workflowCollection></w2:workflowCollection>
		</xf:model>

		<script type="javascript" lazy="false"><![CDATA[
/***************************************************************************
 * Program ID : CM00150510T.xml
 * Program Name : 가실행예산(상세) - 내역관리TAB
 * Author : jeong se jun (tplsj)
 * Date : 2019.02.18
 *
 * History
 * ========================================
 * 변경일자     수정자   내 용
 * ========================================
 *
 **************************************************************************/

    /************************************************************************************
        DataCollection description

        :내역관리TAB
        dsTcmTactbgtItemiTreeList: 좌측 TREE
        dsTcmTactbgtItemiList: 우측 GRID 상세정보(내역)
        dsSearchParamMap: 검색조건 parameter
        dsAprvInfoMap: 결재정보

        :집계표TAB

        :공통코드
        dsCdCM004100: 비목 - 자재비[M], 노무비[L], 외주비[S], 경비[O]
     ************************************************************************************/

    /************************************************************************************
     *  [1] 전역변수
     ************************************************************************************/
    var svcId;      //callback 처리용 서비스ID
    scwin.v_rowIndex = -1;    //자재품목코드 추가시 선택된 row
    scwin.v_lastLeftRowIndex = -1;    //마지막으로 클릭된 발주처공종 row
    scwin.v_lastRightRowIndex = -1;    //마지막으로 EDIT된 상세정보(내역) row

    /************************************************************************************
     *  [2] onpageload(초기화포함)
     ************************************************************************************/
    scwin.onpageload = function() {

    };

    scwin.onpageunload = function() {

    };

    /** 화면초기화 **/
    scwin.fnInitial = function(pjtId) {
    
        //SelectBox 코드값 맵핑
        com.selCdListVrbl( "grdTcmTactbgtItemiList:itexpGb", {"upperCd": "CM004100","setCd": "charValN1", "setNm" : "cdNm"});//비목

        //검색조건 셋팅
        dsSearchParamMap.set( "pjtId" , pjtId );//프로젝트ID
        dsSearchParamMap.set( "bgtItemiCd" , "00000" );//예산내역코드

        //내역관리 TAB - 공종/내역 추가 TEXTBOX 기본값 1로 셋팅
        ibxAddRow.setValue( 1 );

        //틀고정
        grdTcmTactbgtItemiList.setFixedColumn( 7 );

        //결재정보조회
        scwin.fnAprvInfo();

        //UI팀용 함수 호출
        com.commonUI();
    };

    /************************************************************************************
     *  [3] 사용자 정의함수 함수
     ************************************************************************************/
     
    //내역관리 TAB - 상세정보(내역) 조회(트리, 내역 셋팅)
    scwin.fnTactbgtList = function(){
        
        svcId = "selectTcmTactbgtItemiList";
        ajaxLib.ajax("/cm/cm0015/CM00150515T/selectTcmTactbgtItemiList", {
            method: "POST",            
            requestData: dsSearchParamMap.getJSON(),
            callback: function(result, e) {
            
                dsTcmTactbgtItemiTreeList.removeAll();
                dsTcmTactbgtItemiTreeList.setJSON(result.data.dsTcmTactbgtItemiList);
                if(scwin.v_lastLeftRowIndex != -1){//마지막으로 클릭된 발주처공종 row
                    btnTreeSpanAll.setValue("전체 접기");
                    trvCodeList.spanAll(true);           
                    trvCodeList.findNodeByIndex( scwin.v_lastLeftRowIndex , true );//저장 후 해당 내역으로 focus 처리
                    scwin.v_lastLeftRowIndex = -1;//초기화
                }                        
            
                dsTcmTactbgtItemiList.removeAll();
                dsTcmTactbgtItemiList.setJSON(result.data.dsTcmTactbgtItemiList);
                if(scwin.v_lastRightRowIndex != -1){//마지막으로 EDIT된 상세정보(내역) row
                    grdTcmTactbgtItemiList.setFocusedCell( scwin.v_lastRightRowIndex , 0 , false );//저장 후 해당 내역으로 focus 처리
                    scwin.v_lastRightRowIndex = -1;//초기화
                }                
                com.setUdcValue("dsTotalCount","udcListCount",grdTcmTactbgtItemiList.getTotalRow());   //GRID ROW COUNT
                //grdTcmTactbgtItemiList.setRowReadOnly( 0 , true );//최상위 공종은 삭제되지 않도록 처리            
            },
            errCallback: function(result, e) {
            }
        });
    }

    //내역관리 TAB - 공종추가, 내역추가시 ROW수 입력 박스 체크
    scwin.fnAddRowCheck = function(){
        if(ibxAddRow.getValue() == "") {
            com.showMessage("CFW0007", "추가할 ROW수", "", "", ibxAddRow.id);//$1을(를) 입력하십시오.
            return 0;
        }
        return ibxAddRow.getValue();
    }

    //내역관리 TAB - 상세정보(내역) GRID에 공종추가/내역추가된 내역 체크
    //추가시 동일한 상위코드에 공종과 내역이 같이 존재할 수 없음.
    scwin.fnItemiYnCheck = function(flag, _upperBgtItemiCd){
        var bResult = true;
        $.each(dsTcmTactbgtItemiList.getMatchedJSON( "upperBgtItemiCd" , _upperBgtItemiCd), function(key, value){
            if(value.gubun == "추가" && value.itemiYn == flag){
                bResult = false;
                return false;//$.each break
            }
        });
        return bResult;
    }

    //내역관리 TAB - 상세정보(내역) GRID Focus Index
    scwin.fnGrdFocusRowIdx = function(){
        var nRowIndex = grdTcmTactbgtItemiList.getFocusedRowIndex();
        var nRealRowIndex = grdTcmTactbgtItemiList.getRealRowIndex( nRowIndex );
        if(nRowIndex < 0 || nRealRowIndex < 0){
            nRealRowIndex = -1;
            com.showMessage("CFW0004", "추가하실 상위 ROW");//$1을(를) 선택하십시오.
        }
        return nRealRowIndex;
    }

    //표준공종 call
    scwin.fnStndJobCall = function(data, callback) {
        var popOps = {
            popup_name :"표준내역",
            url :"/ux/cm/cm1500/CM15000015P.xml",
            data : data,
            widType:"XL",
            height:"678",
            callbackFn : callback
        };
        com.popup_open(popOps);

    };

    //표준내역팝업 CALLBACK
    scwin.popStndJobtypCdCallback = function(obj) {
        if(obj != ""){
            svcId = "saveStndItemiCd";
            ajaxLib.ajax("/cm/cm0015/CM00150515T/saveStndItemiCd", {
                method: "POST",
                requestData: {
                    param : dsSearchParamMap.getJSON(),
                    tcmStndJobtypCdList : obj
                },
                callback: function(result, e) {
                    com.showMessage("CFA0012");//저장되었습니다.
                    scwin.fnAprvInfo();              
                },  
                errCallback: function(result, e) {
                }            
            });
        }
    }

    //결재정보조회
    scwin.fnAprvInfo = function() {
        svcId = "selectAprvInfo";
        ajaxLib.ajax("/cm/cm0015/CM00150515T/selectAprvInfo", {
            mode : "asynchronous"
            , method : "POST"
            , requestData : dsSearchParamMap.getJSON()
            , callback : "fnCallback"
            , errCallback : "fnErrCallBack"
        });
    }

    scwin.grdTcmTactbgtItemiList_depthInfo = {};
    scwin.grdTcmTactbgtItemiList_updateDepthInfo = function() {

        scwin.grdTcmTactbgtItemiList_depthInfo["root"] = {
            "parent" : null,
            "child" : []
        };
        scwin.grdTcmTactbgtItemiList_depthInfo[0] = {
            "parent" : "root",
            "child" : []
        };
        var totalRow = grdTcmTactbgtItemiList.getTotalRow();
        
        for (var i = 0; i < totalRow; i++) {
            var currentDepth = parseInt(dsTcmTactbgtItemiList.getCellData(i, "bgtItemiLv"), 10);
            var nextDepth = parseInt(dsTcmTactbgtItemiList.getCellData(i + 1, "bgtItemiLv"), 10);
            var nextParent;
            scwin.grdTcmTactbgtItemiList_depthInfo[i+1] = {
                "child" : []
            };
            if (currentDepth < nextDepth) {//현재 level이 다음 row의 level보다 작으면.
                nextParent = i;
            } else {
                var diff = currentDepth - nextDepth;
                nextParent = i;
                for (var st = 0; st <= diff && nextParent !== "root"; st++) {
                    nextParent = scwin.grdTcmTactbgtItemiList_depthInfo[nextParent].parent;
                }
            }
            scwin.grdTcmTactbgtItemiList_depthInfo[i+1]["parent"] = nextParent;
            scwin.grdTcmTactbgtItemiList_depthInfo[nextParent]["child"].push(i+1);

            //컬럼 readOnly 처리 
            if(dsAprvInfoMap.get( "aprvNo" ) != ""){//결재번호
                grdTcmTactbgtItemiList.setRowReadOnly( i , true );
                grdTcmTactbgtItemiList.setCellDisabled( i , "popItemCd" , true );//자재품목코드 ICON
            }else if(dsTcmTactbgtItemiList.getCellData( i , "itemiYn" ) == "N"){//내역여부
            
                //readOnly 처리해야할 컬럼들
                let arrCols = ["bgtItemiStdr", "bgtItemiUnit", "itexpGb", "contBgtQty", "rmkCn", "popItemCd", 
                                "contBgtUct", "contBgtMtrctUct", "contBgtLbctUct", "contBgtExpnsUct", 
                                "actbgtQty", "actbgtUct", "actbgtMtrctUct", "actbgtLbctUct", "actbgtExpnsUct"];   
                                       
                for (let nIdx in arrCols) {
                    grdTcmTactbgtItemiList.setReadOnly("cell", i, arrCols[nIdx], true);
                }
            
            }else if(dsTcmTactbgtItemiList.getCellData( i , "stndItemiCd" ) != ""){//표준내역인경우
                grdTcmTactbgtItemiList.setReadOnly( "cell" , i , "bgtItemiNm" , true );//품명
                grdTcmTactbgtItemiList.setReadOnly( "cell" , i , "bgtItemiStdr" , true );//규격
                grdTcmTactbgtItemiList.setReadOnly( "cell" , i , "bgtItemiUnit" , true );//단위
                grdTcmTactbgtItemiList.setReadOnly( "cell" , i , "itexpGb" , true );//비목
            }

            //공동도급조정분(주간사)일 경우 수량은 EDIT 불가능 처리 : -1로 고정
            if(dsTcmTactbgtItemiList.getCellData( i , "stndItemiCd" ) == "Z-0001-0001"){
                grdTcmTactbgtItemiList.setReadOnly( "cell" , i , "contBgtQty" , true );//도급_수량
                grdTcmTactbgtItemiList.setReadOnly( "cell" , i , "actbgtQty" , true );//실행_수량
            }

            if(dsTcmTactbgtItemiList.getCellData( i , "itemiYn" ) == "N"){//내역여부
                grdTcmTactbgtItemiList.setRowColor( i , "blue" );
            }
            
        }

    }

    //저장시 validation 체크
    scwin.fnValidationCheck = function(){
        var bResult = true;
        var _idxArr = dsTcmTactbgtItemiList.getModifiedIndex();
        for (var i = 0; i < _idxArr.length; i++) {
            var _row = _idxArr[i];
            var obj = dsTcmTactbgtItemiList.getRowJSON(_row);
            //1. 변경된 데이터 validation [status : C,U 만해당]
            if (obj.rowStatus == "C" || obj.rowStatus == "U") {
                if(obj.itemiYn == "Y"){//내역여부
                    if(obj.bgtItemiNm == ""){
                        com.showMessage("SAA0043", "품명", "", "", grdTcmTactbgtItemiList.id, _row, "bgtItemiNm");//$1은(는) 필수입력사항입니다.
                        bResult = false;
                        break;
                    }else if(obj.bgtItemiUnit == ""){
                        com.showMessage("SAA0043", "단위", "", "", grdTcmTactbgtItemiList.id, _row, "bgtItemiUnit");//$1은(는) 필수입력사항입니다.
                        bResult = false;
                        break;
                    }else if(obj.sortOdr == ""){
                        com.showMessage("SAA0043", "정렬순서", "", "", grdTcmTactbgtItemiList.id, _row, "sortOdr");//$1은(는) 필수입력사항입니다.
                        bResult = false;
                        break;
                    }
                }else{//공종
                    if(obj.bgtItemiNm == ""){
                        com.showMessage("SAA0043", "품명", "", "", grdTcmTactbgtItemiList.id, _row, "bgtItemiNm");//$1은(는) 필수입력사항입니다.
                        bResult = false;
                        break;
                    }else if(obj.sortOdr == ""){
                        com.showMessage("SAA0043", "정렬순서", "", "", grdTcmTactbgtItemiList.id, _row, "sortOdr");//$1은(는) 필수입력사항입니다.
                        bResult = false;
                        break;
                    }
                }
            }
        }
        return bResult;
    }

    // 품목팝업
    scwin.fnImgClick = function(row, col) {
        scwin.v_rowIndex = row;

        let popOps = {        
            popup_name:"품목검색",
            url:"/ux/pr/prcomm/schPrItemCdPopup.xml",
            data:{ paramKeyItemNm : "" },
            callbackFn: function(obj) {
                if(obj != ""){
                    dsTcmTactbgtItemiList.setCellData( scwin.v_rowIndex , "bdmtItemCd" , obj[0] );//자재품목코드
                    dsTcmTactbgtItemiList.setCellData( scwin.v_rowIndex , "bdmtItemNm" , obj[1] );//자재품목명
                }
            },
            widType:"M",
            height:"569"
        };
        com.popup_open(popOps);
    };

    // 체크박스 클릭 시 하위 레벨도 체크
    scwin.fnChkEvent = function(info) {
        var row = dsTcmTactbgtItemiList.getRealRowIndex(info.rowIndex);
        var cur_val = info.newValue;
        var cur_depth = dsTcmTactbgtItemiList.getCellData(row, "bgtItemiLv");
        var row_cnt = dsTcmTactbgtItemiList.getTotalRow();
        for(var ix=1; Number(dsTcmTactbgtItemiList.getCellData(row+ix, "bgtItemiLv")) > cur_depth; ix++){
            dsTcmTactbgtItemiList.setCellData(row+ix, 0, cur_val);
            if(cur_val == "1"){
                grdTcmTactbgtItemiList.setRowReadOnly( row+ix , true );
            }else{
                grdTcmTactbgtItemiList.setRowReadOnly( row+ix , false );
            }
            
            if(row+ix > row_cnt-1){
                break;
            }
        }
    }

    //Font 색상 변경
    scwin.fnFontColor = function(value, formattedValue , rowIdx, colIdx) {
        if(parseInt(value, 0) < 0) {
            grdTcmTactbgtItemiList.setCellColor( rowIdx , colIdx , "red" );//음수
        } else {
            grdTcmTactbgtItemiList.setCellColor( rowIdx , colIdx , grdTcmTactbgtItemiList.getCellColor( rowIdx , colIdx ) );//양수
        }
        return formattedValue;
    };

    //추가행부터 마지막행까지 자동순번(10 단위로 한다.)
    scwin.fnSetNextSortOrd = function(nRowIndex, sUpperBgtItemiCd){
        var _matchIdxArr = dsTcmTactbgtItemiList.getMatchedIndex( "upperBgtItemiCd" , sUpperBgtItemiCd , true );
        for(var i=0; i<=_matchIdxArr.length; i++){
            if(parseInt(_matchIdxArr[i]) >= parseInt(nRowIndex)){
                if(i==0){
                    dsTcmTactbgtItemiList.setCellData( _matchIdxArr[i], "sortOdr", 10 );
                }else{
                    var _sortOdr = dsTcmTactbgtItemiList.getCellData( _matchIdxArr[i-1] , "sortOdr" );
                    dsTcmTactbgtItemiList.setCellData( _matchIdxArr[i], "sortOdr", Math.ceil(_sortOdr/10)*10+10 );                        
                }
            }
        }
    };
    
    /************************************************************************************
     *  [4] Callback 함수
     ************************************************************************************/
    /** 오류시 처리 **/
    scwin.fnErrCallBack = function(result, e) {

    };

    /** 정상시 후처리 **/
    scwin.fnCallback = function(result, e) {
        switch(svcId) {
            //내역관리 TAB - 발주처공종 TREE 조회
            case "selectTcmTactbgtItemiTreeList" :
                dsTcmTactbgtItemiTreeList.removeAll();
                dsTcmTactbgtItemiTreeList.setJSON(result.data.dsTcmTactbgtItemiTreeList);
                if(scwin.v_lastLeftRowIndex != -1){//마지막으로 클릭된 발주처공종 row
                    btnTreeSpanAll.setValue("전체 접기");
                    trvCodeList.spanAll(true);           
                    trvCodeList.findNodeByIndex( scwin.v_lastLeftRowIndex , true );//저장 후 해당 내역으로 focus 처리
                    scwin.v_lastLeftRowIndex = -1;//초기화
                }
                //scwin.fnTactbgtList();//내역관리 TAB - 상세정보(내역) 조회
                break;
            //내역관리 TAB - 저장
            case "saveTcmTactbgtItemi" :
                com.showMessage("CFA0012");//저장되었습니다.
                ibxAddRow.setValue( "1" );
                btnTreeSpanAll2.setValue("전체 접기");
                scwin.fnAprvInfo();
                break;
            //내역관리 TAB - 표준내역저장
            case "saveStndItemiCd" :
                com.showMessage("CFA0012");//저장되었습니다.
                scwin.fnAprvInfo();
                break;
            //내역관리 TAB - 결재정보조회
            case "selectAprvInfo" :
                dsAprvInfoMap.setEmptyValue();//결재정보
                dsEstPlanChrgrList.removeAll();//담당자LIST

                dsAprvInfoMap.setJSON( result.data.dsAprvInfoMap );
                dsEstPlanChrgrList.setJSON( result.data.dsEstPlanChrgrList );

                $p.parent().spnAprvStusNm.setValue(dsAprvInfoMap.get("aprvStusNm"));//진행상태
                $p.parent().spnLbprNm.setValue(dsAprvInfoMap.get("userNm"));//작업자

                /*
                 * 1.
                 * CF004100 : 기안중
                 * CF004120 : 검토요청
                 * CF004130 : 최종승인
                 * CF004999 : 부결
                 * 결재 상태값과 상관없이 결재번호가 존재하면 disabled 처리
                 * 기안취소시 결재번호를 null로 update 처리하기 때문에...
                 * 2.
                 * 견적계획 담당자일 경우만 버튼을 enabled 처리한다.
                 */
                if(dsEstPlanChrgrList.getMatchedIndex( "chrgrEmpno" , sessionStorage.userEmpno) == "" ||
                    (dsAprvInfoMap.get( "aprvNo" ) != "" &&  dsAprvInfoMap.get( "aprvStusCd" ) != "CF004999")){
                    btnNewStnd.setDisabled( true );//표준내역생성 button
                    ibxAddRow.setDisabled( true );//INPUT BOX
                    btnNewJobtp.setDisabled( true );//공종추가 button
                    btnNewItemi.setDisabled( true );//내역추가 button
                    btnSave.setDisabled( true );//저장 button
                    btnDelRow.setDisabled( true );//행삭제 button
                    btnAutoOrder.setDisabled( true );//동일레벨 자동순번
                    //grdTcmTactbgtItemiList.setGridReadOnly( true );
                }
                scwin.fnTactbgtList();//내역관리 TAB - 발주처공종 TREE 조회
                break;
            default :
                break;
        }
    };

    /************************************************************************************
     *  [5] Event 함수
     ************************************************************************************/
    //내역관리 TAB - 표준내역생성
    scwin.btnNewStnd_onclick = function() {
        scwin.fnStndJobCall({
                multiSelectYn: true,
                actbgtGb : "T",
                siteCd : dsSearchParamMap.get( "pjtId" )
            },
            "scwin.popStndJobtypCdCallback"
        );
    };

    //내역관리 TAB - 공종추가
    scwin.btnNewJobtp_onclick = function() {
        var nRowIndex = scwin.fnGrdFocusRowIdx();//상세정보(내역) GRID Focus Index
        var sItemiYn = dsTcmTactbgtItemiList.getCellData( nRowIndex , "itemiYn" );//내역_여부
        var sItemiYnNext = dsTcmTactbgtItemiList.getCellData( nRowIndex , "itemiYnNext" );//하위레벨이 공종인지 내역인지 구분
        var sBgtItemiCd = dsTcmTactbgtItemiList.getCellData( nRowIndex , "bgtItemiCd" );//예산내역코드
        var sUpperBgtItemiCd = dsTcmTactbgtItemiList.getCellData( nRowIndex , "bgtItemiCd" );//상위_예산내역코드를 예산내역코드로 셋팅
        var sUpperBgtItemiCdOrg = dsTcmTactbgtItemiList.getCellData( nRowIndex , "upperBgtItemiCd" );//상위_예산내역코드
        var sBgtItemiLv = dsTcmTactbgtItemiList.getCellData( nRowIndex , "bgtItemiLv" );//예산_내역_레벨

        if(nRowIndex >= 0){//상세정보(내역) GRID Focus 체크

            if(sItemiYn == "Y"){
                com.showMessage("CMW0003");//내역하위에 공종을 추가 할 수 없습니다.
                return;
            }else if(sItemiYnNext == "Y"){
                com.showMessage("CMW0004");//하위 레벨에 내역이 존재할 경우 공종을 추가 할 수 없습니다.
                return;
            }else if(!scwin.fnItemiYnCheck("Y", sUpperBgtItemiCd)){
                com.showMessage("CMW0100");//공종과 내역을 같이 추가할 수 없습니다.
                return;
            }
            
            if(sBgtItemiCd == "" && sUpperBgtItemiCdOrg != ""){//하위레벨에 공종 추가 후 추가된 공종 선택시 중간에 삽입하기 위함.
                sUpperBgtItemiCd = sUpperBgtItemiCdOrg;
            }else{
                sBgtItemiLv = WebSquare.util.parseInt( sBgtItemiLv , 2 )+1;//상위공종에서 하위공종 추가시
            }
            
            var nAddRows = scwin.fnAddRowCheck();//공종추가, 내역추가시 ROW수 입력 박스 체크
            if(nAddRows > 0){
                var tmpJsonData  = [];//추가할 ROW object 선언
                var nAddRowIndex = nRowIndex+1;//선택된 다음 ROW부터 추가
                for(var i=0; i<nAddRows; i++){
                    var tmpRowData = {
                         "pjtId" : dsSearchParamMap.get( "pjtId" )    //프로젝트ID
                         ,"gubun" : "추가"    //구분
                         ,"itemiYn" : "N"    //내역여부
                         ,"upperBgtItemiCd" : sUpperBgtItemiCd    //상위_예산내역코드
                         ,"bgtItemiLv" : sBgtItemiLv    //예산_내역_레벨
                    };
                    tmpJsonData.push(tmpRowData);
                }
                 dsTcmTactbgtItemiList.insertJSON( nAddRowIndex , tmpJsonData );//ROW추가
                 for(var i=0; i<nAddRows; i++){
                    grdTcmTactbgtItemiList.setReadOnly( "cell" , nAddRowIndex , "bgtItemiStdr" , true );//규격
                    grdTcmTactbgtItemiList.setReadOnly( "cell" , nAddRowIndex , "bgtItemiUnit" , true );//단위
                    grdTcmTactbgtItemiList.setReadOnly( "cell" , nAddRowIndex , "itexpGb" , true );//비목
                    grdTcmTactbgtItemiList.setReadOnly( "cell" , nAddRowIndex , "contBgtQty" , true );//도급_수량
                    grdTcmTactbgtItemiList.setReadOnly( "cell" , nAddRowIndex , "contBgtUct" , true );//도급_단가
                    grdTcmTactbgtItemiList.setReadOnly( "cell" , nAddRowIndex , "actbgtQty" , true );//실행_수량
                    grdTcmTactbgtItemiList.setReadOnly( "cell" , nAddRowIndex , "actbgtUct" , true );//실행_단가
                    grdTcmTactbgtItemiList.setReadOnly( "cell" , nAddRowIndex , "rmkCn" , true );//비고
                    //grdTcmTactbgtItemiList.setReadOnly( "cell" , nAddRowIndex , "sortOdr" , true );//정렬순서

                    grdTcmTactbgtItemiList.setCellDisabled( nAddRowIndex , "popItemCd" , true );//자재품목코드 ICON
                    grdTcmTactbgtItemiList.setRowColor( nAddRowIndex , "blue" );
                    
                    nAddRowIndex++;
                 }
                ibxAddRow.setValue( 1 );//공종/내역 추가 TEXTBOX 기본값 1로 셋팅
                scwin.fnSetNextSortOrd(nRowIndex, sUpperBgtItemiCd);//추가행부터 마지막행까지 자동순번(10 단위로 한다.)
                grdTcmTactbgtItemiList.setFocusedCell( nRowIndex , 0 , false );//선택된 ROW로 focus 이동
            }
        }

    };

    //내역관리 TAB - 내역추가
    scwin.btnNewItemi_onclick = function() {
        var nRowIndex = scwin.fnGrdFocusRowIdx();//상세정보(내역) GRID Focus Index
        var sItemiYn = dsTcmTactbgtItemiList.getCellData( nRowIndex , "itemiYn" );//내역_여부
        var sItemiYnNext = dsTcmTactbgtItemiList.getCellData( nRowIndex , "itemiYnNext" );//하위레벨이 공종인지 내역인지 구분
        var sBgtItemiCd = dsTcmTactbgtItemiList.getCellData( nRowIndex , "bgtItemiCd" );//예산내역코드
        var sUpperBgtItemiCd = dsTcmTactbgtItemiList.getCellData( nRowIndex , "upperBgtItemiCd" );//상위_예산내역코드
        var sBgtItemiLv = dsTcmTactbgtItemiList.getCellData( nRowIndex , "bgtItemiLv" );//예산_내역_레벨
        var sBgtItemiLvNext = dsTcmTactbgtItemiList.getCellData( nRowIndex , "bgtItemiLvNext" );//하위행의 레벨
        var sBgtItemiLvTmp = 0;//예산_내역_레벨
        
        if(sItemiYn == "N"){//공종선택시
            sUpperBgtItemiCd = sBgtItemiCd;//상위_예산내역코드를 예산내역코드로 변경
            sBgtItemiLvTmp = WebSquare.util.parseInt( sBgtItemiLv , 2 )+1;//예산_내역_레벨
        }else{
            sBgtItemiLvTmp = sBgtItemiLv;//예산_내역_레벨
        }

        if(nRowIndex >= 0){//상세정보(내역) GRID Focus 체크

            if(sUpperBgtItemiCd == ""){
                com.showMessage("CMW0082", "상위공종 ");//$1가(이) 존재하지 않습니다.
                return;
            }else if(sItemiYn == "N" && sItemiYnNext == "N" && parseInt(sBgtItemiLv) < parseInt(sBgtItemiLvNext)){
                com.showMessage("CMW0005");//하위 레벨에 공종이 존재할 경우 내역을 추가 할 수 없습니다.
                return;
            }else if(!scwin.fnItemiYnCheck("N", sUpperBgtItemiCd)){
                com.showMessage("CMW0100");//공종과 내역을 같이 추가할 수 없습니다.
                return;
            }

            var nAddRows = scwin.fnAddRowCheck();//공종추가, 내역추가시 ROW수 입력 박스 체크
            if(nAddRows > 0){
                var tmpJsonData  = [];//추가할 ROW object 선언
                var nAddRowIndex = nRowIndex+1;//선택된 다음 ROW부터 추가
                for(var i=0; i<nAddRows; i++){
                    var tmpRowData = {
                         "pjtId" : dsSearchParamMap.get( "pjtId" )    //프로젝트ID
                         ,"gubun" : "추가"    //구분
                         ,"itemiYn" : "Y"    //내역여부
                         ,"upperBgtItemiCd" : sUpperBgtItemiCd    //상위_예산내역코드
                         ,"bgtItemiLv" : sBgtItemiLvTmp    //예산_내역_레벨
                         ,"contBgtQty" : 0.000    //도급예산_수량
                         ,"contBgtUct" : 0    //도급예산_단가
                         ,"contBgtAmt" : 0    //도급예산_금액
                         ,"actbgtQty" : 0.000    //실행예산_수량
                         ,"actbgtUct" : 0    //실행예산_단가
                         ,"actbgtAmt" : 0    //실행예산_금액
                         ,"actbgtRt" : 0.00    //실행원가율
                        };
                    tmpJsonData.push(tmpRowData);
                }
                dsTcmTactbgtItemiList.insertJSON( nAddRowIndex , tmpJsonData );//ROW추가
                
                ibxAddRow.setValue( 1 );//공종/내역 추가 TEXTBOX 기본값 1로 셋팅
                scwin.fnSetNextSortOrd(nRowIndex, sUpperBgtItemiCd);//추가행부터 마지막행까지 자동순번(10 단위로 한다.)
                
                /*
                 * 내역추가 후 하위내역으로 상위공종들의 합계산 함수 호출
                 * 해당 ROW의 Index값으로 역추적하여 상위 level을 가져 오기 때문에.
                 * 공종추가시는 재호출하지 않음 신규 공종은 상위공종 합계산시 제외 처리함.
                 */
                scwin.grdTcmTactbgtItemiList_updateDepthInfo();
                grdTcmTactbgtItemiList.setFocusedCell( nRowIndex , 0 , false );//선택된 ROW로 focus 이동
            }
        }

    };

    //내역관리 TAB - 저장
    scwin.btnSave_onclick = function() {
        if(scwin.fnValidationCheck()){//저장시 validation 체크
            if (confirm("저장 하시겠습니까?")) {
                svcId = "saveTcmTactbgtItemi";
                ajaxLib.ajax("/cm/cm0015/CM00150515T/saveTcmTactbgtItemi", {
                    mode : "asynchronous"
                    , method : "POST"
                    , requestData : {
                                        tcmTactbgtItemiList : dsTcmTactbgtItemiList.getModifiedJSON()
                                    }
                    , callback : "fnCallback"
                    , errCallback : "fnErrCallBack"
                });
            }
        }
    };

    //내역관리 TAB - 엑셀다운
    scwin.btnExcelDwn_onclick = function() {
        var result = [];
        result.push(0);//checkbox 제외
        var totalCol = grdTcmTactbgtItemiList.getTotalCol();
        for(var i = 0; i < totalCol; i++) {
            if (!grdTcmTactbgtItemiList.getColumnVisible(i)) {
                result.push(i);
            }
        }
        var excelOpt = {
             fileName: "CM00150515T.xlsx"    //또는 xlsx 확장자 사용
            ,removeColumns: result.join(",")
            ,useSubTotal: true                //colMerge된 컬럼을 Merge해서 출력 할 지 여부
            ,colMergeTextAlign: "center"    //colMerge된 컬럼의 textAlign설정 (bottom, center, top 설정)
            ,useStyle: "true"
            ,indent: 1
        };  //excel download 옵션
        grdTcmTactbgtItemiList.advancedExcelDownload( excelOpt );
    };

    //내역관리 TAB - 행삭제
    scwin.btnDelRow_onclick = function() {
        var bFlag = true;
        var arrCheckedIndex = grdTcmTactbgtItemiList.getCheckedIndex( "chk" );
        if (arrCheckedIndex.length == 0) {
            com.showMessage("PRA0003");//삭제할 데이터를 선택해 주십시오.
            return;
        }
        //if(bFlag){
            dsTcmTactbgtItemiList.removeRows( arrCheckedIndex );
            /*
             * 내역삭제 후 하위내역으로 상위공종들의 합계산 함수 호출
             * 해당 ROW의 Index값으로 역추적하여 상위 level을 가져 오기 때문에.
             * 공종추가시는 재호출하지 않음 신규 공종은 상위공종 합계산시 제외 처리함.
             */
            scwin.grdTcmTactbgtItemiList_updateDepthInfo();
        //}
    };

    //내역관리 TAB - TREE 그룹 접기
    scwin.btnFold_onclick = function() {
        //grpTree.hide();
    };

    //내역관리 TAB - TREE 클릭 이벤트
    scwin.trvCodeList_onlabelclick = function(value,nodeElement,index) {
        //dsSearchParamMap.set( "bgtItemiCd" , value );//예산내역코드
        //scwin.fnTactbgtList();
        scwin.v_lastLeftRowIndex = index;//마지막으로 클릭된 발주처공종 row
        if (btnTreeSpanAll2.getValue() == "전체 펼치기"){
            btnTreeSpanAll2.setValue("전체 접기");
            grdTcmTactbgtItemiList.spanAll( true );
        }
        var nIndex = dsTcmTactbgtItemiList.getMatchedIndex( "bgtItemiCd" , value , true , 0 , dsTcmTactbgtItemiList.getTotalRow() );
        grdTcmTactbgtItemiList.setFocusedCell( nIndex , 0 , false );
    };

    //내역관리 TAB - 상세정보(내역) Cell변경 이벤트
    //info값 - {"oldValue":"","newValue":"1","rowIndex":4,"colIndex":4}
    scwin.grdTcmTactbgtItemiList_onviewchange = function(info) {
        var sColunmName = grdTcmTactbgtItemiList.getColumnID( info.colIndex );
        
        if("chk" == sColunmName){
            scwin.fnChkEvent(info);// 체크박스 클릭 시 하위 레벨도 체크
        }
    };

    //내역에서부터 상위공종 금액 계산
    scwin.fnUpperAmtSum = function(changeColName, currentRow, diffValue) {
        for (var nRow = scwin.grdTcmTactbgtItemiList_depthInfo[currentRow].parent; nRow !== "root"; nRow = scwin.grdTcmTactbgtItemiList_depthInfo[nRow].parent) {
            if(dsTcmTactbgtItemiList.getCellData( nRow , "itemiYn" ) == "N" && dsTcmTactbgtItemiList.getCellData( nRow , "gubun" ) == ""){    //공종이면서 신규추가건이 아니면.

                let nUpdateAmt = parseInt(dsTcmTactbgtItemiList.getCellData( nRow , changeColName )) + diffValue;//증가된 금액
                dsTcmTactbgtItemiList.setCellData( nRow , changeColName, nUpdateAmt );//상위공종에 증가된 금액 +

                let nContBgtAmt = dsTcmTactbgtItemiList.getCellData( nRow , "contBgtAmt" );     //도급예산금액
                let nActbgtAmt = dsTcmTactbgtItemiList.getCellData( nRow , "actbgtAmt" );       //실행예산금액

                //실행원가율
                if (nContBgtAmt == 0) {
                    dsTcmTactbgtItemiList.setCellData( nRow , "actbgtRt", 0.00);
                }else{
                     dsTcmTactbgtItemiList.setCellData( nRow , "actbgtRt", ((nActbgtAmt / nContBgtAmt) * 100));
                }

                dsTcmTactbgtItemiList.modifyRowStatus( nRow , "R" );//상태값
            }
        }
        return true;
    }

    //목록버튼 클릭 이벤트
    scwin.btnList_onclick = function() {
        var sData = {
                            "paramKeyIbxPjtNm" : $w.getParameter("paramKeyIbxPjtNm")    //프로젝트명
                           ,"paramKeySbxBzpjGbCd" : $w.getParameter("paramKeySbxBzpjGbCd")    //사업구분
                           ,"paramKeySbxPublCvlGbCd" : $w.getParameter("paramKeySbxPublCvlGbCd")    //민간/공공
                           ,"paramKeySbxSiteCdYn" : $w.getParameter("paramKeySbxSiteCdYn")    //현장코드여부
                           ,"paramKeyFromReqDtm" : $w.getParameter("paramKeyFromReqDtm")    //기간(의뢰일) 시작일자
                           ,"paramKeyToReqDtm" : $w.getParameter("paramKeyToReqDtm")    //기간(의뢰일) 종료일자
                           ,"paramKeySbxPeriod" : $w.getParameter("paramKeySbxPeriod")    //기간 SELECT BOX
                           ,"paramKeyListBack" : "Y"    //목록화면 이동 FLAG
                    };
        com.detailOpen("가실행예산목록", "CM00150505U", "/ux/cm/cm0015/CM00150500U.xml", "1", sData);
    };

    //하위내역으로 상위공종들의 합계산 .. 속도상 사용하지 않고 SP로 조회변경.
    scwin.dsTcmTactbgtItemiList_ondataload = function() {
        scwin.grdTcmTactbgtItemiList_updateDepthInfo();
        dsTcmTactbgtItemiList.initRowStatus();
    };

    //동일레벨 자동순번 클릭
    scwin.btnAutoOrder_onclick = function() {

        if(grdTcmTactbgtItemiList.getFocusedRowIndex() < 0) {
            com.showMessage("EMA0007");//선택된 행이 없습니다.
            return false;
        } else if (grdTcmTactbgtItemiList.getFocusedRowIndex() == 0) {
            com.showMessage("CMW0022");//최상위 공종 기준으로 자동순번 처리할 수 없습니다.
            return false;
        }

        if(confirm("포커스된 내역의 같은 공종(내역)기준으로 \n 자동 순번 처리 하시겠습니까?")) {
            var nUpperBgtItemiCd = dsTcmTactbgtItemiList.getCellData(grdTcmTactbgtItemiList.getFocusedRowIndex(), "upperBgtItemiCd");
            var arrMatchList = dsTcmTactbgtItemiList.getMatchedIndex("upperBgtItemiCd", nUpperBgtItemiCd, true, 0, dsTcmTactbgtItemiList.getTotalRow());

            //포커스된 상위내역코드와 같은 내역을 기준으로 순번 처리
            for (var i=0; i<arrMatchList.length; i++){
                dsTcmTactbgtItemiList.setCellData(arrMatchList[i], "sortOdr", (i+1)*10);
            }
        }
    };

    //GRID CELL 클릭 이벤트
    scwin.grdTcmTactbgtItemiList_oncellclick = function(row,col) {
        var sColunmName = grdTcmTactbgtItemiList.getColumnID( col );

        if(sColunmName == "popItemCd" && dsTcmTactbgtItemiList.getCellData( row , "itemiYn" ) == "Y"){//내역인경우
            scwin.fnImgClick(row,col);//품목팝업
        }
    };
    
    //DataCollection 변경 이벤트
    //{"rowIndex":11,"colID":"contBgtQty","oldValue":"5555","newValue":"1.000"}
    scwin.dsTcmTactbgtItemiList_oncelldatachange = function(info) {
        var sColunmName = info.colID;
        var row = info.rowIndex;
        var value = info.newValue;
        var sItemiYn = dsTcmTactbgtItemiList.getCellData( row , "itemiYn" );    //내역_여부
        var arrCols = ["contBgtQty", "contBgtUct", "contBgtMtrctUct", "contBgtLbctUct", "contBgtExpnsUct", 
                        "actbgtQty", "actbgtUct", "actbgtMtrctUct", "actbgtLbctUct", "actbgtExpnsUct"];   //금액변경 컬럼
                
        if (arrCols.indexOf(sColunmName) >= 0){
            // 숫자의 경우 "," 제거
            if (typeof(info.newValue) == "string"){
                value = info.newValue.replace(/,/gi,"");
                info.newValue = value;
                dsTcmTactbgtItemiList.setCellData(row, sColunmName, value);
            }        
        }
        
        //금액변경 컬럼인 경우
        if (arrCols.indexOf(sColunmName) >= 0) {//도급예산 수량,단가 실행예산 수량,단가
            //금액변경 컬럼이 공백이 들어올 경우 0으로 셋팅
            if("" == value){
                dsTcmTactbgtItemiList.setCellData( row , sColunmName , 0 );
            }
            
            //도급예산단가와 실행예산단가가 0 이하로 입력 못하게 0 으로 셋팅한다.
            if ((sColunmName == "contBgtUct")||(sColunmName == "actbgtUct")) {
                if (value < 0){
                    dsTcmTactbgtItemiList.setCellData( row , sColunmName , info.oldValue );
                    return false;
                }
            }
            
            //수량, 단가 변경시 금액 컬럼 합산.
            //금액은 소수점 이하 버림으로 처리 한다.
            var nOldValue = info.oldValue == "" ? 0 : info.oldValue;
            
            let nTmpAmt = 0; 
            if (sColunmName.indexOf("contBgt") == 0) {              //도급 관련 컬럼의 경우 
            
                if (sColunmName == "contBgtQty") {                  //도급예산수량                      
                    nTmpAmt = ((value * 1000) * dsTcmTactbgtItemiList.getCellData( row , "contBgtMtrctUct" )) / 1000;   //도급재료비계산
                    dsTcmTactbgtItemiList.setCellData( row , "contBgtMtrctAmt" , parseInt(nTmpAmt.toFixed(2)) );
                    
                    nTmpAmt = ((value * 1000) * dsTcmTactbgtItemiList.getCellData( row , "contBgtLbctUct" )) / 1000;    //도급노무비계산
                    dsTcmTactbgtItemiList.setCellData( row , "contBgtLbctAmt" , parseInt(nTmpAmt.toFixed(2)) );
                    
                    nTmpAmt = ((value * 1000) * dsTcmTactbgtItemiList.getCellData( row , "contBgtExpnsUct" )) / 1000;   //도급경비계산
                    dsTcmTactbgtItemiList.setCellData( row , "contBgtExpnsAmt" , parseInt(nTmpAmt.toFixed(2)) );                    
                } else if (sColunmName == "contBgtUct") {           //도급예산단가
                    nTmpAmt = (value * (dsTcmTactbgtItemiList.getCellData( row , "contBgtQty" ) * 1000)) / 1000;
                    dsTcmTactbgtItemiList.setCellData( row , "contBgtAmt" , parseInt(nTmpAmt.toFixed(2)) );
                } else if (sColunmName == "contBgtMtrctUct") {      //도급재료비단가
                    nTmpAmt = (value * (dsTcmTactbgtItemiList.getCellData( row , "contBgtQty" ) * 1000)) / 1000;
                    dsTcmTactbgtItemiList.setCellData( row , "contBgtMtrctAmt", parseInt(nTmpAmt.toFixed(2)) );
                } else if (sColunmName == "contBgtLbctUct") {       //도급노무비단가
                    nTmpAmt = (value * (dsTcmTactbgtItemiList.getCellData( row , "contBgtQty" ) * 1000)) / 1000;
                    dsTcmTactbgtItemiList.setCellData( row , "contBgtLbctAmt", parseInt(nTmpAmt.toFixed(2)) );
                } else if (sColunmName == "contBgtExpnsUct") {      //도급경비단가
                    nTmpAmt = (value * (dsTcmTactbgtItemiList.getCellData( row , "contBgtQty" ) * 1000)) / 1000;
                    dsTcmTactbgtItemiList.setCellData( row , "contBgtExpnsAmt", parseInt(nTmpAmt.toFixed(2)) );
                }    
                
                let nContBgtMtrctUct = Number(dsTcmTactbgtItemiList.getCellData(row, "contBgtMtrctUct"));       //도급재료비단가
                let nContBgtLbctUct = Number(dsTcmTactbgtItemiList.getCellData(row, "contBgtLbctUct"));         //도급노무비단가
                let nContBgtExpnsUct = Number(dsTcmTactbgtItemiList.getCellData(row, "contBgtExpnsUct"));       //도급경비단가
                       
                //도급 합단가, 합금액 계산               
                dsTcmTactbgtItemiList.setCellData(row, "contBgtUct", nContBgtMtrctUct + nContBgtLbctUct + nContBgtExpnsUct);    //도급단가계산
                                                    
                let nContBgtMtrctAmt = Number(dsTcmTactbgtItemiList.getCellData(row, "contBgtMtrctAmt"));       //도급재료비금액
                let nContBgtLbctAmt = Number(dsTcmTactbgtItemiList.getCellData(row, "contBgtLbctAmt"));         //도급노무비금액
                let nContBgtExpnsAmt = Number(dsTcmTactbgtItemiList.getCellData(row, "contBgtExpnsAmt"));       //도급경비금액            
                                                
                dsTcmTactbgtItemiList.setCellData(row, "contBgtAmt", nContBgtMtrctAmt + nContBgtLbctAmt + nContBgtExpnsAmt);      //도급금액계산
            
            } else if (sColunmName.indexOf("actbgt") == 0) {        //실행예산 관련 컬럼의 경우 
                                            
                let nActbgtMtrctUct = Number(dsTcmTactbgtItemiList.getCellData(row, "actbgtMtrctUct"));       //실행재료비단가
                let nActbgtLbctUct = Number(dsTcmTactbgtItemiList.getCellData(row, "actbgtLbctUct"));         //실행노무비단가
                let nActbgtExpnsUct = Number(dsTcmTactbgtItemiList.getCellData(row, "actbgtExpnsUct"));       //실행경비단가                                            
                                            
                if (sColunmName == "actbgtQty") {                   //실행예산수량
                    nTmpAmt = ((value * 1000) * dsTcmTactbgtItemiList.getCellData( row , "actbgtUct" )) / 1000;
                    dsTcmTactbgtItemiList.setCellData( row , "actbgtAmt" , parseInt(nTmpAmt.toFixed(2)) );
                    
                    nTmpAmt = ((value * 1000) * nActbgtMtrctUct) / 1000;    //도급재료비계산
                    dsTcmTactbgtItemiList.setCellData( row , "actbgtMtrctAmt" , parseInt(nTmpAmt.toFixed(2)) );
                    
                    nTmpAmt = ((value * 1000) * nActbgtLbctUct) / 1000;     //도급노무비계산
                    dsTcmTactbgtItemiList.setCellData( row , "actbgtLbctAmt" , parseInt(nTmpAmt.toFixed(2)) );
                    
                    nTmpAmt = ((value * 1000) * nActbgtExpnsUct) / 1000;    //도급경비계산
                    dsTcmTactbgtItemiList.setCellData( row , "actbgtExpnsAmt" , parseInt(nTmpAmt.toFixed(2)) );                    
                } else if (sColunmName == "actbgtUct") {            //실행예산단가
                    nTmpAmt = (value * (dsTcmTactbgtItemiList.getCellData( row , "actbgtQty" ) * 1000)) / 1000;
                    dsTcmTactbgtItemiList.setCellData( row , "actbgtAmt" , parseInt(nTmpAmt.toFixed(2)) );
                } else if (sColunmName == "actbgtMtrctUct") {       //실행재료비단가
                    nTmpAmt = (value * (dsTcmTactbgtItemiList.getCellData( row , "actbgtQty" ) * 1000)) / 1000;
                    dsTcmTactbgtItemiList.setCellData( row , "actbgtMtrctAmt", parseInt(nTmpAmt.toFixed(2)) );
                } else if (sColunmName == "actbgtLbctUct") {        //실행노무비단가
                    nTmpAmt = (value * (dsTcmTactbgtItemiList.getCellData( row , "actbgtQty" ) * 1000)) / 1000;
                    dsTcmTactbgtItemiList.setCellData( row , "actbgtLbctAmt", parseInt(nTmpAmt.toFixed(2)) );
                } else if (sColunmName == "actbgtExpnsUct") {       //실행경비단가
                    nTmpAmt = (value * (dsTcmTactbgtItemiList.getCellData( row , "actbgtQty" ) * 1000)) / 1000;
                    dsTcmTactbgtItemiList.setCellData( row , "actbgtExpnsAmt", parseInt(nTmpAmt.toFixed(2)) );
                }                   
                       
                //실행 합단가, 합금액 계산               
                dsTcmTactbgtItemiList.setCellData(row, "actbgtUct", nActbgtMtrctUct + nActbgtLbctUct + nActbgtExpnsUct);     //실행단가계산
                let nTmpActbgtAmt = ((nActbgtMtrctUct + nActbgtLbctUct + nActbgtExpnsUct) * (dsTcmTactbgtItemiList.getCellData( row , "actbgtQty" ) * 1000)) / 1000;
                
                let nActbgtMtrctAmt = Number(dsTcmTactbgtItemiList.getCellData(row, "actbgtMtrctAmt"));       //실행재료비금액
                let nActbgtLbctAmt = Number(dsTcmTactbgtItemiList.getCellData(row, "actbgtLbctAmt"));         //실행노무비금액
                let nActbgtExpnsAmt = Number(dsTcmTactbgtItemiList.getCellData(row, "actbgtExpnsAmt"));       //실행경비금액                 
                                                
                dsTcmTactbgtItemiList.setCellData(row, "actbgtAmt", nActbgtMtrctAmt + nActbgtLbctAmt + nActbgtExpnsAmt);    //실행금액계산                
                
            } else {
                return;
            }    
    
            var nContBgtAmt = dsTcmTactbgtItemiList.getCellData( row , "contBgtAmt" );  //도급예산금액
            var nActbgtAmt = dsTcmTactbgtItemiList.getCellData( row , "actbgtAmt" );    //실행예산금액    
    
            //실행원가율
            if (nContBgtAmt == 0) {
                dsTcmTactbgtItemiList.setCellData( row , "actbgtRt", 0.00);
            } else {            
                dsTcmTactbgtItemiList.setCellData( row , "actbgtRt", ((nActbgtAmt / nContBgtAmt) * 100));
            }            
        }else if(["contBgtAmt", "contBgtMtrctAmt", "contBgtLbctAmt", "contBgtExpnsAmt", 
                  "actbgtAmt", "actbgtMtrctAmt", "actbgtLbctAmt", "actbgtExpnsAmt"].indexOf(sColunmName) >= 0   ){//도급금액, 실행예산금액
        
            if(sItemiYn == "Y"){//내역                
                var diffAmt = info.newValue - info.oldValue;
                scwin.fnUpperAmtSum(sColunmName, row, diffAmt);
            }
        } 
        
        scwin.v_lastRightRowIndex = grdTcmTactbgtItemiList.getRealRowIndex( grdTcmTactbgtItemiList.getFocusedRowIndex() );    //마지막으로 클릭된 상세정보(내역) row
        
    };
    
    //전체 펼치기, 접기 - TREE
    scwin.btnTreeSpanAll_onclick = function() {
        if (dsTcmTactbgtItemiTreeList.getTotalRow() <= 0) {
            return false;
        }

        if (btnTreeSpanAll.getValue() == "전체 펼치기"){
            btnTreeSpanAll.setValue("전체 접기");
            trvCodeList.spanAll(true);
        } else {
            btnTreeSpanAll.setValue("전체 펼치기");
            trvCodeList.spanNode({depth:2}, false);
        }        
    };
    
    //전체 펼치기, 접기 - GRID
    scwin.btnTreeSpanAll2_onclick = function() {
        if (dsTcmTactbgtItemiList.getTotalRow() <= 0) {
            return false;
        }    
        
        if (btnTreeSpanAll2.getValue() == "전체 펼치기"){
            btnTreeSpanAll2.setValue("전체 접기");
            grdTcmTactbgtItemiList.spanAll( true );
        } else {
            btnTreeSpanAll2.setValue("전체 펼치기");
            grdTcmTactbgtItemiList.spanAll( 2 );
        }
    };

	]]></script>

		<w2:require src="/ux/common/udc/udcListCount.xml"></w2:require>
		<w2:require src="/ux/common/udc/udcSearchCode.xml"></w2:require>
        <w2:require src="/ux/common/udc/udcGridFix.xml"></w2:require>
	</head>
	<body ev:onpageload="scwin.onpageload" ev:onpageunload="scwin.onpageunload">
		<xf:group style="" id="" class="tab_body">
			<xf:group class="lybox_wrap fix_300 foldingbox1 on" id="" style="">
				<xf:group class="lybox" id="" style="">
					<xf:group class="lycolumn " id="" style="">
						<xf:group class="lyinner" id="" style="">
							<xf:group class="defaultbox" id="" style="">
								<w2:textbox class="df_tt" id="" label="발주처공종" style="" tagname="h3"></w2:textbox>
								<xf:group class="right_wrap" id="" style="">
									<xf:group id="" style="">
										<w2:anchor class="btn_gcm" clickEventElement=""
											ev:onclick="scwin.btnTreeSpanAll_onclick" id="btnTreeSpanAll" outerDiv="false" style="">
											<xf:label><![CDATA[전체 펼치기]]></xf:label>
										</w2:anchor>
									</xf:group>
								</xf:group>
							</xf:group>
							<w2:anchor class="btn_folding" id="btnFold" outerDiv="false" style="">
								<xf:label></xf:label>
							</w2:anchor>
							<w2:treeview class="autoHeight" dataType="listed"
								ev:onlabelclick="scwin.trvCodeList_onlabelclick" id="trvCodeList" lineShow="" style="height:300px"
								tooltipGroupClass="false" useDrag="" showTreeDepth="1">
								<w2:itemset nodeset="data:dsTcmTactbgtItemiTreeList">
									<w2:label ref="bgtItemiNm"></w2:label>
									<w2:value ref="bgtItemiCd"></w2:value>
									<w2:depth ref="bgtItemiLv"></w2:depth>
									<w2:folder ref=""></w2:folder>
									<w2:checkbox ref=""></w2:checkbox>
									<w2:checkboxDisabled ref=""></w2:checkboxDisabled>
									<w2:image ref=""></w2:image>
									<w2:iconImage ref=""></w2:iconImage>
									<w2:selectedImage ref=""></w2:selectedImage>
									<w2:expandedImage ref=""></w2:expandedImage>
									<w2:leafImage ref=""></w2:leafImage>
								</w2:itemset>
							</w2:treeview>
						</xf:group>
					</xf:group>
					<xf:group class="lycolumn" id="" style="">
						<xf:group class="lyinner" id="" style="">
							<xf:group class="defaultbox" id="" style="">
								<w2:textbox class="df_tt" id="" label="상세정보(내역)" style="" tagname="h3"></w2:textbox>
								<w2:udc_list_count id="dsTotalCount" style="position: absolute;"></w2:udc_list_count>
								<xf:group class="right_wrap" id="" style="">
									<xf:group id="" style="">
										<w2:anchor class="btn_gcm" clickEventElement=""
											ev:onclick="scwin.btnTreeSpanAll2_onclick" id="btnTreeSpanAll2" outerDiv="false" style="">
											<xf:label><![CDATA[전체 접기]]></xf:label>
										</w2:anchor>
										<w2:anchor class="btn_gcm" clickEventElement=""
											ev:onclick="scwin.btnNewStnd_onclick" id="btnNewStnd" outerDiv="false" style="">
											<xf:label><![CDATA[표준내역생성]]></xf:label>
										</w2:anchor>
										<xf:input allowChar="0-9" class="ar" dataType="" disabled="" id="ibxAddRow"
											mandatory="" ref="data:dsTcmStndJobtypCdDtlMap.sortOdr" style="width: 60px;">
											<w2:attributes>
												<w2:value></w2:value>
											</w2:attributes>
										</xf:input>
										<w2:anchor class="btn_gcm" clickEventElement=""
											ev:onclick="scwin.btnNewJobtp_onclick" id="btnNewJobtp" outerDiv="false" style="">
											<xf:label><![CDATA[공종추가]]></xf:label>
										</w2:anchor>
										<w2:anchor class="btn_gcm" clickEventElement=""
											ev:onclick="scwin.btnNewItemi_onclick" id="btnNewItemi" outerDiv="false" style="">
											<xf:label><![CDATA[내역추가]]></xf:label>
										</w2:anchor>
										<w2:anchor class="btn_gcm" clickEventElement=""
											ev:onclick="scwin.btnSave_onclick" id="btnSave" outerDiv="false" style="">
											<xf:label><![CDATA[저장]]></xf:label>
										</w2:anchor>
										<w2:anchor class="btn_gcm" clickEventElement=""
											ev:onclick="scwin.btnAutoOrder_onclick" id="btnAutoOrder" outerDiv="false" style="">
											<xf:label><![CDATA[자동순번]]></xf:label>
										</w2:anchor>
										<w2:anchor class="btn_gcm excel_down" clickEventElement=""
											ev:onclick="scwin.btnExcelDwn_onclick" id="btnExcelDwn" localeRef="" outerDiv="false" style=""
											toolTip="엑셀다운로드">
											<xf:label><![CDATA[엑셀다운로드]]></xf:label>
										</w2:anchor>
										<w2:anchor class="btn_gcm row_del" clickEventElement=""
											ev:onclick="scwin.btnDelRow_onclick" id="btnDelRow" outerDiv="false" style="" toolTip="행삭제">
											<xf:label><![CDATA[행삭제]]></xf:label>
										</w2:anchor>
										<w2:anchor class="btn_gcm" clickEventElement=""
											ev:onclick="scwin.btnList_onclick" id="btnList" outerDiv="false" style="">
											<xf:label><![CDATA[목록]]></xf:label>
										</w2:anchor>
										<!--
											<w2:udc_gridfix id="udcGrdFix" style=""></w2:udc_gridfix>
										-->
									</xf:group>
								</xf:group>
							</xf:group>
							<w2:gridView autoFit="lastColumn" class="narrow autoHeight" dataList="data:dsTcmTactbgtItemiList"
							    ev:onviewchange="scwin.grdTcmTactbgtItemiList_onviewchange" fixedColumnWithHidden="true" focusMode="row"
							    id="grdTcmTactbgtItemiList" readOnly="false" rowNumHeaderValue="No" rowNumVisible="" rowStatusHeaderValue="" rowStatusVisible=""
							    rowStatusWidth="30" scrollByColumn="false" showSortableUseFilter="true" sortable="false" style="height: 300px;"
							    useShiftKey="true" visibleRowNum="" checkReadOnlyOnPaste="true" enterKeyMove="down" selectByLabel="true" copyOption="display"
							    keyMoveEditMode="true" ev:oncellclick="scwin.grdTcmTactbgtItemiList_oncellclick" setCellInputTypeCustom="true"
							    preventAddRowOnPaste="true" ignoreNonEditableCell="true" contextMenu="true">
							    <w2:header id="header1" style="">
							        <w2:row id="row1" style="">
							            <w2:column blockSelect="false" colSpan="" displayMode="label" id="column54" inputType="text"
							                removeBorderStyle="false" rowSpan="3" style="height:34px;" value="선택" width="35">
							            </w2:column>
							            <w2:column blockSelect="false" colSpan="" displayMode="label" id="column51" inputType="text"
							                removeBorderStyle="false" rowSpan="3" style="height:34px;" value="No" width="50">
							            </w2:column>
                                        <w2:column blockSelect="false" colSpan="" displayMode="label" id="column9" inputType="text"
                                            removeBorderStyle="false" rowSpan="3" style="height:34px;" value="정렬순서" width="80" class="req">
                                        </w2:column>                                        
							            <w2:column blockSelect="false" colSpan="" displayMode="label" id="column36" inputType="text"
							                removeBorderStyle="false" rowSpan="3" style="height:34px;" value="구분" width="50">
							            </w2:column>
							            <w2:column blockSelect="false" colSpan="" displayMode="label" id="column45" inputType="text"
							                removeBorderStyle="false" rowSpan="3" style="height:34px;" value="품명" width="200" class="req">
							            </w2:column>
							            <w2:column blockSelect="false" colSpan="" displayMode="label" id="column48" inputType="text"
							                removeBorderStyle="false" rowSpan="3" style="height:34px;" value="규격" width="100">
							            </w2:column>
							            <w2:column blockSelect="false" colSpan="" displayMode="label" id="column42" inputType="text"
							                removeBorderStyle="false" rowSpan="3" style="height:34px;" value="단위" width="70">
							            </w2:column>
							            <w2:column blockSelect="false" colSpan="" displayMode="label" id="column39" inputType="text"
							                removeBorderStyle="false" rowSpan="3" style="height:34px;" value="비목" width="70" hidden="true">
							            </w2:column>
							            <w2:column blockSelect="false" colSpan="9" displayMode="label" id="column33" inputType="text"
							                removeBorderStyle="false" rowSpan="" style="height:34px;" value="도급예산" width="100">
							            </w2:column>
							            <w2:column blockSelect="false" colSpan="9" displayMode="label" id="column15" inputType="text"
							                removeBorderStyle="false" rowSpan="" style="height:34px;" value="실행예산" width="100">
							            </w2:column>
							            <w2:column blockSelect="false" colSpan="" displayMode="label" id="column2" inputType="text"
							                removeBorderStyle="false" rowSpan="3" style="height:34px;" value="실행&lt;br/&gt;원가율&lt;br/&gt;(%)" width="70">
							            </w2:column>
							            <w2:column blockSelect="false" colSpan="" displayMode="label" id="column7" inputType="text"
							                removeBorderStyle="false" rowSpan="3" style="height:34px;" value="비고" width="200">
							            </w2:column>
							            <w2:column blockSelect="false" colSpan="2" displayMode="label" id="column13" inputType="text"
							                removeBorderStyle="false" rowSpan="2" style="height:34px;" value="표준내역" width="120">
							            </w2:column>

							            <w2:column removeBorderStyle="false" width="120" inputType="text" style="height:34px;"
							                id="column112" value="자재품목코드" blockSelect="false" displayMode="label" colSpan="3" rowSpan="2">
							            </w2:column>
							            <w2:column blockSelect="false" colSpan="" displayMode="label" hidden="true" id="column111"
							                inputType="text" removeBorderStyle="false" rowSpan="2" style="height:34px;" value="내역여부" width="70">
							            </w2:column>
							        </w2:row>
							        <w2:row id="row4" style="">
							            <w2:column hidden="false" removeBorderStyle="false" width="100" inputType="text"
							                style="height:34px;" id="column197" value="수량" blockSelect="false" displayMode="label" colSpan="" rowSpan="2">
							            </w2:column>
							            <w2:column removeBorderStyle="false" width="140" inputType="text" style="height:34px;"
							                id="column127" value="재료비" blockSelect="false" displayMode="label" colSpan="2" rowSpan="">
							            </w2:column>
							            <w2:column removeBorderStyle="false" width="140" inputType="text" style="height:34px;"
							                id="column157" value="노무비" blockSelect="false" displayMode="label" colSpan="2" rowSpan="">
							            </w2:column>
							            <w2:column removeBorderStyle="false" width="140" inputType="text" style="height:34px;"
							                id="column165" value="경비" blockSelect="false" displayMode="label" colSpan="2" rowSpan="">
							            </w2:column>
                                        <w2:column hidden="false" removeBorderStyle="false" width="230" inputType="text"
                                            style="height:34px;" id="column198" value="합계" blockSelect="false" displayMode="label" colSpan="2" rowSpan="">
                                        </w2:column>                                        
							            <w2:column hidden="false" removeBorderStyle="false" width="100" inputType="text"
							                style="height:68px;" id="column202" value="수량" blockSelect="false" displayMode="label" colSpan="" rowSpan="2">
							            </w2:column>
							            <w2:column removeBorderStyle="false" width="140" inputType="text" style="height:34px;"
							                id="column173" value="재료비" blockSelect="false" displayMode="label" colSpan="2" rowSpan="">
							            </w2:column>
							            <w2:column removeBorderStyle="false" width="140" inputType="text" style="height:34px;"
							                id="column189" value="노무비" blockSelect="false" displayMode="label" colSpan="2" rowSpan="">
							            </w2:column>
							            <w2:column removeBorderStyle="false" width="140" inputType="text" style="height:34px;"
							                id="column181" value="경비" blockSelect="false" displayMode="label" colSpan="2" rowSpan="">
							            </w2:column>
                                        <w2:column hidden="false" removeBorderStyle="false" width="230" inputType="text"
                                            style="height:34px;" id="column203" value="합계" blockSelect="false" displayMode="label" colSpan="2" rowSpan="">
                                        </w2:column>                                        
							        </w2:row>
							        <w2:row style="" id="row5">
							            <w2:column removeBorderStyle="false" width="110" inputType="text" style="height:34px;"
							                id="column147" value="단가" blockSelect="false" displayMode="label">
							            </w2:column>
							            <w2:column removeBorderStyle="false" width="120" inputType="text" style="height:34px;"
							                id="column146" value="금액" blockSelect="false" displayMode="label">
							            </w2:column>
							            <w2:column removeBorderStyle="false" width="120" inputType="text" style="height:34px;"
							                id="column145" value="단가" blockSelect="false" displayMode="label">
							            </w2:column>
							            <w2:column removeBorderStyle="false" width="120" inputType="text" style="height:34px;"
							                id="column144" value="금액" blockSelect="false" displayMode="label">
							            </w2:column>
							            <w2:column removeBorderStyle="false" width="120" inputType="text" style="height:34px;"
							                id="column158" value="단가" blockSelect="false" displayMode="label">
							            </w2:column>
							            <w2:column removeBorderStyle="false" width="120" inputType="text" style="height:34px;"
							                id="column170" value="금액" blockSelect="false" displayMode="label">
							            </w2:column>
							            <w2:column removeBorderStyle="false" width="120" inputType="text" style="height:34px;"
							                id="column166" value="단가" blockSelect="false" displayMode="label">
							            </w2:column>
							            <w2:column removeBorderStyle="false" width="120" inputType="text" style="height:34px;"
							                id="column162" value="금액" blockSelect="false" displayMode="label">
							            </w2:column>
							            <w2:column removeBorderStyle="false" width="110" inputType="text" style="height:34px;"
							                id="column142" value="단가" blockSelect="false" displayMode="label">
							            </w2:column>
							            <w2:column removeBorderStyle="false" width="120" inputType="text" style="height:34px;"
							                id="column141" value="금액" blockSelect="false" displayMode="label">
							            </w2:column>
							            <w2:column removeBorderStyle="false" width="120" inputType="text" style="height:34px;"
							                id="column174" value="단가" blockSelect="false" displayMode="label">
							            </w2:column>
							            <w2:column removeBorderStyle="false" width="120" inputType="text" style="height:34px;"
							                id="column194" value="금액" blockSelect="false" displayMode="label">
							            </w2:column>
							            <w2:column removeBorderStyle="false" width="120" inputType="text" style="height:34px;"
							                id="column190" value="단가" blockSelect="false" displayMode="label">
							            </w2:column>
							            <w2:column removeBorderStyle="false" width="120" inputType="text" style="height:34px;"
							                id="column186" value="금액" blockSelect="false" displayMode="label">
							            </w2:column>
							            <w2:column removeBorderStyle="false" width="120" inputType="text" style="height:34px;"
							                id="column182" value="단가" blockSelect="false" displayMode="label">
							            </w2:column>
							            <w2:column removeBorderStyle="false" width="120" inputType="text" style="height:34px;"
							                id="column178" value="금액" blockSelect="false" displayMode="label">
							            </w2:column>
							            <w2:column removeBorderStyle="false" width="120" inputType="text" style="height:34px;"
							                id="column138" value="코드" blockSelect="false" displayMode="label">
							            </w2:column>
							            <w2:column removeBorderStyle="false" width="120" inputType="text" style="height:34px;"
							                id="column137" value="명칭" blockSelect="false" displayMode="label">
							            </w2:column>
							            <w2:column removeBorderStyle="false" width="110" inputType="text" style="height:34px;"
							                id="column135" value="코드" blockSelect="false" displayMode="label" colSpan="2" rowSpan="" hidden="true">
							            </w2:column>
							            <w2:column removeBorderStyle="false" width="120" inputType="text" style="height:34px;"
							                id="column133" value="명칭" blockSelect="false" displayMode="label" hidden="true">
							            </w2:column>
							            <w2:column removeBorderStyle="false" width="70" inputType="text" style="height:34px;" id="column132"
							                value="" blockSelect="false" displayMode="label">
							            </w2:column>
							        </w2:row>
							    </w2:header>
							    <w2:gBody id="gBody1" style="">
							        <w2:row id="row3" style="">
							            <w2:column blockSelect="false" displayMode="label" id="chk" inputType="checkbox"
							                removeBorderStyle="false" style="" value="" width="35">
							            </w2:column>
							            <w2:column blockSelect="false" displayMode="label" expression="rowindex()+1" id="no"
							                inputType="expression" readOnly="true" removeBorderStyle="false" style="" value="" width="70">
							            </w2:column>
                                        <w2:column allowChar="0-9" blockSelect="false" displayMode="label" id="sortOdr" inputType="text"
                                            readOnly="false" removeBorderStyle="false" style="" textAlign="center" value="" width="80">
                                        </w2:column>                                        
							            <w2:column blockSelect="false" displayMode="" id="gubun" inputType="text" readOnly="true"
							                removeBorderStyle="" style="" textAlign="center" value="" width="60">
							            </w2:column>
							            <w2:column blockSelect="false" depthColumn="bgtItemiLv" depthType="nbsp" displayMode="label"
							                id="bgtItemiNm" inputType="drilldown" readOnly="false" removeBorderStyle="false" showDepth="100" style=""
							                textAlign="left" value="" width="200" ignoreChar="》">
							            </w2:column>
							            <w2:column blockSelect="false" displayMode="label" id="bgtItemiStdr" inputType="text"
							                readOnly="false" removeBorderStyle="false" style="" textAlign="left" value="" width="100">
							            </w2:column>
							            <w2:column blockSelect="false" displayMode="label" id="bgtItemiUnit" inputType="text"
							                readOnly="false" removeBorderStyle="false" style="" textAlign="center" value="" width="70">
							            </w2:column>
							            <w2:column allOption="" blockSelect="false" chooseOption="" displayMode="label" id="itexpGb"
							                inputType="select" readOnly="false" ref="" removeBorderStyle="false" style="" textAlign="center" value="" width="80"
							                viewType="icon" selectedData="true">
							                <w2:choices>
							                    <w2:item>
							                        <w2:label><![CDATA[자재]]></w2:label>
							                        <w2:value><![CDATA[M]]></w2:value>
							                    </w2:item>
							                    <w2:item>
							                        <w2:label><![CDATA[노무]]></w2:label>
							                        <w2:value><![CDATA[L]]></w2:value>
							                    </w2:item>
							                    <w2:item>
							                        <w2:label><![CDATA[외주]]></w2:label>
							                        <w2:value><![CDATA[S]]></w2:value>
							                    </w2:item>
							                    <w2:item>
							                        <w2:label><![CDATA[경비]]></w2:label>
							                        <w2:value><![CDATA[O]]></w2:value>
							                    </w2:item>
							                </w2:choices>
							            </w2:column>
							            <w2:column allowChar="0-9-.,\s" blockSelect="false" dataType="number" defaultValue="0.000"
							                displayFormat="#,##0.000" displayMode="label" id="contBgtQty" inputType="text" readOnly="false"
							                removeBorderStyle="false" style="" textAlign="right" value="" width="100" applyFormat="all"
							                customFormatter="scwin.fnFontColor">
							            </w2:column>
							      
							            <w2:column removeBorderStyle="false" width="120" inputType="text" style="" id="contBgtMtrctUct"
							                value="" blockSelect="false" displayMode="label" customFormatter="scwin.fnFontColor" allowChar="0-9,\s"
							                textAlign="right" displayFormat="#,##0">
							            </w2:column>
							            <w2:column removeBorderStyle="false" width="120" inputType="text" style="" id="contBgtMtrctAmt"
							                value="" blockSelect="false" displayMode="label" customFormatter="scwin.fnFontColor" textAlign="right"
							                readOnly="true" displayFormat="#,##0">
							            </w2:column>
							            <w2:column removeBorderStyle="false" width="120" inputType="text" style="" id="contBgtLbctUct"
							                value="" blockSelect="false" displayMode="label" customFormatter="scwin.fnFontColor" allowChar="0-9,\s"
							                textAlign="right" displayFormat="#,##0">
							            </w2:column>
							            <w2:column removeBorderStyle="false" width="120" inputType="text" style="" id="contBgtLbctAmt"
							                value="" blockSelect="false" displayMode="label" customFormatter="scwin.fnFontColor" textAlign="right"
							                readOnly="true" displayFormat="#,##0">
							            </w2:column>
							            <w2:column removeBorderStyle="false" width="120" inputType="text" style="" id="contBgtExpnsUct"
							                value="" blockSelect="false" displayMode="label" customFormatter="scwin.fnFontColor" allowChar="0-9,\s"
							                textAlign="right" displayFormat="#,##0">
							            </w2:column>
							            <w2:column removeBorderStyle="false" width="120" inputType="text" style="" id="contBgtExpnsAmt"
							                value="" blockSelect="false" displayMode="label" customFormatter="scwin.fnFontColor" textAlign="right"
							                readOnly="true" displayFormat="#,##0">
							            </w2:column>
                                        <w2:column allowChar="0-9,\s" blockSelect="false" dataType="number" displayFormat="#,##0"
                                            displayFormatFunc="" displayFormatter="" displayMode="label" id="contBgtUct" inputType="text" readOnly="true"
                                            removeBorderStyle="false" style="" textAlign="right" value="" width="110" applyFormat="all"
                                            customFormatter="scwin.fnFontColor">
                                        </w2:column>
                                        <w2:column blockSelect="false" dataType="number" displayFormat="#,##0" displayFormatter=""
                                            displayMode="label" id="contBgtAmt" inputType="text" readOnly="true" removeBorderStyle="false" style=""
                                            textAlign="right" value="" width="120" allowChar="0-9" applyFormat="all" customFormatter="scwin.fnFontColor">
                                        </w2:column>                                        
                                        <w2:column allowChar="0-9-.,\s" blockSelect="false" dataType="number" defaultValue="0.000"
                                            displayFormat="#,##0.000" displayMode="label" id="actbgtQty" inputType="text" readOnly="false"
                                            removeBorderStyle="false" style="" textAlign="right" value="" width="100" applyFormat="all"
                                            customFormatter="scwin.fnFontColor">
                                        </w2:column>
							            <w2:column removeBorderStyle="false" width="120" inputType="text" style="" id="actbgtMtrctUct"
							                value="" blockSelect="false" displayMode="label" customFormatter="scwin.fnFontColor" allowChar="0-9,\s"
							                textAlign="right" displayFormat="#,##0">
							            </w2:column>
							            <w2:column removeBorderStyle="false" width="120" inputType="text" style="" id="actbgtMtrctAmt"
							                value="" blockSelect="false" displayMode="label" customFormatter="scwin.fnFontColor" textAlign="right"
							                readOnly="true" displayFormat="#,##0">
							            </w2:column>
							            <w2:column removeBorderStyle="false" width="120" inputType="text" style="" id="actbgtLbctUct"
							                value="" blockSelect="false" displayMode="label" customFormatter="scwin.fnFontColor" allowChar="0-9,\s"
							                textAlign="right" displayFormat="#,##0">
							            </w2:column>
							            <w2:column removeBorderStyle="false" width="120" inputType="text" style="" id="actbgtLbctAmt"
							                value="" blockSelect="false" displayMode="label" customFormatter="scwin.fnFontColor" textAlign="right"
							                readOnly="true" displayFormat="#,##0">
							            </w2:column>
							            <w2:column removeBorderStyle="false" width="120" inputType="text" style="" id="actbgtExpnsUct"
							                value="" blockSelect="false" displayMode="label" customFormatter="scwin.fnFontColor" allowChar="0-9,\s"
							                textAlign="right" displayFormat="#,##0">
							            </w2:column>
							            <w2:column removeBorderStyle="false" width="120" inputType="text" style="" id="actbgtExpnsAmt"
							                value="" blockSelect="false" displayMode="label" customFormatter="scwin.fnFontColor" textAlign="right"
							                readOnly="true" displayFormat="#,##0">
							            </w2:column>
                                        <w2:column allowChar="0-9-.,\s" blockSelect="false" dataType="number" defaultValue="0.000"
                                            displayFormat="#,##0.000" displayMode="label" id="actbgtUct" inputType="text" readOnly="false"
                                            removeBorderStyle="false" style="" textAlign="right" value="" width="100" applyFormat="all"
                                            customFormatter="scwin.fnFontColor">
                                        </w2:column>
                                        <w2:column allowChar="0-9,\s" blockSelect="false" dataType="number" displayFormat="#,##0"
                                            displayFormatter="" displayMode="label" id="actbgtAmt" inputType="text" readOnly="true" removeBorderStyle="false"
                                            style="" textAlign="right" value="" width="110" applyFormat="all" customFormatter="scwin.fnFontColor">
                                        </w2:column>                                        
							            <w2:column blockSelect="false" dataType="number" defaultValue="" displayFormat="#,##0.00"
							                displayMode="label" id="actbgtRt" inputType="text" readOnly="true" removeBorderStyle="false" style=""
							                textAlign="right" value="" width="70">
							            </w2:column>
							            <w2:column blockSelect="false" displayMode="label" id="rmkCn" inputType="text" readOnly="false"
							                removeBorderStyle="false" style="" textAlign="left" value="" width="200">
							            </w2:column>
							            <w2:column blockSelect="false" displayMode="label" id="stndItemiCd" inputType="text" readOnly="true"
							                removeBorderStyle="false" style="" textAlign="center" value="" width="120">
							            </w2:column>
							            <w2:column blockSelect="false" displayMode="label" id="stndItemiNm" inputType="text" readOnly="true"
							                removeBorderStyle="false" style="" textAlign="left" value="" width="120">
							            </w2:column>
							            <w2:column removeBorderStyle="false" width="70" inputType="text" style="" id="bdmtItemCd" value=""
							                blockSelect="false" displayMode="label" textAlign="center" readOnly="true">
							            </w2:column>
							            <w2:column removeBorderStyle="false" width="40" inputType="image" style="" id="popItemCd" value=""
							                blockSelect="false" displayMode="label" class="bl0" imageSrc="/resources/images/content/ico_grid_find.png"
							                viewType="icon">
							            </w2:column>
							            <w2:column removeBorderStyle="false" width="120" inputType="text" style="" id="bdmtItemNm" value=""
							                blockSelect="false" displayMode="label" readOnly="true" textAlign="left">
							            </w2:column>
							            <w2:column blockSelect="false" displayMode="label" id="itemiYn" inputType="text" readOnly="true"
							                removeBorderStyle="false" style="" value="" width="70">
							            </w2:column>
							        </w2:row>
							    </w2:gBody>
							</w2:gridView>
						</xf:group>
					</xf:group>
				</xf:group>
			</xf:group>
		</xf:group>


	</body>
</html>
